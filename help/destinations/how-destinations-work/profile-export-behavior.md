---
title: プロファイルの書き出し動作
description: Experience Platformの宛先でサポートされる様々な統合パターン間で、プロファイルの書き出し動作がどのように異なるかを説明します。
source-git-commit: 5d404d723ea0b7cc72c5188dcff1f59a1874cfe2
workflow-type: tm+mt
source-wordcount: '2979'
ht-degree: 24%

---

# 様々な宛先タイプに対するプロファイル書き出し動作

次の図に示すように、Experience Platformには複数の宛先タイプがあります。 これらの宛先は、次の節で説明するように、宛先の書き出しのトリガーと書き出しに含まれる内容に関して、書き出しパターンが少し異なります。

>[!IMPORTANT]
>
>このドキュメントページでは、図の下部で強調表示されている接続に対するプロファイルエクスポートの動作についてのみ説明します。

![宛先のタイプ図](/help/destinations/assets/how-destinations-work/types-of-destinations-v4.png)

## マイクロバッチおよび集約ポリシー

宛先のタイプ別の特定の情報を調べる前に、のマイクロバッチと集計ポリシーの概念を理解しておくことが重要です。 *ストリーミング先*.

Experience Platformの宛先は、データを HTTPS 呼び出しとして API ベースの統合に書き出します。 他のアップストリームサービスから、バッチ取得、ストリーミング取得、バッチセグメント化、ストリーミングセグメント化、ID グラフの変更の結果プロファイルが更新されたことが通知されると、データが書き出され、ストリーミング先に送信されます。

宛先 API エンドポイントにディスパッチされる前に、プロファイルを HTTPS メッセージに集計するプロセスが呼び出されます *微小バッチ処理*.

次を参照： [Facebookの宛先](/help/destinations/catalog/social/facebook.md) と *[設定可能な集計](/help/destinations/destination-sdk/destination-configuration.md#configurable-aggregation)* ポリシーの例として — データは集計的に送信されます。宛先サービスは、プロファイルサービスからのすべての受信データをアップストリームから取得し、Facebookにディスパッチする前に次のいずれかで集計します。

* レコード数（最大 10.000）または
* 期間間隔（30 分）

上記のしきい値のいずれかが最初に満たされたトリガーとFacebookへの書き出し。 では、 [!DNL Facebook Custom Audiences] ダッシュボードに追加すると、Experience Platformからのオーディエンスが 10.000 レコード増分で表示される場合があります。 データの処理と集計が 30 分の書き出し間隔よりも高速におこなわれ、送信も高速になるので、10 ～ 15 分ごとに 10.000 個のレコードが表示される場合があります。つまり、すべてのレコードが処理されるまで、約 10 ～ 15 分ごとです。 10.000 バッチを構成するレコードが不十分な場合、現在のレコード数は時間枠のしきい値を満たした時点のまま送信されるので、Facebookに送信される小さなバッチも表示される場合があります。

別の例として、 [HTTP API の宛先](/help/destinations/catalog/streaming/http-destination.md)( *[ベストエフォート集計](/help/destinations/destination-sdk/destination-configuration.md#best-effort-aggregation)* ポリシー、 `maxUsersPerRequest: 10`. つまり、この宛先に対する HTTP 呼び出しが実行される前に、最大 10 個のプロファイルが集計されます。ただし、Experience Platformは、送信先サービスがアップストリームサービスから更新された再評価情報を受け取るとすぐに、その宛先へのプロファイルのディスパッチを試みます。

集計ポリシーは設定可能で、宛先の開発者は、API エンドポイントのダウンストリームでのレート制限に最適に応じて、集計ポリシーを設定する方法を決定できます。 詳細を表示 [集計ポリシー](/help/destinations/destination-sdk/destination-configuration.md#aggregation) (Destination SDKドキュメント )

## ストリーミングプロファイルの書き出し（エンタープライズ）の宛先 {#streaming-profile-destinations}

>[!IMPORTANT]
>
> Enterprise Destinations は、次の場合にのみ使用できます。 [Adobe Real-time Customer Data Platform Ultimate](https://helpx.adobe.com/jp/legal/product-descriptions/real-time-customer-data-platform.html) 顧客。

この [企業の宛先](/help/destinations/destination-types.md#streaming-profile-export) のExperience Platformは、Amazon Kinesis、Azure Event Hubs、HTTP API です。

Experience Platformは、セグメントの選定やその他の重要なイベントの後にプロファイルに関連する更新が発生した場合にのみ、プロファイルの書き出し動作を最適化して、API エンドポイントに書き出します。 プロファイルは、次の状況で宛先に書き出されます。

* プロファイルの更新は、 [セグメントメンバーシップ](/help/xdm/field-groups/profile/segmentation.md) 宛先にマッピングされたセグメントの少なくとも 1 つに対して。 例えば、プロファイルは、宛先にマッピングされたいずれかのセグメントに適合しているか、宛先にマッピングされたいずれかのセグメントから退出しています。
* プロファイルの更新は、[ID マップ](/help/xdm/field-groups/profile/identitymap.md)の変更によって決定します。例えば、宛先にマッピングされたセグメントの 1 つに対して既に適合しているプロファイルの ID マップ属性に新しい ID が追加されたとします。
* プロファイルの更新は、宛先にマッピングされた属性のうち、少なくとも 1 つの属性が変更されたことで判断されました。例えば、マッピング手順で宛先にマッピングされた属性の 1 つがプロファイルに追加されます。

上記のすべての場合で、適切な更新が行われたプロファイルのみが宛先に書き出されます。例えば、宛先フローにマッピングされたセグメントに 100 人のメンバーがいて、5 つの新しいプロファイルがセグメントに適合している場合、宛先への書き出しは増分で行われ、5 つの新しいプロファイルのみが含まれます。

変更内容がどこにあっても、マッピングされたすべての属性がプロファイルに書き出されることに注意してください。 したがって、上の例では、属性自体が変更されていない場合でも、これら 5 つの新しいプロファイルに対してマッピングされた属性がすべて書き出されます。

### データの書き出しを決定する要素と、書き出しに含まれる内容

特定のプロファイルに対して書き出されるデータに関しては、 *エンタープライズの宛先へのデータ書き出しを決定する要素* および *エクスポートに含まれるデータ*.

| 宛先の書き出しを決定する要素 | 宛先の書き出しに含まれる内容 |
|---------|----------|
| <ul><li>マッピングされた属性とセグメントは、宛先の書き出しのキューとして機能します。 つまり、マッピングされたセグメントの状態（null から適合済みへ、適合済み／既存から離脱済みへ）が変更されたり、マッピングされた属性が更新された場合、宛先の書き出しが開始します。</li><li>ID は現在、エンタープライズの宛先にマッピングできないので、特定のプロファイルの ID の変更によって宛先の書き出しも決まります。</li><li>属性の変更は、同じ値であるかどうかに関わらず、属性に対する更新として定義されます。 つまり、値自体が変更されていない場合でも、属性の上書きは変更と見なされます。</li></ul> | <ul><li>この `segmentMembership` オブジェクトには、activation データフローにマッピングされたセグメントが含まれます。このセグメントのステータスは、認定またはセグメント終了イベントの後に変更されます。 これらのセグメントが同じに属する場合、プロファイルが書き出し先のエクスポートに含めることができる、マッピングされていない他のセグメント [結合ポリシー](/help/profile/merge-policies/overview.md) を activation データフローにマッピングされたセグメントとして追加しました。 </li><li>内のすべての ID `identityMap` オブジェクトも含まれます (Experience Platformは、現在、エンタープライズ宛先での id マッピングをサポートしていません )。</li><li>マッピングされた属性のみが宛先の書き出しに含まれます。</li></ul> |

{style=&quot;table-layout:fixed&quot;}

>[!IMPORTANT]
>
>宛先に対してプロファイルをアクティブ化する際に、エンタープライズの宛先は、データをバックフィルします。 つまり、宛先へのアクティベーションワークフローを設定した後の最初のデータエクスポートには、セグメントが宛先にマッピングされる前にアクティブ化されたセグメントに適合したプロファイルが含まれます。

>[!BEGINSHADEBOX]

例えば、HTTP 宛先に対するこのデータフローについて考えてみましょう。ここでは、3 つのセグメントがデータフローで選択され、4 つの属性が宛先にマッピングされます。

![enterprise destination dataflow](/help/destinations/assets/catalog/http/profile-export-example-dataflow.png)

宛先へのプロファイルの書き出しは、*3 つのマッピングされたセグメント*&#x200B;のいずれかに適合またはいずれかを離脱するプロファイルによって決定されます。ただし、データエクスポートでは、 `segmentMembership` オブジェクトの場合、その特定のプロファイルがメンバーであり、エクスポートをトリガーしたセグメントと同じ結合ポリシーを共有している場合は、その他のマッピングされていないセグメントが表示される可能性があります。 プロファイルが **DeLorean Cars を使用するお客様** セグメントに含まれますが、このセグメントは **「Back to the Future」の映画を観た** および **SF ファン** セグメントの場合、他の 2 つのセグメントも `segmentMembership` データエクスポートのオブジェクト（これらがデータフローで同じ結合ポリシーを共有している場合） **DeLorean Cars を使用するお客様** セグメント。

プロファイル属性の観点から、上記でマッピングした 4 つの属性に対する変更によって、書き出しの宛先が決定し、プロファイルに存在する 4 つのマッピング済み属性のいずれかがデータ書き出しに表示されます。

>[!ENDSHADEBOX]

>[!TIP]
>
> 様々な企業宛先に書き出されたデータの例は、 [Amazon Kinesis](/help/destinations/catalog/cloud-storage/amazon-kinesis.md#exported-data), [Azure イベントハブ](/help/destinations/catalog/cloud-storage/azure-event-hubs.md#exported-data)、および [HTTP API](/help/destinations/catalog/streaming/http-destination.md#exported-data) 宛先のドキュメントページ。

## ストリーミング API ベースの宛先 {#streaming-api-based-destinations}

facebook、トレードデスク、その他の API ベースの統合などのストリーミング先に対するプロファイルの書き出し動作は、前述の企業の宛先に対する動作と非常に似ています。

ストリーミング先の例としては、 [ソーシャルおよび広告のカテゴリ](/help/destinations/destination-types.md#categories) をカタログに追加します。

Experience Platformは、セグメント認定または他の重要なイベントに続いてプロファイルに関連する更新が発生した場合にのみ、ストリーミング API ベースの宛先にデータを書き出すように、プロファイルの書き出し動作を最適化します。 プロファイルは、次の状況で宛先に書き出されます。

* プロファイルの更新は、 [セグメントメンバーシップ](/help/xdm/field-groups/profile/segmentation.md) 宛先にマッピングされたセグメントの少なくとも 1 つに対して。 例えば、プロファイルは、宛先にマッピングされたいずれかのセグメントに適合しているか、宛先にマッピングされたいずれかのセグメントから退出しています。
* プロファイルの更新は、 [id マップ](/help/xdm/field-groups/profile/identitymap.md) この宛先インスタンス用に書き出し用にマークされた id 名前空間の場合。 例えば、宛先にマッピングされたセグメントの 1 つに対して既に適合しているプロファイルの ID マップ属性に新しい ID が追加されたとします。
* プロファイルの更新は、宛先にマッピングされた属性のうち、少なくとも 1 つの属性が変更されたことで判断されました。例えば、マッピング手順で宛先にマッピングされた属性の 1 つがプロファイルに追加されます。
* 自動同意実施が設定され、プロファイルがオプトアウトすると、プロファイルに対する同意の変更がおこなわれます。 自動同意実施により、オーディエンスが終了イベントが宛先に送信されるので、プロファイルが宛先のターゲティングに含まれなくなります。

上記のすべての場合で、適切な更新が行われたプロファイルのみが宛先に書き出されます。例えば、宛先フローにマッピングされたセグメントに 100 人のメンバーがいて、5 つの新しいプロファイルがセグメントに適合している場合、宛先への書き出しは増分で行われ、5 つの新しいプロファイルのみが含まれます。

変更内容がどこにあっても、マッピングされたすべての属性がプロファイルに書き出されることに注意してください。 したがって、上の例では、属性自体が変更されていない場合でも、これら 5 つの新しいプロファイルに対してマッピングされた属性がすべて書き出されます。

### データの書き出しを決定する要素と、書き出しに含まれる内容

特定のプロファイルに対して書き出されるデータに関しては、ストリーミング API の宛先へのデータ書き出しを決定するものと、書き出しに含まれるデータの 2 つの異なる概念を理解することが重要です。

| 宛先の書き出しを決定する要素 | 宛先の書き出しに含まれる内容 |
|---------|----------|
| <ul><li>マッピングされた属性とセグメントは、宛先の書き出しのキューとして機能します。 つまり、マッピングされたセグメントの状態（null から適合済みへ、適合済み／既存から離脱済みへ）が変更されたり、マッピングされた属性が更新された場合、宛先の書き出しが開始します。</li><li>ID マップの変更は、 [ID グラフ](/help/identity-service/ui/identity-graph-viewer.md) プロファイルの（書き出し用にマッピングされる id 名前空間）。</li><li>属性の変更は、宛先にマッピングされている属性の、属性の更新として定義されます。</li></ul> | <ul><li>宛先にマッピングされ、変更されたセグメントは、 `segmentMembership` オブジェクト。 シナリオによっては、複数の呼び出しを使用して書き出される場合があります。 また、一部のシナリオでは、変更されていないセグメントが呼び出しに含まれる場合もあります。 いずれの場合も、マッピングされたセグメントのみが書き出されます。</li><li>の宛先にマッピングされている名前空間のすべての ID `identityMap` オブジェクトも含まれます。</li><li>マッピングされた属性のみが宛先の書き出しに含まれます。</li></ul> |

{style=&quot;table-layout:fixed&quot;}

>[!IMPORTANT]
>
>Streaming API の宛先は、宛先に対してプロファイルをアクティブ化する際に、データをバックフィルします。 つまり、宛先へのアクティベーションワークフローを設定した後の最初のデータエクスポートには、セグメントが宛先にマッピングされる前にアクティブ化されたセグメントに適合したプロファイルが含まれます。

>[!BEGINSHADEBOX]

例えば、このデータフローを、データフローで 3 つのセグメントが選択されるストリーミング先に対して考えてみましょう。

![ストリーミング先のデータフロー](/help/destinations/assets/how-destinations-work/streaming-destination-example-dataflow.png)

宛先へのプロファイルの書き出しは、3 つのマッピングされたセグメントのいずれかに適合またはいずれかを離脱するプロファイルによって決定されます。プロファイルが **DeLorean Cars を使用するお客様** セグメントの場合は、書き出しをトリガーにします。 その他のセグメント (**市区町村 — ダラス** および **基本サイトアクティブ**) は、プロファイルに、考えられるステータス (`realized`, `existing`, `exited`) をクリックします。 マッピングされていないセグメント ( **SF ファン**) は書き出されません。

プロファイル属性の観点から、上でマッピングした 3 つの属性に対する変更は、書き出し先を決定します。

>[!ENDSHADEBOX]

## バッチ（ファイルベース）宛先 {#file-based-destinations}

プロファイルをに書き出す場合 [ファイルベースの宛先](/help/destinations/destination-types.md#file-based) Experience Platformには、次の 3 種類のスケジュール（以下に示す）と 2 つのファイル書き出しオプション（完全または増分ファイル）があり、これらを使用できます。 複数のセグメントが単一の宛先データフローにマッピングされている場合でも、これらの設定はすべてセグメントレベルで設定されます。

* スケジュールされた書き出し：宛先を設定し、1 つ以上のセグメントを追加し、ファイルを 1 日に 1 回または 1 日に複数回エクスポートする場合は「 」を選択し、ファイルをエクスポートする場合は「 」を選択します。 例えば、書き出しに 5 時間を指定した場合、そのセグメントに適合するプロファイルはどちらも午後 5 時に書き出されます。
* セグメント評価後：書き出しは、毎日のセグメント評価ジョブが実行された直後にトリガーされます。 つまり、ファイルに書き出されたプロファイルの数は、セグメントの最新の評価済み母集団にできる限り近くなります。
* オンデマンドエクスポート ([ファイルを今すぐ書き出し](/help/destinations/ui/export-file-now.md)):最新のセグメント評価ジョブに基づいて、定期的にスケジュールされたエクスポートに加えて、完全なファイルが 1 回だけエクスポートされます。

上記のエクスポート状況では、エクスポートファイルに、エクスポートの対象として選択した列と共に、エクスポートの対象として認定されたプロファイルが含まれます。

>[!TIP]
>
>ストリーミングセグメントがバッチ保存先にマッピングされる場合、書き出されるファイルのプロファイル数がセグメント内のユーザー数に近くなる可能性が高くなります。 これは、最新のセグメント評価が書き出し時間に近づく可能性が高いからです。

### 増分ファイルの書き出し {#incremental-file-exports}

プロファイルのすべての更新で、増分ファイルエクスポートに含まれるとは限りません。 例えば、属性がプロファイルに追加またはプロファイルから削除された場合は、書き出しにプロファイルが含まれません。 次の条件を満たすプロファイルのみ： `segmentMembership` 属性が変更された場合、書き出されたファイルに含まれます。 つまり、プロファイルがセグメントの一部になった場合、またはセグメントから削除された場合にのみ、増分ファイルの書き出しに含まれます。

同様に、新しい ID（新しい電子メールアドレス、電話番号、ECID など）が [ID グラフ](/help/identity-service/ui/identity-graph-viewer.md)は、プロファイルを新しい増分ファイル書き出しに含める理由を表すものではありません。

宛先マッピングに新しいセグメントが追加された場合、は別のセグメントの資格およびエクスポートには影響しません。 書き出しスケジュールは、セグメントごとに個別に設定され、セグメントが同じ宛先データフローに追加されている場合でも、セグメントごとにファイルが個別に書き出されます。

>[!BEGINSHADEBOX]

例えば、以下の図で、セグメントが増分ファイル更新をエクスポートするエクスポート設定では、プロファイルが増分ファイルエクスポートに含まれるかどうかに関する次の状況に注意してください。

![選択した複数の属性を含む設定を書き出す。](/help/destinations/assets/how-destinations-work/export-selection-batch-destination.png)

* プロファイルは、セグメントを認定または不承認する際に、増分ファイルエクスポートに含まれます。
* プロファイルは *not* 新しい電話番号が id グラフに追加された際に、増分ファイルの書き出しに含まれます。
* プロファイルは *not* 増分ファイル書き出しに含まれる（などのマッピングされた XDM フィールドの値が使用される場合） `xdm: loyalty.points`, `xdm: loyalty.tier`, `xdm: personalEmail.address` は、プロファイルで更新されます。
* 常に `segmentMembership.status` XDM フィールドが宛先のアクティベーションワークフローにマッピングされ、セグメントからのプロファイルも、書き出された増分ファイルに含まれます ( `exited` ステータス。

>[!ENDSHADEBOX]

### データの書き出しを決定する要素と、書き出しに含まれる内容

上記の節の情報に基づいて、次に示すように、ファイルベースの宛先へのプロファイルの書き出し動作を要約できます。

**完全なファイルエクスポート**

セグメントの完全なアクティブな母集団は、毎日エクスポートされます。

| 宛先の書き出しを決定する要素 | エクスポートされたファイルに含まれる内容 |
|---------|----------|
| <ul><li>UI または API で設定された書き出しスケジュールとユーザーアクション ( [ファイルを今すぐ書き出し](/help/destinations/ui/export-file-now.md) UI または [アドホックアクティベーション API](/help/destinations/api/ad-hoc-activation-api.md)) によって、宛先の書き出しの開始を決定します。</li><li>プロファイルのセグメントメンバーシップに加えられた変更（セグメントに適合するか不適合かに関わらず）により、増分エクスポートに含めるプロファイルが認定されます。</li></ul> | フルファイルエクスポートでは、最新のセグメント評価に基づいて、セグメントのアクティブなプロファイル母集団全体が各ファイルエクスポートに含まれます。 書き出し用に選択した各 XDM 属性の最新の値も、各ファイルの列として含まれます。 「終了」ステータスのプロファイルは、ファイルのエクスポートには含まれません。 |

{style=&quot;table-layout:fixed&quot;}

**増分ファイルの書き出し**

アクティベーションワークフローを設定した後の最初のファイルの書き出しでは、セグメントの母集団全体が書き出されます。 その後の書き出しでは、変更されたプロファイルのみが書き出されます。

| 宛先の書き出しを決定する要素 | エクスポートされたファイルに含まれる内容 |
|---------|----------|
| <ul><li>UI または API で設定された書き出しスケジュールによって、宛先の書き出しの開始が決まります。</li><li>プロファイルのセグメントメンバーシップに加えられた変更（セグメントに適合するか不適合かに関わらず）により、増分エクスポートに含めるプロファイルが認定されます。 プロファイルの属性または ID マップの変更 *しない* 増分エクスポートに含めるプロファイルを指定します。</li></ul> | <p>セグメントのメンバーシップが変更されたプロファイルと、書き出し用に選択された各 XDM 属性の最新情報。</p><p>宛先の書き出しには、「終了」ステータスを持つプロファイルが含まれます ( `segmentMembership.status` マッピング手順で XDM フィールドが選択されます。</p> |

{style=&quot;table-layout:fixed&quot;}

>[!TIP]
>
>プロファイルの属性値または ID マップでの変更は、増分ファイルの書き出しに含まれるとは限りません。

## 次の手順 {#next-steps}

このドキュメントを読むと、ストリーミング、エンタープライズ、ファイルベースの宛先へのプロファイル書き出しに何が表示されるかがわかります。

次に、 [ID は処理されます](/help/destinations/how-destinations-work/identity-handling.md) （アクティベーションワークフロー内）
