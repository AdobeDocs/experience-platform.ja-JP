---
title: プロファイルの書き出し動作
description: Experience Platform の宛先でサポートされている様々な統合パターン間でプロファイル書き出し動作がどのように異なるかを説明します。
exl-id: 2be62843-0644-41fa-a860-ccd65472562e
source-git-commit: e6545dfaf5c43ac854986cfdc4f5cb153a07405b
workflow-type: tm+mt
source-wordcount: '2924'
ht-degree: 60%

---

# 様々な宛先タイプのプロファイル書き出し動作

Experience Platform には複数の宛先タイプがあります（下図を参照）。これらの宛先は、後の節で説明するように、宛先の書き出しをトリガーするものと書き出しに含まれる内容に関して、書き出しパターンが少し異なります。

>[!IMPORTANT]
>
>このドキュメントページでは、図の下部でハイライト表示されている接続の場合のプロファイル書き出し動作についてのみ説明します。

![宛先のタイプを示す図](/help/destinations/assets/how-destinations-work/types-of-destinations-v4.png)

## ストリーミング宛先でのメッセージの集計

宛先タイプごとの特定の情報を調べる前に、次のメッセージを集計する概念を理解しておくことが重要です。 *ストリーミングの宛先*.

Experience Platform の宛先では、データを HTTPS 呼び出しとして API ベースの統合機能に書き出します。バッチ取り込み、ストリーミング取り込み、バッチセグメント化、ストリーミングセグメント化または ID グラフの変更の結果、プロファイルが更新されたことを宛先サービスが他のアップストリームサービスから通知されると、データが書き出され、ストリーミング宛先に送信されます。

プロファイルは、宛先 API エンドポイントにディスパッチされる前に、HTTPS メッセージに集計されます。

例えば、*[設定可能な集計](../destination-sdk/functionality/destination-configuration/aggregation-policy.md)*&#x200B;ポリシーを持つ [Facebook 宛先](/help/destinations/catalog/social/facebook.md)の場合、データは、集計されて送信されますが、その際に、宛先サービスは、プロファイルサービスアップストリームから受信するすべてのデータを取得し、それを以下のいずれかで集計してから、Facebook にディスパッチします。

* レコード数（最大 10,000 件）または
* 時間枠の間隔（300 秒）

上記のしきい値のいずれかに初めて達したときに、Facebook への書き出しがトリガーされます。そのため、[!DNL Facebook Custom Audiences] ダッシュボードには、Experience Platform からオーディエンスが 10,000 件の増分で取り込まれることがあります。データの処理と集計が 300 秒の書き出し間隔よりも高速におこなわれ、送信も高速になるので、2 ～ 3 分ごとに 10,000 件のレコードが表示される場合があります。つまり、すべてのレコードが処理されるまで、約 2 ～ 3 分ごとにです。 10,000 件から成るバッチを構成できるだけの十分なレコードがない場合は、期間のしきい値に達した時点で現在のレコード数がそのまま送信されます。これにより、より小さなバッチが Facebook に送信される場合もあります。

別の例として、[HTTP API 宛先](/help/destinations/catalog/streaming/http-destination.md)について考えます。この場合は、*[ベストエフォート集計](../destination-sdk/functionality/destination-configuration/aggregation-policy.md)*&#x200B;ポリシーと `maxUsersPerRequest: 10` の条件が適用されます。つまり、最大 10 個のプロファイルが集計されてから、この宛先に対する HTTP 呼び出しが実行されます。ただし、Experience Platform は、更新された再評価情報を宛先サービスがアップストリームサービスから受け取るとすぐに、宛先へのプロファイルのディスパッチを試みます。

集計ポリシーは設定可能で、宛先の開発者が、API エンドポイントのダウンストリームでのレート制限に最もよく合うように集計ポリシーを設定する方法を決定できます。詳しくは、Destination SDK のドキュメントで[集計ポリシー](../destination-sdk/functionality/destination-configuration/aggregation-policy.md)を参照してください。

## ストリーミングプロファイル書き出し宛先（エンタープライズ宛先） {#streaming-profile-destinations}

>[!IMPORTANT]
>
> エンタープライズ宛先を使用できるのは、[Adobe Real-time Customer Data Platform Ultimate](https://helpx.adobe.com/jp/legal/product-descriptions/real-time-customer-data-platform.html) のお客様だけです。

Experience Platform の[エンタープライズ宛先](/help/destinations/destination-types.md#streaming-profile-export)は、Amazon Kinesis、Azure Event Hubs および HTTP API です。

Experience Platformは、オーディエンスの選定やその他の重要なイベントに従ってプロファイルに関連する更新がおこなわれた場合にのみ、プロファイルの書き出し動作を最適化して API エンドポイントに書き出します。 プロファイルは、以下の状況で宛先に書き出されます。

* プロファイルの更新は、 [オーディエンスメンバーシップ](/help/xdm/field-groups/profile/segmentation.md) 宛先にマッピングされた 1 つ以上のオーディエンスに対して。 例えば、プロファイルが宛先にマッピングされた 1 つのオーディエンスの対象として認定されたか、宛先にマッピングされた 1 つのオーディエンスから出たとします。
* プロファイルの更新は、[ID マップ](/help/xdm/field-groups/profile/identitymap.md)の変更によって決定します。例えば、宛先にマッピングされたオーディエンスの 1 つに対して既に資格を持っているプロファイルが、ID マップ属性に新しい ID として追加されたとします。
* プロファイルの更新は、宛先にマッピングされた属性のうち、少なくとも 1 つの属性が変更されたことで判断されました。例えば、マッピング手順で宛先にマッピングされた属性の 1 つがプロファイルに追加されます。

上記のすべての場合で、適切な更新が行われたプロファイルのみが宛先に書き出されます。例えば、宛先フローにマッピングされたオーディエンスのメンバーが 100 人で、5 つの新しいプロファイルがセグメントに認定された場合、宛先への書き出しは増分で、5 つの新しいプロファイルのみが含まれます。

プロファイルについては、変更箇所に関わらず、マッピングされたすべての属性が書き出されることに注意してください。したがって、上の例では、属性自体が変更されていない場合でも、これら 5 つの新しいプロファイルに対してマッピングされた属性がすべて書き出されます。

### データの書き出しを決定する要素と、書き出しに含まれる内容

特定のプロファイルについて書き出されるデータに関しては、*エンタープライズ宛先へのデータ書き出しを決定する要因*&#x200B;と&#x200B;*書き出しに含まれるデータ*&#x200B;という 2 つの異なる概念を理解しておくことが重要です。

| 宛先の書き出しを決定する要素 | 宛先の書き出しに含まれる内容 |
|---------|----------|
| <ul><li>マッピングされた属性とオーディエンスは、宛先の書き出しのキューとなります。 つまり、マッピングされたオーディエンスが ( `null` から `realized` またはから `realized` から `exiting`) またはマッピングされた属性が更新されると、宛先の書き出しがキックオフされます。</li><li>現在 ID はエンタープライズ宛先にマッピングできないので、特定のプロファイルの ID が変わると、宛先の書き出しも決まります。</li><li>属性の変更は、同じ値であるかどうかに関わらず、属性に対する更新として定義されます。つまり、値自体が変更されていない場合でも、属性の上書きは変更と見なされます。</li></ul> | <ul><li>The `segmentMembership` オブジェクトには、activation データフローにマッピングされたオーディエンスが含まれます。このオーディエンスに対して、認定またはオーディエンスの終了イベント後にプロファイルのステータスが変更されます。 これらのオーディエンスが同じに属する場合、そのプロファイルが書き出し先のエクスポートに含めることができる、マッピングされていないオーディエンスが他にも存在することに注意してください [結合ポリシー](/help/profile/merge-policies/overview.md) activation データフローにマッピングされたオーディエンスとして。 </li><li>`identityMap` オブジェクト内のすべての ID も含まれます（Experience Platform では現在、エンタープライズ宛先での ID マッピングをサポートしていません）。</li><li>マッピングされた属性のみが宛先の書き出しに含まれます。</li></ul> |

{style="table-layout:fixed"}

>[!IMPORTANT]
>
>エンタープライズ宛先は、プロファイルを宛先に対してアクティブ化する際に、バックフィルデータをストリーミングします。つまり、宛先へのアクティベーションワークフローを設定した後の最初のデータエクスポートには、オーディエンスが宛先にマッピングされる前にアクティブ化されたオーディエンスに適合したプロファイルが含まれます。

>[!BEGINSHADEBOX]

例えば、このデータフローを HTTP 宛先に対して考えてみましょう。この宛先では、3 つのオーディエンスがデータフローで選択され、4 つの属性が宛先にマッピングされます。

![エンタープライズ宛先のデータフロー](/help/destinations/assets/catalog/http/profile-export-example-dataflow.png)

宛先へのプロファイルの書き出しは、*3 つのマッピングされたセグメント*&#x200B;のいずれかに適合またはいずれかを離脱するプロファイルによって決定されます。ただし、データエクスポートでは、 `segmentMembership` オブジェクトの場合、その特定のプロファイルがメンバーであり、書き出しをトリガーしたオーディエンスと同じ結合ポリシーを共有している場合は、他のマッピングされていないオーディエンスが表示される可能性があります。 プロファイルが **DeLorean Cars を使用するお客様** オーディエンスに加えて、 **「Back to the Future」の映画を観た** および **SF ファン** セグメントの場合、他の 2 つのオーディエンスも `segmentMembership` データエクスポートのオブジェクト（これらがデータフローで同じ結合ポリシーを共有している場合） **DeLorean Cars を使用するお客様** セグメント。

プロファイル属性の観点から、上記でマッピングした 4 つの属性に対する変更によって、書き出しの宛先が決定し、プロファイルに存在する 4 つのマッピング済み属性のいずれかがデータ書き出しに表示されます。

>[!ENDSHADEBOX]

>[!TIP]
>
> [Amazon Kinesis](/help/destinations/catalog/cloud-storage/amazon-kinesis.md#exported-data)、[Azure Event Hubs](/help/destinations/catalog/cloud-storage/azure-event-hubs.md#exported-data) および [HTTP API](/help/destinations/catalog/streaming/http-destination.md#exported-data) の宛先ドキュメントページで、様々なエンタープライズ宛先に書き出されたデータの例を確認できます。

## ストリーミング API ベースの宛先 {#streaming-api-based-destinations}

Facebook、Trade Desk およびその他の API ベースの統合などのストリーミング宛先のプロファイルの書き出しの動作は、上記のエンタープライズ宛先の動作と非常によく似ています。

ストリーミング宛先の例としては、カタログの[ソーシャルカテゴリと広告カテゴリ](/help/destinations/destination-types.md#categories)に属する宛先があります。

Experience Platformは、オーディエンス資格認定やその他の重要なイベントによりプロファイルに関連する更新が発生した場合にのみ、ストリーミング API ベースの宛先にデータを書き出すように、プロファイルの書き出し動作を最適化します。 プロファイルは、以下の状況で宛先に書き出されます。

* プロファイルの更新は、 [オーディエンスメンバーシップ](/help/xdm/field-groups/profile/segmentation.md) 宛先にマッピングされた 1 つ以上のオーディエンスに対して。 例えば、プロファイルが宛先にマッピングされた 1 つのオーディエンスの対象として認定されたか、宛先にマッピングされた 1 つのオーディエンスから出たとします。
* この宛先インスタンスの書き出し用にマークされた ID 名前空間の [ID マップ](/help/xdm/field-groups/profile/identitymap.md)の変更によって、プロファイルの更新が決定された場合。例えば、宛先にマッピングされたオーディエンスの 1 つに対して既に資格を持っているプロファイルが、ID マップ属性に新しい ID として追加されたとします。
* プロファイルの更新は、宛先にマッピングされた属性のうち、少なくとも 1 つの属性が変更されたことで判断されました。例えば、マッピング手順で宛先にマッピングされた属性の 1 つがプロファイルに追加されます。
* 同意の自動適用を設定し、プロファイルがオプトアウトされると、プロファイルの同意が変更される場合。同意の自動適用により、オーディエンスが終了したイベントが宛先に送信されるので、プロファイルが宛先のターゲティングに含まれません。

上記のすべての場合で、適切な更新が行われたプロファイルのみが宛先に書き出されます。例えば、宛先フローにマッピングされたオーディエンスのメンバーが 100 人で、5 つの新しいプロファイルがセグメントに認定された場合、宛先への書き出しは増分で、5 つの新しいプロファイルのみが含まれます。

プロファイルについては、変更箇所に関わらず、マッピングされたすべての属性が書き出されることに注意してください。したがって、上の例では、属性自体が変更されていない場合でも、これら 5 つの新しいプロファイルに対してマッピングされた属性がすべて書き出されます。

### データの書き出しを決定する要素と、書き出しに含まれる内容

特定のプロファイルに対して書き出されるデータに関しては、ストリーミング API 宛先へのデータ書き出しを決定する要素、および書き出しに含まれるデータという 2 つの異なる概念を理解することが重要です。

| 宛先の書き出しを決定する要素 | 宛先の書き出しに含まれる内容 |
|---------|----------|
| <ul><li>マッピングされた属性とオーディエンスは、宛先の書き出しのキューとなります。 つまり、マッピングされたオーディエンスが ( `null` から `realized` またはから `realized` から `exiting`) またはマッピングされた属性が更新されると、宛先の書き出しがキックオフされます。</li><li>ID マップの変更は、プロファイルの [ID グラフ](/help/identity-service/ui/identity-graph-viewer.md)、書き出し用にマッピングされた ID 名前空間に対して追加／削除される ID として定義されます。</li><li>属性の変更は、宛先にマッピングされている属性の場合、属性に対する更新として定義されます。</li></ul> | <ul><li>宛先にマッピングされ、変更されたオーディエンスが `segmentMembership` オブジェクト。 シナリオによっては、複数の呼び出しを使用して書き出される場合があります。また、シナリオによっては、変更されていないオーディエンスも呼び出しに含まれる場合があります。 いずれの場合も、マッピングされたオーディエンスのみが書き出されます。</li><li>同じように、`identityMap` オブジェクトで宛先にマッピングされた名前空間からの ID もすべて含まれます。</li><li>マッピングされた属性のみが宛先の書き出しに含まれます。</li></ul> |

{style="table-layout:fixed"}

>[!IMPORTANT]
>
>ストリーミング API の宛先は、プロファイルを宛先に対してアクティブ化する際に、バックフィルデータをストリーミングします。つまり、宛先へのアクティベーションワークフローを設定した後の最初のデータエクスポートには、オーディエンスが宛先にマッピングされる前にアクティブ化されたオーディエンスに適合したプロファイルが含まれます。

>[!BEGINSHADEBOX]

例えば、このデータフローを、データフローで 3 つのオーディエンスが選択されるストリーミング先に対して考えてみましょう。

![ストリーミング宛先のデータフロー](/help/destinations/assets/how-destinations-work/streaming-destination-example-dataflow.png)

宛先へのプロファイルの書き出しは、3 つのマッピングされたセグメントのいずれかに適合またはいずれかを離脱するプロファイルによって決定されます。プロファイルが「**デロリアンを保有している顧客**」セグメントに適合している場合、これにより書き出しがトリガーされます。他のオーディエンス (**市区町村 — ダラス** および **基本サイトアクティブ**) は、プロファイルに、そのオーディエンスが次のいずれかのステータス (`realized` または `exited`) をクリックします。 マッピングされていないオーディエンス ( 例： **SF ファン**) は書き出されません。

プロファイル属性の観点から、上記でマッピングされた 3 つの属性を変更すると、書き出し先が決定します。

>[!ENDSHADEBOX]

## バッチ（ファイルベース）の宛先 {#file-based-destinations}

Experience Platform の[ファイルベースの宛先](/help/destinations/destination-types.md#file-based)にプロファイルを書き出す場合、3 種類のスケジュール（以下に示す）と 2 つのファイル書き出しオプション（完全ファイルまたは増分ファイル）を使用できます。複数のオーディエンスが単一の宛先データフローにマッピングされている場合でも、これらの設定はすべてオーディエンスレベルで設定されます。

* スケジュールされた書き出し：宛先を設定し、1 つ以上のセグメントを追加し、完全ファイルまたは増分ファイルを書き出すかどうかを選択し、ファイルを書き出す時刻を毎日または 1 日に数回選択します。例えば、書き出しに 5 時間を指定した場合、オーディエンスに適合するプロファイルはどちらでも、午後 5 時に書き出されます。
* セグメント評価の後：書き出しは、毎日のオーディエンス評価ジョブが実行された直後にトリガーされます。 つまり、ファイルに書き出されたプロファイルの数は、セグメントの最新の評価済み母集団にできる限り近くなります。
* オンデマンドエクスポート ([ファイルを今すぐ書き出し](/help/destinations/ui/export-file-now.md))：最新のオーディエンス評価ジョブに基づいて、定期的にスケジュールされたエクスポートに加えて、完全なファイルが 1 回限り書き出されます。

上記の書き出し状況のいずれにおいても、書き出し対象の XDM 属性として選択した列と共に、書き出しに適合したプロファイルが書き出しファイルに含まれます。

>[!TIP]
>
>ストリーミングオーディエンスがバッチ保存先にマッピングされる場合、書き出されるファイルのプロファイル数がセグメント内のユーザー数に近くなる可能性が高くなります。 これは、最新のオーディエンス評価が書き出し時間に近づく可能性が高いからです。

### 増分ファイルの書き出し {#incremental-file-exports}

プロファイルのすべてのアップデートが、プロファイルを増分ファイルの書き出しに含めることに適合しているわけではありません。例えば、属性がプロファイルに追加またはプロファイルから削除された場合、そのプロファイルは書き出しに含まれません。書き出されたファイルには、`segmentMembership` 属性が変更されたプロファイルのみが含まれます。つまり、プロファイルがオーディエンスの一部になった場合、またはオーディエンスから削除された場合にのみ、増分ファイルの書き出しに含まれます。

同様に、新しい ID（新しいメールアドレス、電話番号、ECID など）が [ID グラフ](/help/identity-service/ui/identity-graph-viewer.md)のプロファイルに追加された場合、そのプロファイルを新しい増分ファイルの書き出しに含める理由にはなりません。

宛先マッピングに新しいオーディエンスが追加された場合、は別のセグメントの資格および書き出しには影響しません。 エクスポートスケジュールは、オーディエンスごとに個別に設定され、同じ宛先データフローにオーディエンスが追加されている場合でも、セグメントごとにファイルが個別にエクスポートされます。

>[!BEGINSHADEBOX]

例えば、以下の図に示す書き出し設定では、オーディエンスが増分ファイル更新を書き出しています。次の場合は、プロファイルが増分ファイル書き出しに含まれているかどうかに注意してください。

![複数の属性を選択した設定の書き出し。](/help/destinations/assets/how-destinations-work/export-selection-batch-destination.png)

* プロファイルは、セグメントに適合または不適合な場合、増分ファイルの書き出しに含まれます。
* 新しい電話番号が ID グラフに追加されると、プロファイルは増分ファイルの書き出しに含まれま&#x200B;*せん*。
* `xdm: loyalty.points`、`xdm: loyalty.tier`、`xdm: personalEmail.address` などのマッピングされた XDM フィールドのいずれかの値がプロファイルで更新された場合、プロファイルは増分ファイルの書き出しに含まれま&#x200B;*せん*。
* 常に `segmentMembership.status` XDM フィールドは宛先のアクティベーションワークフローにマッピングされ、オーディエンスから退出するプロファイルも、書き出された増分ファイルに含まれます。 `exited` ステータス。

>[!ENDSHADEBOX]

### データの書き出しを決定する要素と、書き出しに含まれる内容

上記の節の情報に基づいて、ファイルベースの宛先へのプロファイルの書き出し動作は、以下のように要約できます。

**ファイル全体の書き出し**

オーディエンスの完全なアクティブな母集団は、毎日エクスポートされます。

| 宛先の書き出しを決定する要素 | 書き出されたファイルに含まれる内容 |
|---------|----------|
| <ul><li>UI または API で設定された書き出しスケジュールとユーザーアクション（UI で「[ファイルを今すぐ書き出し](/help/destinations/ui/export-file-now.md)」を選択するか、[アドホックアクティベーション API](/help/destinations/api/ad-hoc-activation-api.md) を使用すること）によって、宛先の書き出しの開始が決定します。</li></ul> | ファイルの完全なエクスポートでは、最新のオーディエンス評価に基づいて、セグメントのアクティブなプロファイル母集団全体が各ファイルのエクスポートに含まれます。 書き出し用に選択された各 XDM 属性の最新の値も、各ファイルの列として含まれます。なお、離脱済みステータスのプロファイルはファイルの書き出しには含まれません。 |

{style="table-layout:fixed"}

**増分ファイルの書き出し**

アクティベーションワークフローの設定後の最初のファイルの書き出しでは、オーディエンスの母集団全体が書き出されます。 以降の書き出しでは、変更されたプロファイルのみが書き出されます。

| 宛先の書き出しを決定する要素 | 書き出されたファイルに含まれる内容 |
|---------|----------|
| <ul><li>UI または API で設定された書き出しスケジュールによって、宛先の書き出しの開始が決定します。</li><li>プロファイルのオーディエンスメンバーシップに変更があった場合、それがセグメントに適合したか失格したかに関わらず、増分エクスポートに含まれるプロファイルが認定されます。 プロファイルの属性または ID マップを変更しても、増分書き出しに含まれるプロファイルが適合されること&#x200B;*はありません*。</li></ul> | <p>オーディエンスのメンバーシップが変更されたプロファイルと、書き出し用に選択された各 XDM 属性の最新情報。</p><p>`segmentMembership.status` XDM フィールドがマッピングステップで選択されている場合、離脱済みステータスのプロファイルは宛先の書き出しに含まれます。</p> |

{style="table-layout:fixed"}

>[!TIP]
>
>プロファイルの属性値または ID マップを変更しても、増分ファイルの書き出しに含まれるプロファイルが適合されることはありません。

## 次の手順 {#next-steps}

このドキュメントでは、ストリーミング宛先、エンタープライズ宛先およびファイルベースの宛先へのプロファイルの書き出しで表示される内容を確認しました。

次に、アクティベーションワークフローでどのように [ID が処理](/help/destinations/how-destinations-work/identity-handling.md)されるかについて説明します。
