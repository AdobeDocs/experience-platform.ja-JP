---
keywords: Experience Platform;home;popular topics
solution: Experience Platform
title: Adobe Experience Platform Batch Ingestionトラブルシューティングガイド
topic: troubleshooting
translation-type: tm+mt
source-git-commit: 79466c78fd78c0f99f198b11a9117c946736f47a

---


# バッチ取り込みのトラブルシューティングガイド

このドキュメントは、Adobe Experience Platform Batch Data Ingestion APIに関するよくある質問に答えるのに役立ちます。

## バッチAPI呼び出し

### バッチは、CompleteBatch APIからHTTP 200 OKを受け取った後すぐにアクティブになりますか。

APIか `200 OK` らの応答は、バッチの処理が受け入れられたことを意味します。バッチは、「アクティブ」や「失敗」などの最終状態にトランジションするまでアクティブになりません。

### 失敗した後でCompleteBatch API呼び出しを再試行しても問題はありませんか。

はい — API呼び出しを再試行しても安全です。 失敗したにもかかわらず、操作が実際に成功し、バッチが正常に受け入れられた可能性があります。 ただし、APIに障害が発生した場合は、クライアントに再試行メカニズムが必要となり、実際には再試行を推奨します。 操作が実際に成功した場合、APIは再試行後も成功を返します。

### 大きいファイルのアップロードAPIは、いつ使用する必要がありますか。

Large File Upload APIを使用する場合の推奨ファイルサイズは256 MB以上です。 大きいファイルのアップロードAPIの使用方法について詳しくは、こちらを参照して [くださ](./api-overview.md#ingest-large-parquet-files)い。

### Large File Complete API呼び出しが失敗するのはなぜですか。

大きなファイルのチャンクが重なっているか、見つからない場合、サーバーはHTTP 400 Bad Requestを返します。 これは、ファイルチャンクが繋がり合わされる際に、範囲検証がファイルの完了時に行われるので、重なり合うチャンクをアップロードできる場合があるためです。

## インジェストのサポート

### サポートされている取り込み形式は何ですか。

現在、ParquetとJSONの両方がサポートされています。 CSVはレガシーベースでサポートされています。データはマスターに昇格され、事前確認が行われますが、コンバージョン、パーティション化、行の検証などの最新の機能はサポートされません。

### バッチ入力形式を指定する場所

入力形式は、ペイロード内でのバッチ作成時に指定する必要があります。 バッチ入力形式の指定方法の例を次に示します。

```shell
curl -X POST "https://platform.adobe.io/data/foundation/import/batches" \
  -H "accept: application/json" \
  -H "x-gw-ims-org-id: {IMS_ORG}" \
  -H "Authorization: Bearer {ACCESS_TOKEN}" \
  -H "x-api-key : {API_KEY}"
  -d '{
          "datasetId": "{DATASET_ID}",
           "inputFormat": {
                "format": "json"
           }
    }'
```

### 複数行のJSONはどのように取り込まれますか。

複数行のJSONを取り込むには、バッ `isMultiLineJson` チ作成時にフラグを設定する必要があります。 この例を次に示します。

```shell
curl -X POST "https://platform.adobe.io/data/foundation/import/batches" \
  -H "accept: application/json" \
  -H "x-gw-ims-org-id: {IMS_ORG}" \
  -H "Authorization: Bearer {ACCESS_TOKEN}" \
  -H "x-api-key : {API_KEY}"
  -d '{
          "datasetId": "{DATASET_ID}",
           "inputFormat": {
                "format": "json",
                "isMultiLineJson": true
           }
      }'
```

### JSON行（1行JSON）と複数行JSONの違いは何ですか。

JSON行の場合、1行に1つのJSONオブジェクトがあります。 以下に例を示します。

```json
{"string":"string1","int":1,"array":[1,2,3],"dict": {"key": "value1"}}
{"string":"string2","int":2,"array":[2,4,6],"dict": {"key": "value2"}}
{"string":"string3","int":3,"array":[3,6,9],"dict": {"key": "value3", "extra_key": "extra_value3"}}
```

複数行のJSONの場合、1つのオブジェクトが複数行を占め、すべてのオブジェクトがJSON配列に含まれます。 以下に例を示します。

```json
[
    {"string":"string1","int":1,"array":[1,2,3],"dict": {"key": "value1"}},
    {"string":"string2","int":2,"array":[2,4,6],"dict": {"key": "value2"}},
    {
        "string": "string3",
        "int": 3,
        "array": [
            3,
            6,
            9
        ],
        "dict": {
            "key": "value3",
            "extra_key": "extra_value3"
        }
    }
]
```

デフォルトでは、Batch Data Ingestでは1行のJSONが使用されます。

### CSVの取り込みはサポートされていますか？

CSVの取り込みは、フラットなスキーマのみサポート 現在、CSVでの階層データの取り込みはサポートされていません。

すべてのデータ取り込み機能を取り込むには、JSONまたはParquet形式を使用する必要があります。

### データに対して実行される検証のタイプ

データに対して実行される検証には、次の3つのレベルがあります。

- スキーマ- Batch Ingestionを使用すると、取り込んだデータのスキーマがデータセットのスキーマと一致するようになります。
- データタイプ — バッチインジェストでは、取り込む各フィールドのタイプが、データセットのスキーマで定義されたタイプと一致するようにします。
- 制約 — バッチ取り込みでは、「必須」、「列挙」、「形式」などの制約がスキーマ定義で適切に定義されます。

### 既に取り込まれたバッチをどのように置き換えることができますか？

既に取り込まれたバッチは、バッチ再生機能を使用して置き換えることができます。 バッチ再生の詳細については、こちらを参照して [ください](./api-overview.md#replay-a-batch)。

### バッチの取り込みはどのように監視されますか。

バッチの取り込みの進行状況は、バッチプロモーションに対して署名された後、次のリクエストを使用して監視できます。

```shell
curl -X GET "https://platform.adobe.io/data/foundation/catalog/batches/{BATCH_ID}" \
  -H "x-gw-ims-org-id: {IMS_ORG}" \
  -H "Authorization: Bearer {ACCESS_TOKEN}" \
  -H "x-api-key : {API_KEY}"
```

このリクエストを使用すると、次のような応答が返されます。

```http
200 OK
```

```json
{
    "{BATCH_ID}":{
        "imsOrg":"{IMS_ORG}",
        "created":1494349962314,
        "createdClient":"{API_KEY}",
        "createdUser":"{USER_ID}",
        "updatedUser":"{USER_ID}",
        "completed":1494349963467,
        "externalId":"{EXTERNAL_ID}",
        "status":"staging",
        "errors":[],
    }
}
```

## バッチ状態

### バッチ状態はどのようなものですか。

バッチは、そのライフサイクルで、次の状態を経由できます。

| Status | マスターに書き込まれたデータ | 説明 |
| ------ | ---------------------- | ----------- |
| 破棄 |  | クライアントは、予想された時間枠でバッチを完了できませんでした。 |
| 中止 |  | クライアントは、Batch Data Ingestion APIを使用して、指定したバッチの中止操作を明示的に呼び出しました。 バッチがロード済み状態になると、バッチを中止することはできません。 |
| アクティブ/成功 | x | バッチはステージからマスターに正常にプロモートされ、ダウンストリーム消費で使用できるようになりました。 **注意：** アクティブと成功は同じ意味で使用されます。 |
| アーカイブ済み |  | バッチはコールドストレージにアーカイブされました。 |
| 失敗/失敗 |  | 不良な設定または不正なデータ、あるいはその両方から生じる端末の状態。 実行可能なエラーがバッチと共に記録され、クライアントがデータを修正して再送信できるようになります。 **注意：** 失敗と失敗は同じ意味で使用されます。 |
| 非アクティブ | x | バッチは正常に昇格されましたが、元に戻されたか、期限が切れています。 バッチはダウンストリーム消費に使用できなくなりますが、基になるデータは、保持、アーカイブまたはその他の方法で削除されるまでマスターに残ります。 |
| ロード中 |  | クライアントは現在、バッチのデータを書き込んでいます。 バッチは、現 **時点で** 、プロモーションの準備ができていません。 |
| ロード済み |  | クライアントはバッチのデータの書き込みを完了しました。 バッチはプロモーションの準備ができました。 |
| 保持 |  | データはマスターから取り出され、Adobe Data Lakeの指定されたアーカイブに保存されます。 |
| ステージング |  | クライアントはプロモーション用のバッチに正常に署名しました。データはダウンストリームでの消費用にステージングされています。 |
| 再試行中 |  | クライアントはプロモーション用のバッチに署名しましたが、エラーが原因で、バッチ監視サービスによってバッチを再試行しています。 この状態を使用して、データの取り込みに遅延が生じる可能性があることをクライアントに通知できます。 |
| 停止 |  | クライアントがプロモーション用のバッチに署名しましたが、Batch Monitoringサービ `n` スによる再試行の後、バッチプロモーションが停止しました。 |

### バッチの「ステージング」とは何を意味しますか。

バッチが「ステージング」にある場合は、そのバッチが販促のために正常に通知され、データが消費ダウンストリーム用にステージングされていることを意味します。

### バッチが「再試行中」の場合の意味

バッチが「再試行中」の場合は、断続的な問題が原因でバッチのデータ取り込みが一時的に停止したことを意味します。 この場合、顧客の介入は必要ありません。

### バッチが「停止」の場合、どのような意味を持ちますか。

バッチが「停止」にある場合、Data Ingestion Servicesでバッチの取り込みが困難で、すべての再試行が使い果たされていることを意味します。

### バッチが「読み込み中」の場合、どのような意味を持ちますか。

バッチが「読み込み中」の場合、CompleteBatch APIが呼び出されていないので、バッチをプロモートします。

### バッチが正常に取り込まれたかどうかを知る方法はありますか。

バッチステータスが「アクティブ」になると、バッチは正常に取り込まれます。 バッチのステータスを確認するには、前述の手順に従い [ます](#how-is-batch-ingestion-monitored)。

### バッチが失敗した後の処理

バッチが失敗した場合、失敗の理由はペイロードのセクションで `errors` 識別できます。 エラーの例を次に示します。

```json
    "errors":[
        {
            "code":"106",
            "description":"Dataset file is empty. Please upload file with data.",
            "rows":[]
        },
        {
            "code":"118",
            "description":"CSV file contains empty header row.",
            "rows":[]
        }
    ]
```

エラーが修正されると、バッチを再度アップロードできます。

## バッチサポート

### バッチはどのように削除する必要がありますか？

バッチは、カタログから直接削除する代わりに、次のいずれかの方法を使用して削除する必要があります。

1. バッチが進行中の場合は、バッチを中止する必要があります。
2. バッチが正常にマスターされた場合は、バッチを元に戻す必要があります。

### 使用できるバッチレベルの指標は何ですか。

アクティブ/成功状態のバッチに対しては、次のバッチレベルの指標を使用できます。

| 指標 | 説明 |
| ------ | ----------- |
| inputByteSize | Data Ingestion Servicesで処理するためにステージングされた合計バイト数です。 |
| inputRecordSize | Data Ingestion Servicesで処理するためにステージングされた行の合計数です。 |
| outputByteSize | Data Ingestion ServicesがData Lakeに出力した合計バイト数です。 |
| outputRecordSize | Data Ingestion ServicesがData Lakeに出力する行の合計数です。 |
| partitionCount | Data Lakeに書き込まれたパーティションの合計数です。 |

### 指標が一部のバッチで使用できないのはなぜですか。

指標がバッチで使用できない理由は2つあります。

1. バッチは、アクティブ/成功の状態に正常に到達しませんでした。
2. バッチは、CSVインジェストなどの従来のプロモーションパスを使用してプロモーションされました。

### 異なるステータスコードの意味

| ステータスコード | 説明 |
| ----------- | ----------- |
| 106 | データセットファイルが空です。 |
| 118 | CSVファイルに空のヘッダー行が含まれています。 |
| 200 | バッチの処理が受け入れられ、「アクティブ」や「失敗」などの最終的な状態にトランジションされます。 送信されたバッチは、エンドポイントを使用して監視で `GetBatch` きます。 |
| 400 | 不正なリクエスト。 バッチ内に不足しているか、重複しているチャンクがある場合に返されます。 |

[large-file-upload]: batch_data_ingestion_developer_guide.md#how-to-ingest-large-parquet-files
