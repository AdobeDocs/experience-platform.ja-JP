---
title: ID 最適化アルゴリズム
description: ID サービスの ID 最適化アルゴリズムについて説明します。
hide: true
hidefromtoc: true
badge: アルファ版
source-git-commit: 8f99dc633c87fa36cc0c5413d23b97b4fce7dbc3
workflow-type: tm+mt
source-wordcount: '1319'
ht-degree: 2%

---

# ID 最適化アルゴリズム

>[!IMPORTANT]
>
>ID 最適化アルゴリズムがAlpha中です。 機能とドキュメントは変更される場合があります。

ID 最適化アルゴリズムは、ID グラフが 1 人の個人を表すようにするルールです。したがって、リアルタイム顧客プロファイルで ID が望ましく結合されるのを防ぎます。

## 入力パラメーター

単一の結合プロファイルと、それに対応する ID グラフは、単一の個人（ユーザーエンティティ）を表す必要があります。 通常、1 人の個人は CRM ID やログイン ID で表されます。 2 人の個人 (CRM ID) が 1 つのプロファイルまたはグラフに結合されることはありません。

ID 最適化アルゴリズムを使用して、ID サービス内の個人エンティティを表す名前空間を指定する必要があります。 例えば、CRM データベースが単一の CRM ID と単一の電子メールアドレスに関連付けるユーザーアカウントを定義している場合、このサンドボックスの ID 設定は次のようになります。

* CRM ID 名前空間=一意
* E メール名前空間=一意

一意と宣言する名前空間は、特定の ID グラフ内で最大 1 個に制限されるように自動的に設定されます。 例えば、CRM ID の名前空間を一意として宣言した場合、ID グラフは CRM ID の名前空間を含む ID を 1 つだけ持つことができます。

>[!NOTE]
>
>* 現在、アルゴリズムは 1 つのログイン識別子（1 つのログイン名前空間）のみを使用できます。 複数のログイン識別子（ログインに使用される複数の ID 名前空間）、世帯エンティティグラフ、階層グラフ構造は、現時点ではサポートされていません。
>
>* ユーザー ID であり、ID グラフの生成にサンドボックスで使用されるすべての名前空間は、一意の名前空間としてマークする必要があります。 そうしないと、望ましくないリンク結果が表示される場合があります。

## プロセス

新しい ID を取り込む際に、ID サービスは、新しい ID と対応する名前空間が設定された制限を超える結果になるかどうかを確認します。 制限を超えない場合、新しい ID の取り込みが続行され、これらの ID はグラフにリンクされます。 ただし、制限を超える場合、ID 最適化アルゴリズムは、最新のタイムスタンプが保持され、優先度の低い名前空間を持つ最も古いリンクが削除されるようにグラフを更新します。

## ID 最適化アルゴリズムのシナリオの例

次の節では、共有デバイスや同じタイムスタンプを持つデータの取り込みなどのシナリオでの、ID 最適化アルゴリズムの動作について説明します。

### 共有デバイス

共有デバイスとは、複数の個人が使用するデバイスを指します。 例えば、共有デバイスは、パートナーや家族、ライブラリコンピューター、公開キオスクと共有するノートパソコンやタブレットにすることができます。

>[!BEGINTABS]

>[!TAB 例 1]

| 名前空間 | 上限 |
| --- | --- |
| CRM ID | 1 |
| メール | 1 |
| ECID | なし |

この例では、CRM ID と電子メールの両方が一意の名前空間として指定されています。 時刻 `timestamp=0`: CRM レコードデータセットが取り込まれ、制限の設定により 2 つの異なるグラフが作成されます。 各グラフには、CRM ID と電子メール名前空間が含まれます。

* `timestamp=1`：ジェーンはノート PC を使用して e コマース Web サイトにログインします。 ジェーンは CRM ID と電子メールで表され、使用しているノートパソコンの Web ブラウザーは ECID で表されます。
* `timestamp=2`:John は、同じノート PC を使用して e コマース Web サイトにログインします。 John は CRM ID と電子メールで表されますが、使用した Web ブラウザーは既に ECID で表されています。 同じ ECID が 2 つの異なるグラフにリンクされているので、ID サービスは、このデバイス（ノート PC）が共有デバイスであることを認識できます。
* ただし、CRM ID 名前空間は 1 つまで、電子メール名前空間は 1 つのグラフにつき 1 つまで設定される制限設定により、ID 最適化アルゴリズムは、グラフを 2 つに分割します。
   * 最後に、John が最後に認証されたユーザーであるので、ノート PC を表す ECID は、ジェーンのではなく自分のグラフにリンクされたままになります。

![共有デバイスのケース 1](../images/identity-settings/shared-device-case-one.png)

>[!TAB 例 2]

| 名前空間 | 上限 |
| --- | --- |
| CRM ID | 1 |
| ECID | なし |

この例では、CRM ID 名前空間が一意の名前空間として指定されています。

* `timestamp=1`：ジェーンはノート PC を使用して e コマース Web サイトにログインします。 Sarah は CRM ID で表され、ノート PC の Web ブラウザーは ECID で表されます。
* `timestamp=2`:John は、同じノート PC を使用して e コマース Web サイトにログインします。 彼は CRM ID で表され、彼が使用する Web ブラウザーは同じ ECID で表されます。
   * このイベントは、2 つの独立した CRM ID を同じ ECID にリンクします。これは、1 つの CRM ID の設定済み制限を超えています。
   * その結果、ID 最適化アルゴリズムは、古いリンクを削除します。この場合、リンク先はジェーンの CRM ID です。 `timestamp=1`.
   * ただし、ジェーンの CRM ID は ID サービスのグラフとしては存在しなくなりますが、リアルタイム顧客プロファイルのプロファイルとして保持されます。 これは、ID グラフには少なくとも 2 つのリンクされた ID を含める必要があり、リンクを削除した結果、ジェーンの CRM ID にはリンク先の別の ID がなくなるからです。

![shared-device-case-two](../images/identity-settings/shared-device-case-two.png)

>[!ENDTABS]

### 無効なメール

ユーザーが電子メールや電話番号に不正な値を入力する場合があります。

| 名前空間 | 上限 |
| --- | --- |
| CRM ID | 1 |
| メール | 1 |
| ECID | なし |

この例では、CRM ID および電子メール名前空間が一意に指定されています。 ジェーンとジョンが間違った E メール値（例：test）を使用して e コマース Web サイトにサインアップしたシナリオを考えてみましょう。<span>@test.com) と同じです。

* `timestamp=1`：ジェーンは、iPhoneの Safari を使用して e コマース Web サイトにログインし、CRM ID（ログイン情報）と ECID（ブラウザー）を設定します。
* `timestamp=2`：ジョンは、iPhoneでGoogle Chrome を使用して e コマース Web サイトにログインし、CRM ID（ログイン情報）と ECID（ブラウザー）を設定します。
* `timestamp=3`：データエンジニアがジェーンの CRM レコードを取り込むと、ジェーンの CRM ID が無効な電子メールにリンクされます。
* `timestamp=4`：データエンジニアがジョンの CRM レコードを取り込むと、その CRM ID が無効な電子メールにリンクされます。
   * これは、2 つの CRM ID 名前空間を持つ単一のグラフを作成するので、設定された制限の違反になります。
   * その結果、ID 最適化アルゴリズムは古いリンクを削除します。この場合、ジェーンの ID と CRM ID 名前空間（この場合は、ジェーンの ID とテスト用 ID の間のリンク）<span>@test.

ID 最適化アルゴリズムを使用すると、偽の E メールや電話番号などの不正な ID 値は、複数の異なる ID グラフに伝播されません。

![メールが悪い](../images/identity-settings/bad-email.png)

### 匿名イベントの関連付け

ECID は未認証（匿名）イベントを格納し、CRM ID は認証済みイベントを格納します。 共有デバイスの場合、ECID（未認証イベントの bearer）は **最後に認証されたユーザー**.

匿名イベントの関連付けがどのように機能するかをより深く理解するには、以下の図を参照してください。

* ケビンとノラはタブレットを共有しています
   * `timestamp=1`:Kevin は、自分のアカウントを使用して e コマース Web サイトにログインし、CRM ID（ログイン情報）と ECID（ブラウザー）を確立します。 ログイン時に、Kevin が最後に認証されたユーザーと見なされるようになりました。
   * `timestamp=2`:Nora は、自分のアカウントを使用して e コマース Web サイトにログインし、CRM ID（ログイン情報）と同じ ECID を確立します。 ログイン時に、Nora が最後に認証されたユーザーと見なされるようになりました。
   * `timestamp=3`:Kevin はタブレットを使用して e コマース Web サイトを参照しますが、自分のアカウントでログインすることはしません。 次に、Kevin の閲覧アクティビティが ECID に保存され、Nera が最後に認証されたユーザーなので、ECID が Nora に関連付けられます。 この時点で、Nora は匿名イベントを所有しています。
      * Kevin が再度ログインするまで、Nora の結合プロファイルは、ECID に対して保存されたすべての未認証イベントに関連付けられます（イベントは ECID がプライマリ ID です）。
   * `timestamp=4`:Kevin が 2 回ログインします。 この時点で、再びそのユーザーが最後に認証されたユーザーになり、現在は未認証イベントも所有しています。
      * 以前の最初のログイン前 `timestamp=1`；および
      * Kevin の最初と 2 回目のログインの間で匿名で閲覧中に、Nora がおこなったすべてのアクティビティ。

![anon-event-association](../images/identity-settings/anon-event-association.png)


## 次の手順

ID グラフのリンクルールの詳細については、次のドキュメントを参照してください。

* [ID グラフリンクルールの概要](./overview.md)
* [ID グラフのリンクルールの設定例](./example-scenarios.md)
* [ID リンクロジック](./identity-linking-logic.md)
* [ID サービスとリアルタイム顧客プロファイル](identity-and-profile.md)
