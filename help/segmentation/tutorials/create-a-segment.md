---
keywords: Experience Platform;home;popular topics
solution: Experience Platform
title: セグメントの作成
topic: tutorial
translation-type: tm+mt
source-git-commit: c0eacfba2feea66803e63ed55ad9d0a97e9ae47c
workflow-type: tm+mt
source-wordcount: '884'
ht-degree: 0%

---


# セグメントの作成

このドキュメントでは、 [DNLAdobe Experience PlatformセグメントサービスAPIを使用して、セグメント定義の開発、テスト、プレビュー、保存に関するチュートリアルを提供します](../api/getting-started.md)。

ユーザーインターフェイスを使用したセグメントの作成方法について詳しくは、『 [セグメントビルダーガイド](../ui/overview.md)』を参照してください。

## はじめに

このチュートリアルでは、オーディエンスセグメントの作成に関わる様々な [!DNL Adobe Experience Platform] サービスについて、十分に理解している必要があります。 このチュートリアルを開始する前に、次のサービスのドキュメントを確認してください。

- [!DNL Real-time Customer Profile](../../profile/home.md): 複数のソースからの集計データに基づいて、統合されたリアルタイムの消費者プロファイルを提供します。
- [!DNL Adobe Experience Platform Segmentation Service](../home.md): リアルタイム顧客プロファイルデータからオーディエンスセグメントを作成できます。
- [!DNL Experience Data Model (XDM)](../../xdm/home.md): Platformが顧客体験データを編成する際に使用する標準化されたフレームワーク。

以下の節では、APIを正しく呼び出すために知る必要がある追加情報について説明し [!DNL Platform] ます。

### サンプルAPI呼び出しの読み取り

このチュートリアルでは、リクエストをフォーマットする方法を示すAPI呼び出しの例を提供します。 例えば、パス、必須のヘッダー、適切にフォーマットされた要求ペイロードなどです。 API応答で返されるサンプルJSONも提供されます。 サンプルAPI呼び出しのドキュメントで使用される規則について詳しくは、Experience PlatformトラブルシューティングガイドのAPI呼び出し例 [の読み方に関する節](../../landing/troubleshooting.md#how-do-i-format-an-api-request) を参照してください。

### 必要なヘッダーの値の収集

APIを呼び出すには、まず [!DNL Platform] 認証チュートリアルを完了する必要があり [ます](../../tutorials/authentication.md)。 次に示すように、Experience PlatformAPIのすべての呼び出しに必要な各ヘッダーの値を認証チュートリアルで説明します。

- 認証： 無記名 `{ACCESS_TOKEN}`
- x-api-key: `{API_KEY}`
- x-gw-ims-org-id: `{IMS_ORG}`

内のすべてのリソース [!DNL Experience Platform] は、特定の仮想サンドボックスに分離されます。 APIへのすべてのリクエストには、操作が実行されるサンドボックスの名前を指定するヘッダーが必要で [!DNL Platform] す。

- x-sandbox-name: `{SANDBOX_NAME}`

>[!NOTE]
>
>のサンドボックスについて詳し [!DNL Platform]くは、 [Sandboxの概要ドキュメントを参照してください](../../sandboxes/home.md)。

ペイロード(POST、PUT、PATCH)を含むすべてのリクエストには、次の追加のヘッダーが必要です。

- Content-Type: application/json

## セグメント定義の作成

セグメント化の最初の手順は、セグメントを定義することです。セグメントを定義する手順は、 **セグメント定義と呼ばれる構成体で表されます**。 セグメント定義は、 [!DNL Profile Query Language] (PQL)に書き込まれたクエリをカプセル化するオブジェクトです。 このオブジェクトは、 **PQL述語とも呼ばれます**。 PQL述語は、指定するレコードまたは時系列データに関連する条件に基づいて、セグメントの規則を定義し [!DNL Real-time Customer Profile]ます。 PQLクエリの記述の詳細については、 [PQLガイド](../pql/overview.md) を参照してください。

APIのエンドポイントにPOSTリクエストを作成して、新しいセグメント定義を作成でき `/segment/definitions` ま [!DNL Segmentation] す。 次の例は、セグメントを正しく定義するために必要な情報など、定義リクエストの書式設定方法を示しています。

セグメントの定義方法の詳細については、『 [セグメント定義開発者ガイド](../api/segment-definitions.md#create)』を参照してください。

## オーディエンスの見積もりとプレビュー {#estimate-and-preview-an-audience}

セグメント定義を作成する際に、の見積もりツールとプレビューツールを使用して、表示の概要レベルの情報 [!DNL Real-time Customer Profile] を得ることで、期待されるオーディエンスを確実に分離できます。 予測は、予測されるオーディエンスサイズや信頼区間など、セグメント定義の統計情報を提供します。 プレビューは、セグメント定義の条件を満たすプロファイルのページ分割リストを提供し、期待どおりの結果と比較できます。

オーディエンスを見積もってプレビューすることで、PQL予測をテストして最適化し、必要な結果を得られるようにします。結果は、PQL予測をテストして最適化し、更新したセグメント定義で使用できます。

セグメントのプレビューや予測の取得に必要な手順は2つあります。

1. [プレビュージョブの作成](#create-a-preview-job)
2. [表示ジョブのIDを使用したプレビューの予測またはプレビュー](#view-an-estimate-or-preview)

### 予測の生成方法

データサンプルを使用して、セグメントを評価し、適切なプロファイルの数を見積もります。 新しいデータが毎朝メモリに読み込まれ(午前12時～午前2時（UTCの午前7時～午前9時）、すべてのセグメントクエリがその日のサンプルデータを使用して見積もられます。 したがって、新しく追加されたフィールドや収集されたデータが、翌日の予測に反映されます。

サンプルサイズは、プロファイルストア内のエンティティの全体数に依存します。 次の表に、これらのサンプルサイズを示します。

| プロファイルストア内のエンティティ | サンプルサイズ |
| ------------------------- | ----------- |
| 100万未満 | フルデータセット |
| 1～2千万 | 100万 |
| 2千万以上 | 合計5% |

推定時間は、おおまかな予想から10～15秒と、記録が読み上げられる中で、精製が始まる。

### プレビュージョブの作成

エンドポイントにPOSTリクエストを作成して、新しいプレビュージョブを作成でき `/preview` ます。

プレビュージョブの作成に関する詳細な手順については、『 [プレビューおよび見積もりエンドポイントガイド](../api/previews-and-estimates.md#create-preview)』を参照してください。

### 見積やプレビューの表示

見積もりプロセスとプレビュープロセスは、異なるクエリが完了するまでに異なる時間を要する場合があるので、非同期に実行されます。 クエリが開始されると、API呼び出しを使用して、予測またはプレビューの進行に伴う現在の状態を取得(GET)できます。

APIを使用して、プレビュージョブの現在の状態をIDで調べることができ [!DNL Segmentation Service] ます。 状態が「RESULT_READY」の場合、結果を表示できます。 プレビュージョブの現在の状態を調べるには、プレビューおよび推定エンドポイントガイドのプレビュージョブの [取得に関する節を読み込んでください](../api/previews-and-estimates.md#get-preview) 。 見積もりジョブの現在の状態を調べるには、プレビューおよび見積もりエンドポイントガイドの見積もりジョブ [の](../api/previews-and-estimates.md#get-estimate) 取得に関する節をお読みください。


## 次の手順

セグメント定義を開発、テスト、および保存したら、セグメントジョブを作成して、 [!DNL Segmentation Service] APIを使用してオーディエンスを作成できます。 これを行う方法の詳細手順については、セグメント結果の [評価とアクセスに関するチュートリアル](./evaluate-a-segment.md) を参照してください。