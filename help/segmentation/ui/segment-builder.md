---
solution: Experience Platform
title: セグメントビルダー UI ガイド
description: Adobe Experience Platform UI のセグメントビルダーは、プロファイルデータ要素を操作できる機能豊富なワークスペースを備えています。 ワークスペースには、ルールを作成および編集するための直感的なコントロール（例えば、データプロパティを表示する際に使用するドラッグ＆ドロップタイルなど）があります。
exl-id: b27516ea-8749-4b44-99d0-98d3dc2f4c65
source-git-commit: 7be3e6c143d792113a0d623e2d12d6710a3be70c
workflow-type: tm+mt
source-wordcount: '5195'
ht-degree: 66%

---

# [!DNL Segment Builder] UI ガイド

>[!NOTE]
>
>このガイドでは、セグメントビルダーで&#x200B;**セグメント定義**&#x200B;を使用して、オーディエンスを作成する方法について説明します。オーディエンス構成を使用してオーディエンスを作成する方法については、[オーディエンス構成 UI ガイド](./audience-composition.md)を参照してください。

[!DNL Segment Builder] のワークスペースには、[!DNL Profile] のデータ要素を操作できる豊富な機能があります。ワークスペースには、ルールを作成および編集するための直感的なコントロール（例えば、データプロパティを表示する際に使用するドラッグ＆ドロップタイルなど）があります。

![セグメントビルダー UI の表示。](../images/ui/segment-builder/segment-builder.png)

## セグメント定義の構成要素 {#building-blocks}

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_fields"
>title="フィールド"
>abstract="セグメント定義を構成する 3 つのフィールドタイプは、属性、イベントおよびオーディエンスです。属性では、XDM 個人プロファイルクラスに属するプロファイル属性を使用できます。イベントでは、XDM ExperienceEvent データ要素を使用して実行されるアクションやイベントに基づいてオーディエンスを作成できます。また、オーディエンスでは、外部ソースから読み込まれたオーディエンスを使用できます。"

>[!CONTEXTUALHELP]
>id="platform_segmentation_segmentbuilder_showfullxdmschema"
>title="完全な XDM スキーマの表示"
>abstract="デフォルトでは、データを含むフィールドのみが表示されます。このオプションを有効にして、XDM スキーマ内のすべてのフィールドを表示します。"

>[!CONTEXTUALHELP]
>id="platform_segmentation_segmentbuilder_showdeprecatedfields"
>title="非推奨フィールドの表示"
>abstract="デフォルトでは、非推奨の XDM フィールドは表示されません。このオプションを有効にして、非推奨の XDM フィールドを表示します。"

セグメント定義の基本的な構成要素は属性とイベントです。また、既存のオーディエンスに含まれている属性とイベントを、新しい定義の構成要素として使用することもできます。

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_summarydata"
>title="概要データ"
>abstract="概要データはプロファイル属性にのみ表示され、イベント属性またはオーディエンス属性には表示<b>されません</b>。<br/><br/>次の状況では、プロファイル属性の概要データが表示されない場合があります。 <ol><li>属性の値の一部が 100 文字を超えている。</li><li>属性に 3,000 を超える一意の値がある。</li></ol>"

>[!NOTE]
>
>属性の情報バブルを選択すると、フィールドの値の分布（概要データとも呼ばれます）を表示できます。 これらは「属性」タブで **のみ** 使用でき、「イベント」タブや「オーディエンス」タブでは使用できません。
>
>属性が次の条件を満たしている場合は、概要データが表示されます。属性のすべての値が 100 文字以下で、属性の一意の値が 3000 個以下の場合。
>
>ただし、関係を通じてプロファイルにリンクされた複数エンティティデータの場合、属性には概要データが含まれま **ん**。 例えば、`Vehicle` というカスタムスキーマがある場合、**スキーマ内の** プロパティ `Vehicle` には概要データが含まれ **いません**。

これらの構成要素は、[!DNL Segment Builder] のワークスペースの左側にある「**[!UICONTROL フィールド]**」セクションに表示されます。「**[!UICONTROL フィールド]**」には、主要な各構成要素（「[!UICONTROL 属性]」、「[!UICONTROL イベント]」、「[!UICONTROL オーディエンス]」）のタブが含まれています。

![セグメントビルダーの「フィールド」セクションがハイライト表示されている様子。](../images/ui/segment-builder/segment-fields.png)

### 属性

「**[!UICONTROL 属性]**」タブでは、[!DNL XDM Individual Profile] クラスに属する [!DNL Profile] 属性を参照できます。各フォルダーを展開して、追加の属性を表示できます。各属性はタイルで表されており、ワークスペースの中央にあるルールビルダーキャンバスにドラッグすることができます。[ルールビルダーキャンバス](#rule-builder-canvas)の詳細については、このガイドで後述します。

![セグメントビルダーフィールドの「属性」セクションがハイライト表示されている様子。](../images/ui/segment-builder/attributes.png)

### イベント

「**[!UICONTROL イベント]**」タブでは、[!DNL XDM ExperienceEvent] のデータ要素を使用して実行されたイベントまたはアクションに基づいてオーディエンスを作成できます。また、「**[!UICONTROL イベント]**」タブにある「イベントタイプ」は、一般的に使用されるイベントを集めたもので、セグメント定義をより迅速に作成することができます。

[!DNL ExperienceEvent] 要素を参照できるだけでなく、イベントタイプを検索することもできます。イベントタイプでは、[!DNL ExperienceEvents] と同じコーディングロジックを使用します。その際に、[!DNL XDM ExperienceEvent] クラスで正しいイベントを検索する必要はありません。例えば、検索バーを使用して「cart」を検索すると、「[!UICONTROL AddCart]」と「[!UICONTROL RemoveCart]」というイベントタイプが返されます。これらは、セグメント定義を作成する際によく使用される 2 つの買い物かごアクションです。

任意のタイプのコンポーネントを検索するには、[Lucene の検索構文](https://docs.microsoft.com/ja-JP/azure/search/query-lucene-syntax)を使用して、検索バーにその名前を入力します。単語を完全に入力すると、検索結果が表示され始めます。例えば、XDM フィールド `ExperienceEvent.commerce.productViews` に基づくルールを作成するには、検索フィールドに「product views」と入力します。「product」という単語の入力が終わると同時に、検索結果が表示され始めます。検索結果には、それが属するオブジェクト階層も表示されます。

>[!NOTE]
>
>組織で定義されたカスタムスキーマフィールドが表示され、ルールの作成に使用できるようになるまでに、最長で 24 時間かかる場合があります。

その後は、 [!DNL ExperienceEvents] と「[!UICONTROL イベントタイプ]」をセグメント定義に簡単にドラッグ＆ドロップできます。

![セグメントビルダー UI の「イベント」セクションがハイライト表示されている様子。](../images/ui/segment-builder/events.png)

デフォルトでは、データストアから入力されたスキーマフィールドのみが表示されます。この中には「[!UICONTROL イベントタイプ]」が含まれます。「[!UICONTROL イベントタイプ]」リストが表示されない場合や、「[!UICONTROL イベントタイプ]」として「[!UICONTROL 任意]」しか選択できない場合は、「**[!UICONTROL フィールド]**」の横の&#x200B;**歯車アイコン**&#x200B;を選択したあと、「**[!UICONTROL 使用可能なフィールド]**」内の「**[!UICONTROL すべての XDM スキーマを表示]**」を選択します。**歯車**&#x200B;アイコンをもう一度選択すると、「**[!UICONTROL フィールド]**」タブに戻ります。データが含まれているかどうかに関係なく、複数の「[!UICONTROL イベントタイプ]」とスキーマフィールドが表示されるようになりました。

![データを含んだフィールドのみ表示するか、すべての XDM フィールドを表示するかを選択できるラジオボタンがハイライト表示されている様子。](../images/ui/segment-builder/show-populated.png)

#### Adobe Analytics レポートスイートのデータセット

セグメント化において 1 つまたは複数の Adobe Analytics レポートスイートのデータをイベントとして使用できます。

1 つの Analytics レポートスイートのデータを使用する場合、Experience Platformは記述子とわかりやすい名前を eVar に自動的に追加するので、[!DNL Segment Builder] 内でこれらのフィールドを見つけやすくなります。

![汎用変数（eVar）がわかりやすい名前を付けてどのようにマッピングされるかを示す画像。](../images/ui/segment-builder/single-report-suite.png)

複数の Analytics レポートスイートのデータを使用する場合、Experience Platformは、記述子やわかりやすい名前を eVar に自動的に追加 **できません**。 したがって、Analytics レポートスイートのデータを使用する前に、XDM フィールドにマッピングする必要があります。 Analytics 変数から XDM へのマッピングについて詳しくは、[Adobe Analytics ソース接続ガイド](../../sources/tutorials/ui/create/adobe-applications/analytics.md#mapping)を参照してください。

例えば、次の変数が含まれる 2 つのレポートスイートがあるとします。

| フィールド | レポートスイートスキーマ A | レポートスイートスキーマ B |
| ----- | --------------------- | --------------------- |
| eVar1 | 参照ドメイン | ログイン済み Y/N |
| eVar2 | ページ名 | メンバーロイヤルティ ID |
| eVar3 | URL | ページ名 |
| eVar4 | 検索語句 | 製品名 |
| event1 | クリック数 | ページビュー数 |
| event2 | ページビュー数 | 買い物かごへの追加 |
| event3 | 買い物かごへの追加 | チェックアウト |
| event4 | 購入 | 購入 |

この場合、これら 2 つのレポートスイートを次のスキーマでマッピングできます。

![2 つのレポートスイートを 1 つの結合スキーマにマッピングする方法を示す画像](../images/ui/segment-builder/union-schema.png)

>[!NOTE]
>
>汎用 eVar 値は引き続き入力されますが、レポート内の元の値とは異なる意味を持つ可能性があるので、セグメント定義では使用し&#x200B;**ない**&#x200B;でください（可能な場合）。

レポートスイートがマッピングされると、これらの新しくマッピングされたフィールドをプロファイル関連のワークフローおよびセグメント化内で使用できます。

| シナリオ | 結合スキーマエクスペリエンス | セグメント化汎用変数 | セグメント化マッピング変数 |
| -------- | ----------------------- | ----------------------------- | ---------------------------- |
| 単一レポートスイート | 汎用変数には、フレンドリ名記述子が含まれます。<br><br>**例：**&#x200B;ページ名（eVar2） | <ul><li>汎用変数に含まれるフレンドリ名記述子</li><li>唯一のクエリであるので、クエリでは特定のデータセットのデータを使用します</li></ul> | クエリでは、Adobe Analytics データを使用でき、場合によってはその他のソースを使用できます。 |
| 複数のレポートスイート | 汎用変数には、フレンドリ名記述子は含まれません。<br><br>**例：** eVar2 | <ul><li>複数の記述子を持つフィールドは、すべて汎用として表示されます。つまり、UI にフレンドリ名は表示されません。</li><li>クエリでは、eVar を含む任意のデータセットのデータを使用できます。これにより、結果が混在したり、不正確になったりする可能性があります。</li></ul> | クエリでは、複数のデータセットから正しく結合された結果を使用します。 |

### オーディエンス

>[!CONTEXTUALHELP]
>id="platform_segmentation_segmentBuilder_b2b_decomposition"
>title="複雑な評価"
>abstract="次の式は複雑すぎて、単一のオーディエンスとして表現できません。同じセグメント定義で B2B ルールと人物ベースのイベントの両方を使用するには、次の手順に従ってください。<ol><li>人物ベースのイベントのみを参照するセグメント定義を作成し、独自のセグメント定義として保存します。</li><li>新しいセグメント定義では、B2B ルールを参照しながら、以前に作成したセグメント定義を読み込みます。</li></ol>"

>[!NOTE]
>
>Experience Platform内で作成されたオーディエンスの場合、**同じ** 結合ポリシーを持つオーディエンスのみが表示されます。

**[!UICONTROL オーディエンス]** タブには、Adobe Audience ManagerやCustomer Journey Analyticsなどの外部ソースから読み込まれたすべてのオーディエンスと、[!DNL Experience Platform] 内で作成されたオーディエンスが表示されます。

「**[!UICONTROL オーディエンス]**」タブでは、使用可能なすべてのソースがフォルダーのグループとして表示されます。フォルダーを選択すると、使用可能なサブフォルダーとオーディエンスが表示されます。また、フォルダー構造を表示するには、フォルダーアイコンを選択します（右端の画像を参照）。チェックマークは、現在のフォルダーを表しています。また、ツリー内のフォルダーの名前を選択することで、フォルダー間を簡単に移動できます。

オーディエンス横の ⓘ にカーソルを置くと、そのオーディエンスに関する情報が表示されます。例えば、ID、説明、そのオーディエンスが存在するフォルダーの階層などです。

![フォルダー階層がオーディエンスに対してどのように機能するかを示す画像。](../images/ui/segment-builder/audience-folder-structure.png)

## ルールビルダーキャンバス {#rule-builder-canvas}

>[!IMPORTANT]
>
>2024 年 6 月リリースの時点で、「今月」は「月初」を、「今年」は「年初」をそれぞれ表しています。 例えば、7 月 18 日に「今月が誕生日の顧客すべて」を検索するオーディエンスを作成した場合、オーディエンスには、7 月 1 日から 7 月 31 日までに誕生日が発生したすべての顧客が取得されます。 このオーディエンスは、8 月 1 日に誕生日が 8 月 1 日から 8 月 31 日までのすべての顧客を取得します。
>
>以前は、「今月」は 30 日、「今年」は 365 日を表していましたが、31 日とうるう年の月を考慮できませんでした。
>
>オーディエンスのロジックを更新するには、以前に作成したオーディエンスを再保存してください。

セグメント定義は、ターゲットオーディエンスの重要な特徴やビヘイビアーの説明に使用される一連のルールです。これらのルールは、[!DNL Segment Builder] の中央にあるルールビルダーキャンバスを使用して作成します。

セグメント定義に新しいルールを追加するには、タイルを「**[!UICONTROL フィールド]**」タブからルールビルダーキャンバスにドラッグ＆ドロップします。追加するデータのタイプに応じて、コンテキスト固有のオプションが表示されます。使用できるデータタイプには、文字列、日付、[!DNL ExperienceEvents]、「[!UICONTROL イベントタイプ]」、オーディエンスが含まれます。

![空のルールビルダーキャンバス。](../images/ui/segment-builder/rule-builder-canvas.png)

>[!IMPORTANT]
>
>Adobe Experience Platform に対する最新の変更により、イベント間の `OR` および `AND` 論理演算子の使用が更新されました。これらの更新は、既存のセグメント定義には影響しません。ただし、既存のセグメント定義と新しく作成されたセグメント定義に対するその後の更新はすべて、これらの変更の影響を受けます。詳しくは、[時間制約の更新](./segment-refactoring.md)を参照してください。

属性の値を選択すると、属性が取り得る列挙値のリストが表示されます。

![属性が取り得る列挙値のリストを示す画像](../images/ui/segment-builder/enum-list.png)

この列挙リストから値を選択すると、その値が実線の境界線で囲まれます。ただし、`meta:enum`（ソフト）列挙を使用するフィールドの場合、列挙リストに&#x200B;**ない**&#x200B;値を選択することもできます。独自の値を作成すると、この値が列挙リストにないという警告と共に、値が点線の境界線で囲まれます。

![列挙リストに含まれていない値を挿入しようとした場合に表示される警告](../images/ui/segment-builder/enum-warning.png)

複数の値を作成している場合は、バルクアップロードを使用して一度にすべてを追加できます。![プラスアイコン](/help/images/icons/add-circle.png) を選択して、**[!UICONTROL 一括で値を追加]**&#x200B;ポップオーバーを表示します。

![プラスアイコンがハイライト表示され、バルクアップロードポップオーバーにアクセスするために選択できるボタンが表示されます。](../images/ui/segment-builder/add-bulk-values.png)

**[!UICONTROL 一括で値を追加]**&#x200B;ポップオーバーで、CSV または TSV ファイルをアップロードできます。

![一括で値を追加ポップオーバーが表示されます。CSV または TSV ファイルをアップロードするために選択できるダイアログがハイライト表示されます。](../images/ui/segment-builder/bulk-values-popover.png)

または、コンマ区切りの値を手動で追加することもできます。

![一括で値を追加ポップオーバーが表示されます。値の挿入に使用できるダイアログと、追加された値の両方がハイライト表示されます。](../images/ui/segment-builder/bulk-values-comma-separated.png)

最大 250 個の値が許可されます。この値を超える場合は、値を削除してから追加する必要があります。

![値の最大数に達したことを示す警告が表示されます。](../images/ui/segment-builder/maximum-values.png)

### オーディエンスの追加

>[!CONTEXTUALHELP]
>id="platform_segmentation_segmentbuilder_addaudiences"
>title="更新の検索"
>abstract="既存の検索システムは、統合検索を使用するように更新されました。統合検索を使用すると、オーディエンスのセグメントメンバーシップをより簡単かつ確実に検索できます。"

オーディエンスを「**[!UICONTROL オーディエンス]**」タブからルールビルダーキャンバスにドラッグ＆ドロップすることで、新しいセグメント定義でオーディエンスのメンバーシップを参照できます。これにより、オーディエンスのメンバーシップを新しいセグメント定義ルールの属性として含めたり除外したりできます。

[!DNL Segment Builder] を使用して作成した [!DNL Experience Platform] オーディエンスの場合は、オーディエンスを、そのオーディエンスのセグメント定義で使用されていた一連のルールに変換することができます。このような変換では、ルールロジックのコピーが作成されます。このコピーを変更すれば、元のセグメント定義に影響を与えずに済みます。セグメント定義に対する最近の変更を、ルールロジックに変換する前に必ず保存しておいてください。

>[!NOTE]
>
>外部ソースからオーディエンスを追加した場合、オーディエンスのメンバーシップのみが参照されます。このオーディエンスをルールに変換することはできないので、元のオーディエンスの作成に使用されたルールを新しいセグメント定義で変更することはできません。

![オーディエンス属性をルールに変換する方法を示す画像](../images/ui/segment-builder/add-audience-to-segment.png)

オーディエンスをルールに変換するときに競合が発生した場合、[!DNL Segment Builder] は既存のオプションを可能な限り保持しようとします。

### コードビュー

または、[!DNL Segment Builder] で作成されたルールのコードベースバージョンを表示できます。ルールビルダーキャンバス内でルールを作成したら、「**[!UICONTROL コードビュー]**」を選択して、セグメント定義を PQL として表示できます。

![セグメント定義を PQL として表示するのに使用できるコードビューボタンがハイライト表示されている様子。](../images/ui/segment-builder/code-view.png)

コードビューには、API 呼び出しで使用するセグメント定義の値をコピーできるボタンがあります。セグメント定義の最新バージョンを取得するには、最新の変更をセグメント定義に保存してあることを確認してください。

![「コードをコピー」ボタンがハイライト表示されている様子](../images/ui/segment-builder/copy-code.png)

### 集計関数

[!DNL Segment Builder] での集計は、データタイプが数値（倍精度浮動小数点数または整数）である XDM 属性のグループに対する計算です。セグメントビルダー内でサポートされている 4 つの集計関数は、SUM、AVERAGE、MIN および MAX です。

集計関数を作成するには、左側のパネルからイベントを選択して、[!UICONTROL イベント]コンテナに挿入します。

![「イベント」セクションがハイライト表示されている様子](../images/ui/segment-builder/events.png)

イベントコンテナ内にイベントを配置した後、省略記号アイコン（...）を選択し、続いて「**[!UICONTROL 集計]**」を選択します。

![「集計」がハイライト表示されている様子。これを選択すると集計関数を選択可能に](../images/ui/segment-builder/add-aggregation.png)

これで、集計が追加されます。集計関数を選択し、集計する属性、等値関数および値を選択できるようになりました。次の例では、個々の購入額が 100 ドル未満であっても、購入額の合計が 100 ドルを超えるプロファイルはすべて、このセグメント定義に該当します。

![イベントルールに集計関数が表示されている様子](../images/ui/segment-builder/filled-aggregation.png)

### カウント関数 {#count-functions}

セグメントビルダーのカウント関数は、指定されたイベントを検索し、イベントが実行された回数をカウントするために使用されます。セグメントビルダーでサポートされているカウント関数は、「少なくとも」、「最大で」、「正確に」、「範囲内」および「すべて」です。

カウント関数を作成するには、左側のパネルからイベントを選択して、[!UICONTROL イベント]コンテナに挿入します。

![イベントフィールドがハイライト表示されている様子](../images/ui/segment-builder/events.png)

イベントコンテナ内にイベントを配置した後、「[!UICONTROL 少なくとも 1 回]」を選択します。

![「少なくとも」がハイライト表示され、カウント関数の一覧を表示するために選択する箇所を示している](../images/ui/segment-builder/add-count.png)

これで、カウント関数が追加されました。カウント関数と関数の値を選択できるようになりました。次の例では、少なくとも 1 回のクリックが発生したイベントを含めることになります。

![カウント関数のリストが表示されハイライト表示されている](../images/ui/segment-builder/select-count.png)

### 時間制約 {#time-constraints}

時間制約を使用すると、時間ベースの属性、イベントおよびイベント間のシーケンスに時間制限を適用できます。

>[!IMPORTANT]
>
>2024 年 6 月より前の「今月」または「今年」の時間制約を持つセグメント定義を作成した場合、セグメント定義を再保存する必要があります。 2024 年 6 月以前は、「今月」は 30 日、「今年」は 365 日に基づいていました。

>[!NOTE]
>
>[ 年の時間制約を無視 ](./ignore-year.md) と [ ルールレベルの時間制約 ](./segment-refactoring.md) は以前にリファクタリングされており、詳しくはリンクされた概要を参照してください。

使用可能な時間制約のリストを以下に示します。

+++ 利用可能な時間制約

>[!NOTE]
>
>すべての時間制約は UTC に基づいています。
>
>さらに、「[!UICONTROL &#x200B; 年を無視 &#x200B;]」チェックボックスが有効になっている場合、その年はセグメント定義評価の一部として **比較されません**。

| 時間制限 | 説明 | 「年を無視」を有効にできる | 例 |
| --------------- | ----------- | ------------------- | ------- |
| Today | 比較される属性またはイベントは本日 **発生する必要があります**。 | ○ | ![ 使用されている「Today」時間制約の例。](../images/ui/segment-builder/time-constraints/today.png){width="100" zoomable="yes"} |
| 昨日 | 比較される属性またはイベントは昨日発生した **必須** です。 | ○ | ![ 「Yesterday」時間制約が使用されている例。](../images/ui/segment-builder/time-constraints/yesterday.png){width="100" zoomable="yes"} |
| 今月 | 比較対象の属性またはイベントは今月 **発生する必要があります**。 | ○ | ![ 「今月」の時間制約が使用されている例。](../images/ui/segment-builder/time-constraints/this-month.png){width="100" zoomable="yes"} |
| 今年 | 比較対象の属性またはイベントは、今年 **発生する必要があります**。 | × | ![ 「This year」時間制約が使用されている例。](../images/ui/segment-builder/time-constraints/this-year.png){width="100" zoomable="yes"} |
| カスタム日付 | 比較する属性またはイベント **必須** は、指定された日付になります。 | ○ | ![ 「カスタムの日付」時間制約を使用した例。](../images/ui/segment-builder/time-constraints/custom-date.png){width="100" zoomable="yes"} |
| 過去 | 比較する属性またはイベント **必須** は、選択した最後の期間内に発生します。 この期間は、評価時間まで **含む** です。 | × | ![ 「最後に」の時間制約が使用されている例 ](../images/ui/segment-builder/time-constraints/in-last.png){width="100" zoomable="yes"} |
| から | 比較する属性またはイベントは **必ず**、選択した 2 つのカレンダー日付内に存在します。 この期間には、両方の日付の **両方を含む** が指定されます。 | はい（カスタム日付の場合） | ![ 使用されている「からへ」の例。](../images/ui/segment-builder/time-constraints/from-to.png){width="100" zoomable="yes"} |
| 次の期間 | 比較する属性またはイベント **必須** は、選択した月または年の範囲内で発生します。 月を選択した場合、属性またはイベントが発生した月と年の両方を選択する必要があります。  年を選択した場合は、属性またはイベントが発生した年を選択するだけです。 月を選択した場合は、「[!UICONTROL &#x200B; 年を無視 &#x200B;]」チェックボックスを有効にすることもできます。 | ○ | ![ 使用されている「During」時間制約の例。](../images/ui/segment-builder/time-constraints/during.png){width="100" zoomable="yes"} |
| （+/ –）内 | 比較される属性またはイベント **必須** は、選択した日付から数日、数週間、数か月、または数年以内に発生します。 この期間には、両方の日付の **両方を含む** が指定されます。 選択した日付は、今日、昨日または別のカスタム日付にすることができます。 | ○ | ![ 使用されている「Within」時間制約の例。](../images/ui/segment-builder/time-constraints/within.png){width="100" zoomable="yes"} |
| 次の前 | 比較する属性またはイベント **必須** は、選択した日付より前です。 選択した日付は、カスタムの指定日でも、日、週、月、または年前の範囲で選択した日付でもかまいません。 | ○ | ![ 使用されている「前」時間制約の例。](../images/ui/segment-builder/time-constraints/before.png){width="100" zoomable="yes"} |
| 後 | 比較する属性またはイベント **選択した日付の後** ある必要があります）。 選択した日付は、カスタムの指定日でも、日、週、月、または年前の範囲で選択した日付でもかまいません。 | ○ | ![ 使用されている「After」時間制約の例。](../images/ui/segment-builder/time-constraints/after.png){width="100" zoomable="yes"} |
| ローリングレンジ | 比較する属性またはイベントは、2 つの相対日付の間に存在する必要があります。 日付は、秒、分、時間、日、週、月、または年単位で表すことができます。 | × | ![ 使用されている「ローリング範囲」時間制約の例。](../images/ui/segment-builder/time-constraints/rolling-range.png){width="100" zoomable="yes"} |
| 次以内： | 比較する属性またはイベントは、選択した次の期間内に発生する必要があります。 選択した期間には、分、時間、日、週、月、年が含まれます。 | × | ![ 「次回に」時間制約が使用されている例 ](../images/ui/segment-builder/time-constraints/in-next.png){width="100" zoomable="yes"} |
| exists | 属性が存在する。 | × | ![ 使用されている「存在する」時間制約の例 ](../images/ui/segment-builder/time-constraints/exists.png){width="100" zoomable="yes"} |
| が存在しない | 属性が存在しません。 | × | ![ 使用されている「存在しない」時間制約の例 ](../images/ui/segment-builder/time-constraints/does-not-exist.png){width="100" zoomable="yes"} |

+++

イベントに時間制約を適用する場合は、キャンバスレベル、カードレベルまたはイベント間で時間制約を適用できます。

#### キャンバスレベルの制約

キャンバスレベルの時間制約を適用するには、イベントのタイムラインの上に表示される時計アイコンを選択します。

![ キャンバスレベルの時間制約セレクターがハイライト表示されている様子 ](../images/ui/segment-builder/time-constraints/canvas-level.png)

キャンバスレベルで時間制約を適用すると、オーディエンスの **すべて** のイベントに時間制約が適用されます。

#### カードレベルの制約

カードレベルの制約を適用するには、時間制約を適用するカード、省略記号アイコン、「時間ルールの適用 **[!UICONTROL の順に選択し]** す。 これにより、「**[!UICONTROL イベントルール]** コンテナ内で時間制約を選択できます。

![ カードレベルの時間制約セレクターがハイライト表示されています。](../images/ui/segment-builder/time-constraints/card-level.png)

カードレベルで時間制約を適用すると、オーディエンスの **指定** イベントに時間制約が適用されます。

#### イベント間制約

イベント間に時間制約を適用するには、時間制約を適用する 2 つのイベント間の時計アイコンを選択します。

![ イベント間の時間制約セレクターがハイライト表示されています。](../images/ui/segment-builder/time-constraints/between-event.png)

イベント間に時間制約を適用すると、イベント間の時間に時間制約 **適用** れます。

この操作に使用できる時間制約のリストは、時間制約のメインリストとは異なり、次のようになります。

+++ 利用可能な時間制約

| 時間制限 | 説明 |
| --------------- | ----------- |
| 後 | 後者のイベント **少なくとも** は、前のイベントの後に発生する必要があります。 |
| 内 | 2 つのイベント **必須** は、時間制約内にリストされた期間に発生します。 |

>[!NOTE]
>
>「After」時間制約を使用する場合、後者のイベントは、時間制約にリストされた時間よりも長く発生する可能性があります。 >
>&#x200B;>例えば、ページビューイベントとチェックアウトイベントがあり、これら 2 つのイベント間に「1 時間後」時間制約を配置した場合、ページビューイベントの 2 時間後にチェックアウトイベントを含むセグメント定義が選定されます。
>
>さらに、これら 2 つの時間制約を相互に連携して使用できます。
>
>例えば、ページビューイベントとチェックアウトイベントがあり、「1 時間後」と「24 時間以内」の時間制約の両方を配置した場合、ページビューイベントから 12 時間後にチェックアウトイベントを含むセグメント定義は選定されますが、ページビューイベントから 36 時間後にチェックアウトイベントを含むセグメント定義は選定されません。

+++

## コンテナ {#containers}

セグメントルールは、リストでの表示順に従って評価されます。コンテナでは、ネストされたクエリを使用して、評価の順序を制御できます。

ルールビルダーキャンバスにタイルを 1 つ以上追加したら、コンテナの追加を開始できます。新しいコンテナを作成するには、タイルの右上隅にある省略記号（...）を選択し、「**[!UICONTROL コンテナを追加]**」を選択します。

![「コンテナを追加」ボタン（コンテナを最初のコンテナの子として追加できる）がハイライト表示されている](../images/ui/segment-builder/add-container.png)

新しいコンテナが最初のコンテナの子として表示されますが、コンテナをドラッグして移動することで、階層を調整することができます。コンテナのデフォルト動作は、指定された属性、イベントまたはオーディエンスを「[!UICONTROL 含める]」ようになっています。コンテナ条件に一致するプロファイルを「[!UICONTROL 除外する]」ようにルールを設定するには、タイルの左上隅にある「**[!UICONTROL 含める]**」を選択し、「[!UICONTROL 除外する]」に変更します。

子コンテナを抜き出して、親コンテナにインラインで追加することもできます。それには、子コンテナで「コンテナを展開」を選択します。このオプションにアクセスするには、子コンテナの右上隅にある省略記号（...）を選択します。

![コンテナを展開または削除できるオプションがハイライト表示されています。](../images/ui/segment-builder/include-exclude.png)

「**[!UICONTROL コンテナを展開]**」を選択すると、子コンテナが削除され、条件がインライン表示されます。

>[!NOTE]
>
>コンテナを展開する場合には、ロジックが引き続き目的のセグメント定義を満たすようにしてください。

![展開後のコンテナの表示](../images/ui/segment-builder/unwrapped-container.png)

## 結合ポリシー

>[!CONTEXTUALHELP]
>id="platform_segmentation_createSegment_segmentBuilder_mergePolicies"
>title="結合ポリシー"
>abstract="結合ポリシーを使用すると、様々なデータセットを結合してプロファイルを形成できます。Experience Platform にはデフォルトの結合ポリシーが用意されていますが、プロファイルで新しいデフォルトの結合ポリシーを作成することもできます。このオーディエンスに対するマーケティング目的に合った結合ポリシーを選択します。"

[!DNL Experience Platform] では、個々の顧客の全体像を把握するために、複数のソースからのデータを統合することができます。このようなデータを統合する場合、データをどのように優先順位付けするかや、どのようなデータを組み合わせてプロファイルを作成するかを決定するために [!DNL Experience Platform] で使用されるルールが結合ポリシーです。

このオーディエンスのマーケティング目的に合った結合ポリシーを選択することも、[!DNL Experience Platform] から提供されるデフォルトの結合ポリシーを使用することもできます。デフォルトの結合ポリシーを独自に作成することも含め、組織に固有の複数の結合ポリシーを作成できます。組織の結合ポリシーを作成する手順については、まず[結合ポリシーの概要](../../profile/merge-policies/overview.md)を参照してください。

セグメント定義の結合ポリシーを選択するには、「**[!UICONTROL フィールド]**」タブの歯車アイコンを選択し、使用する結合ポリシーを&#x200B;**[!UICONTROL 結合ポリシー]**&#x200B;ドロップダウンメニューで選択します。

![結合ポリシーセレクターがハイライト表示されています。これを使用してセグメント定義の結合ポリシーを選択できます。](../images/ui/segment-builder/merge-policy-selector.png)

## セグメント定義プロパティ {#segment-properties}

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_segmentproperties"
>title="セグメント定義プロパティ"
>abstract="「セグメント定義プロパティ 」セクションには、生成されるセグメント定義のサイズの推定が表示され、プロファイルの合計数と比較して適格なプロファイルの数が表示されます。これにより、オーディエンスそのものを作成する前に、必要に応じてセグメント定義を調整できます。"

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_refreshestimate"
>title="推定の更新"
>abstract="セグメント定義の推定を更新すると、提案されたセグメント定義に適格と思われるプロファイルの数をすぐにプレビューできます。オーディエンスの推定値は、その日のサンプルデータから抽出したサンプルサイズを使用して生成されます。"
>additional-url="https://experienceleague.adobe.com/docs/experience-platform/segmentation/tutorials/create-a-segment.html?lang=ja#estimate-and-preview-an-audience" text="オーディエンスの推定とプレビュー"

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_qualifiedprofiles"
>title="認定プロファイル数"
>abstract="認定プロファイル数は、セグメント定義のルールに一致するプロファイルの実際の数を示します。この数は、セグメント評価ジョブの実行後、24時間ごとに更新されます。"

>[!CONTEXTUALHELP]
>id="platform_segments_createsegment_segmentbuilder_estimatedprofiles"
>title="推定プロファイル数"
>abstract="推定プロファイル数は、サンプルジョブに基づいて、セグメント定義のルールに適合するプロファイルの概算数を示します。つまり、より大きなプロファイルセットにサンプルデータが投影されるので、実際の適合プロファイルの数とは異なる推定数が生じる場合があります。推定プロファイル数サンプルには、95％の信頼区間があります。<br><br>この数は、サンプルジョブを更新すると更新されます。これは、顧客データに 5％を超える変更がある場合や、最後のサンプルジョブが 7 日を超える場合に発生します。"

セグメント定義を作成する際には、作成されるセグメント定義の推定サイズがワークスペースの右側の **[!UICONTROL オーディエンスのプロパティ]** セクションに表示されるので、オーディエンスそのものを作成する前にセグメント定義を必要に応じて調整できます。

**[!UICONTROL 認定プロファイル]** は、セグメント定義のルールに一致するプロファイルの **実際** 数を示します。 この数は、セグメント評価ジョブの実行後、24時間ごとに更新されます。

認定プロファイルのタイムスタンプは、最新の **バッチ** セグメント評価ジョブを示し、ストリーミングまたはエッジセグメント化を使用して評価されたセグメント定義には表示 **されません**。 セグメント定義を編集すると、次のセグメント評価ジョブが実行されるまで、認定プロファイルの数は同じままです。

**[!UICONTROL 推定プロファイル]** は、（サンプルジョブ **に基づいたプロファイルの** 概算 **数を示し** す。 つまり、より大きなプロファイルセットにサンプルデータが投影されるので、実際の適合プロファイルの数とは異なる推定数が生じる場合があります。推定プロファイルサンプルには、95% の信頼区間があります。

この数値は、サンプルジョブが更新されたときに更新されます。これは、顧客データが 5% 以上変更された場合、または最後のサンプルジョブが 7 日を超えた場合に発生します。」

情報バブルを選択すると、エラーしきい値と最新のサンプルジョブ時間が表示されます。

![ 認定プロファイルと推定プロファイルは、「オーディエンスプロパティ」セクションでハイライト表示されます。](../images/ui/segment-builder/audience-estimates.png)

「**[!UICONTROL オーディエンスプロパティ]**」セクションでは、名前、説明、評価タイプなど、セグメント定義に関する重要な情報を指定することもできます。 セグメント定義名は、組織で定義されたものの中から目的のセグメント定義を識別する際に使用されます。このため、セグメント定義名は、内容がわかりやすく簡潔、かつ一意である必要があります。

セグメント定義の作成中、「**[!UICONTROL プロファイルを表示]**」を選択することで、オーディエンスのプレビューをページ別に表示できます。

![セグメント定義のプロパティセクションがハイライト表示されています。 セグメント定義のプロパティには、セグメント定義名、説明、評価方法などがありますが、これらに限定されません。](../images/ui/segment-builder/segment-properties.png)

>[!NOTE]
>
>オーディエンスの推定値は、その日のサンプルデータから抽出したサンプルサイズを使用して生成されます。プロファイルストアのエンティティ数が 100 万個未満の場合、完全なデータセットが使用されます。エンティティの数が 1～2,000 万の場合は 100 万のエンティティが使用され、2,000 万を超えるエンティティの場合は合計エンティティの 5% が使用されます。
>
>さらに、この見積もりは、最後のプロファイルサンプルジョブが実行された日時に基づきます。 つまり、「Today」や「This week」などの相対的な日付関数を使用している場合、見積もりは最後のプロファイルサンプルジョブ実行時間に基づいて計算されます。 例えば、今日が 1 月 24 日で、最後のプロファイルサンプルジョブが 1 月 22 日に実行された場合、「昨日」相対日付関数は 1 月 23 日ではなく、1 月 21 日に基づきます。
>
>セグメント定義の推定サイズを生成する方法について詳しくは、セグメント定義の作成に関するチュートリアルの[予測値の生成に関する節](../tutorials/create-a-segment.md#estimate-and-preview-an-audience)を参照してください。

また、評価方法を選択することもできます。 使用する評価方法がわかっている場合は、ドロップダウンリストを使用して、目的の評価方法を選択できます。 このセグメント定義が適合する評価タイプを知りたい場合、「参照」アイコン（![拡大鏡付きのフォルダーアイコン](/help/images/icons/folder-search.png)）を選択すると、使用可能なセグメント定義の評価方法のリストが表示されます。

[!UICONTROL 評価方法の実施要件]ポップオーバーが表示されます。 このポップオーバーには、使用可能な評価方法（バッチ、ストリーミングおよびエッジ）が表示されます。 ポップオーバーには、どの評価方法が適格か不適格かが表示されます。 セグメント定義で使用したパラメーターによっては、特定の評価方法に適合しない場合があります。 各評価方法の要件について詳しくは、[ストリーミングセグメント化](../methods/streaming-segmentation.md#query-types)または[エッジセグメント化](../methods/edge-segmentation.md#query-types)の概要を参照してください。

また、セグメント定義の作成が完了したら、その評価方法を変更することもできます。 評価方法を「Edge」または「ストリーミング」から「バッチ」に変更すると **Edgeまたはストリーミングに戻すことはで** ません。 評価方法の変更は、ポップオーバーで **保存** を選択した **[!UICONTROL のみ]** 有効になります。 ダイアログをキャンセルすると、元の評価方法が **維持** されます。

![評価方法の実施要件のポップアップが表示されます。 このポップアップには、どの評価方法が対象のセグメント定義に適格か不適格かが表示されます。](../images/ui/segment-builder/select-evaluation-method.png)

無効な評価方法を選択すると、セグメント定義ルールを変更するか、評価方法を変更するかを尋ねるプロンプトが表示されます。

![評価方法がポップアップ表示されます。 不適格な評価方法が選択された場合、不適格である理由がポップアップで説明されます。](../images/ui/segment-builder/ineligible-evaluation-method.png)

様々なセグメント定義評価方法について詳しくは、[セグメント化の概要](../home.md#evaluate-segments)を参照してください。

## 次の手順 {#next-steps}

セグメントビルダーには、マーケティング可能なオーディエンスを [!DNL Real-Time Customer Profile] データから分離するのに使用できる機能豊富なワークフローが用意されています。このガイドをお読みになると、次のことができるようになります。

- 属性、イベントおよび既存のオーディエンスの組み合わせを構成要素として使用して、セグメント定義を作成する。
- ルールビルダーキャンバスとコンテナを使用して、セグメントルールの実行順を制御する。
- 見込みオーディエンスの予測値を表示する。必要に応じてセグメント定義を調整できます。
- スケジュールに沿ったセグメント化に対してすべてのセグメント定義を有効にする。
- ストリーミングによるセグメント化に対して、特定のセグメント定義を有効にする。

[!DNL Segmentation Service] について詳しくは、引き続きこのドキュメントを参照し、関連するビデオを視聴して知識を補ってください。[!DNL Segmentation Service] UI の他の部分について詳しくは、[[!DNL Segmentation Service] ユーザーガイド](./overview.md)を参照してください。
