---
keywords: Experience Platform；ホーム；人気のあるトピック；スキーマ；スキーマ；列挙；プライマリ ID；プライマリ ID;XDM 個人プロファイル；エクスペリエンスイベント；XDM エクスペリエンスイベント；XDM エクスペリエンスイベント；experienceEvent;experienceevent;XDM エクスペリエンスイベント；スキーマデザイン；ベストプラクティス
solution: Experience Platform
title: データモデリングのベストプラクティス
topic-legacy: overview
description: このドキュメントでは、エクスペリエンスデータモデル（XDM）スキーマの概要と、Adobe Experience Platform で使用するスキーマを構成するための構成要素、原則およびベストプラクティスを紹介します。
exl-id: 2455a04e-d589-49b2-a3cb-abb5c0b4e42f
source-git-commit: 39d04cf482e862569277211d465bb2060a49224a
workflow-type: tm+mt
source-wordcount: '2524'
ht-degree: 3%

---

# データモデリングのベストプラクティス

[!DNL Experience Data Model] (XDM) は、ダウンストリームAdobe Experience Platformサービスで使用する共通の構造と定義を提供することで、顧客体験データを標準化する中核的なフレームワークです。XDM 標準に準拠することで、すべての顧客体験データを共通の表現に組み込み、顧客行動から有益なインサイトを得たり、セグメントを通じて顧客オーディエンスを定義したり、パーソナライゼーション目的で顧客属性を表したりできます。

XDM は非常に汎用性が高く、デザインによってカスタマイズ可能なので、スキーマを設計する際には、データモデリングのベストプラクティスに従うことが重要です。 このドキュメントでは、顧客体験データを XDM にマッピングする際に重要な決定事項と考慮事項について説明します。

## はじめに

このガイドを読む前に、「[XDM システムの概要 ](../home.md)」で XDM の概要と、Experience Platform内での役割について確認してください。

さらに、このガイドでは、スキーマデザインに関する主な考慮事項にのみ焦点を当てています。 したがって、このガイド全体で取り上げる個々のスキーマ要素の詳細については、[ スキーマ構成の基本 ](./composition.md) を参照することを強くお勧めします。

## ベストプラクティスのまとめ

Experience Platformで使用するデータモデルを設計するための推奨されるアプローチを、次のように要約できます。

1. データのビジネスユースケースを理解する。
1. これらの使用例に対処するために [!DNL Platform] に取り込む必要があるプライマリデータソースを特定します。
1. 関心を持つ可能性のあるセカンダリデータソースを特定します。 例えば、現在、組織内の 1 つのビジネスユニットのみがデータを [!DNL Platform] に移植する場合、同様のビジネスユニットも将来、同様のデータの移植に関心を持つ可能性があります。 これらのセカンダリソースを考慮すると、組織全体でデータモデルを標準化できます。
1. 識別されたデータソースの概要エンティティの関係図 (ERD) を作成します。
1. 高レベルの ERD を [!DNL Platform] 中心の ERD（プロファイル、エクスペリエンスイベント、ルックアップエンティティなど）に変換します。

ビジネスの使用例を実行するのに必要な適切なデータソースの特定に関する手順は、組織によって異なります。 このドキュメントの残りの節では、データソースを特定した後に ERD を整理して構築する後の手順に焦点を当てますが、図の様々なコンポーネントの説明によって、どのデータソースを [!DNL Platform] に移行するかの判断が示されます。

## 高レベルの ERD を作成する

[!DNL Platform] に取り込むデータソースを決定したら、高レベルの ERD を作成して、データを XDM スキーマにマッピングするプロセスをガイドします。

次の例は、[!DNL Platform] にデータを取り込む企業の簡易 ERD を示しています。 次の図は、XDM クラスに分類する必要がある基本エンティティ（顧客アカウント、ホテル、住所、一般的な e コマースイベントなど）を示しています。

![](../images/best-practices/erd.png)

## エンティティをプロファイル、ルックアップ、イベントカテゴリに並べ替える

[!DNL Platform] に取り込む必要のあるエンティティを識別する ERD を作成したら、これらのエンティティをプロファイル、ルックアップ、イベントカテゴリに分類する必要があります。

| カテゴリ | 説明 |
| --- | --- |
| プロファイルエンティティ | プロファイルエンティティは、個人（通常は顧客）に関連する属性を表します。 このカテゴリに該当するエンティティは、**[!DNL XDM Individual Profile]クラス** に基づくスキーマで表される必要があります。 |
| 参照エンティティ | ルックアップエンティティは、個人に関連付けることができる概念を表しますが、個人を識別するために直接使用することはできません。 このカテゴリに該当するエンティティは、**カスタムクラス** に基づくスキーマで表される必要があります。 |
| イベントエンティティ | イベントエンティティは、顧客が実行できるアクション、システムイベント、または時間の経過と共に変更を追跡する必要があるその他の概念に関連する概念を表します。 このカテゴリに該当するエンティティは、**[!DNL XDM ExperienceEvent]クラス** に基づくスキーマで表される必要があります。 |

{style=&quot;table-layout:auto&quot;}

### エンティティの並べ替えに関する考慮事項

以下の節では、エンティティを上記のカテゴリに分類する方法について詳しく説明します。

#### 顧客属性

エンティティに個々の顧客に関連する属性が含まれている場合、そのエンティティはおそらくプロファイルエンティティです。 顧客属性の例を次に示します。

* 名前、生年月日、性別、アカウント ID などの個人の詳細。
* 住所や GPS 情報などの位置情報。
* 電話番号や電子メールアドレスなどの連絡先情報。

#### 経時的なデータの追跡

エンティティ内の特定の属性が時間の経過と共にどのように変化するかを分析する場合は、イベントエンティティである可能性が最も高くなります。 例えば、買い物かごへの製品項目の追加は、[!DNL Platform] の買い物かごへの追加イベントとして追跡できます。

| 顧客 ID | タイプ | 製品 ID | 数量 | タイムスタンプ |
| --- | --- | --- | --- | --- |
| 1234567 | Add | 275098 | 2 | 10 月 1 日午前 10 時 32 分 |
| 1234567 | 削除 | 275098 | 1 | 10 月 1 日午前 10 時 33 分 |
| 1234567 | 追加 | 486502 | 1 | 10 月 1 日午前 10 時 41 分 |
| 1234567 | 追加 | 910482 | 5 | 10 月 3 日午後 2 時 15 分 |

{style=&quot;table-layout:auto&quot;}

#### セグメント化の使用例

エンティティを分類する場合は、特定のビジネスユースケースに対応するために、作成するオーディエンスセグメントについて検討する必要があります。

例えば、ある会社は、昨年 5 回以上購入したロイヤルティプログラムの「ゴールド」メンバーや「プラチナ」メンバー全員を知りたいと考えています。 このセグメントロジックに基づいて、関連エンティティの表現方法に関して次の結論を出すことができます。

* 「ゴールド」と「プラチナ」は、個々の顧客に適用可能なロイヤルティステータスを表します。 セグメントロジックは顧客の現在の忠誠度ステータスのみに関係するので、このデータはプロファイルスキーマの一部としてモデル化できます。 ロイヤリティステータスの変化を時間の経過と共に追跡する場合は、ロイヤリティステータスの変更に関する追加のイベントスキーマを作成することもできます。
* 購入とは、特定の時間に発生するイベントで、セグメントロジックは、指定した時間枠内の購入イベントに関係します。 したがって、このデータはイベントスキーマとしてモデル化する必要があります。

#### アクティベーションの使用例

セグメント化の使用例に関する考慮事項に加えて、これらのセグメントのアクティブ化の使用例を確認して、関連する属性をさらに特定する必要があります。

例えば、会社が `country = US` というルールに基づいてオーディエンスセグメントを作成したとします。 次に、特定のダウンストリームターゲットに対してそのセグメントをアクティブ化する際に、書き出されたすべてのプロファイルを自宅の状態に基づいてフィルタリングします。 したがって、 `state` 属性は、該当するプロファイルエンティティでもキャプチャする必要があります。

#### 集計値

データの使用例と精度に基づいて、特定の値を事前に集計してから、プロファイルまたはイベントエンティティに含める必要があるかどうかを判断する必要があります。

例えば、ある会社は、買い物かごの購入数に基づいてセグメントを作成したいと考えています。 各タイムスタンプ付き購入イベントを独自のエンティティとして含めることで、最も低い精度でこのデータを取り込むことを選択できます。 ただし、記録されたイベントの数が急激に増える場合があります。 取り込まれるイベントの数を減らすには、1 週間または 1 ヶ月の間に集計値 `numberOfPurchases` を作成するように選択します。 MIN やMAXなどの他の集計関数も、この状況に適用できます。

>[!CAUTION]
>
>Experience Platformは、現在、自動値集計を実行しませんが、将来のリリースで予定されています。 集計値を使用する場合は、[!DNL Platform] にデータを送信する前に、外部で計算を実行する必要があります。

#### カーディナリティ

ERD で確立された基準は、エンティティの分類方法に関する手がかりを提供することもできます。 2 つのエンティティ間に 1 対多の関係がある場合、「多」を表すエンティティはイベントエンティティである可能性が高くなります。 ただし、「多」とは、プロファイルエンティティ内の配列として提供されるルックアップエンティティのセットのことです。

>[!NOTE]
>
>すべての使用例に適合するユニバーサルアプローチはないので、基数に基づいてエンティティを分類する際には、各状況の長所と短所を考慮することが重要です。 詳しくは、[ 次のセクション ](#pros-and-cons) を参照してください。

次の表に、一般的なエンティティの関係と、それらから派生できるカテゴリを示します。

| 関係 | カーディナリティ | エンティティのカテゴリ |
| --- | --- | --- |
| 顧客と買い物かごのチェックアウト | 1 対多 | 1 人の顧客に多数の買い物かごのチェックアウトがある場合があります。これは、時間の経過と共に追跡できるイベントです。 したがって、顧客はプロファイルエンティティ、買い物かごのチェックアウトはイベントエンティティになります。 |
| 顧客とロイヤリティアカウント | 1 対 1 | 1 人の顧客が持つことのできるロイヤルティアカウントは 1 つだけで、逆も同様です。 関係は 1 対 1 なので、顧客とロイヤルティアカウントの両方がプロファイルエンティティを表します。 |
| 顧客と購読 | 1 対多 | 1 人の顧客が多数のサブスクリプションを持っている場合があります。 この会社は顧客の現在のサブスクリプションのみを扱うので、 Customers はプロファイルエンティティ、 Subscriptions はルックアップエンティティです。 |

{style=&quot;table-layout:auto&quot;}

### 異なるエンティティクラスの長所と短所 {#pros-and-cons}

前の節では、エンティティの分類方法を決定するための一般的なガイドラインをいくつか示しましたが、1 つのエンティティカテゴリを別のエンティティのカテゴリよりも優先して選択する場合に長所と短所が生じる場合があることを理解することが重要です。 次のケーススタディでは、このような状況でオプションをどのように考慮するかを説明します。

会社は、1 人の顧客が多数のサブスクリプションを持つことができる、顧客のアクティブなサブスクリプションを追跡します。 また、アクティブな購読を持つすべてのユーザーを検索するなど、セグメント化の使用例の購読を含めたいと考えています。

このシナリオでは、データモデルで顧客の購読を表す 2 つの選択肢が考えられます。

1. [プロファイル属性の使用](#profile-approach)
1. [イベントエンティティの使用](#event-approach)

#### アプローチ 1:プロファイル属性の使用 {#profile-approach}

1 つ目のアプローチは、購読の配列を属性として顧客のプロファイルエンティティに含めることです。 この配列内のオブジェクトには、`category`、`status`、`planName`、`startDate`、および `endDate` のフィールドが含まれます。

<img src="../images/best-practices/profile-schema.png" width="800"><br>

**長所**

* セグメント化は、意図した使用例で可能です。
* スキーマは、顧客の最新のサブスクリプションレコードのみを保持します。

**短所**

* 配列内のフィールドが変更されるたびに、配列全体を再記述する必要があります。
* 異なるデータソースやビジネスユニットがアレイにデータを送る場合、最新の更新済みアレイをすべてのチャネルで同期し続けるのは困難になります。

#### アプローチ 2:イベントエンティティの使用 {#event-approach}

2 つ目のアプローチは、イベントスキーマを使用して購読を表すことです。 これには、最初のアプローチと同じ購読フィールドに、購読 ID、顧客 ID、購読イベントが発生した日時のタイムスタンプを追加して取り込みます。

<img src="../images/best-practices/event-schema.png" width="800"><br>

**長所**

* セグメント化ルールは、より柔軟に設定できます（過去 30 日間に購読を変更したすべての顧客を検索するなど）。
* 顧客のサブスクリプションステータスが変更された場合、顧客のプロファイル属性内の長く複雑な可能性のあるアレイを更新する必要がなくなりました。 これは、顧客のサブスクリプションリストに対する同時変更が複数のソースから発生する場合に特に便利です。

**短所**

* セグメント化は、元の意図されたユースケース（顧客の最新のサブスクリプションのステータスを識別する）でより複雑になります。 セグメントのステータスを確認するために、顧客の最後のサブスクリプションイベントにフラグを設定する追加のロジックが必要になりました。

## 分類されたエンティティに基づくスキーマの作成

エンティティをプロファイル、ルックアップ、イベントカテゴリに並べ替えたら、データモデルの XDM スキーマへの変換を開始できます。 デモ用に、前述の例のデータモデルは、次の図で適切なカテゴリに分類されています。

<img src="../images/best-practices/erd-sorted.png" width="800"><br>

エンティティが並べ替えられたカテゴリは、スキーマの基にする XDM クラスを決定します。 繰り返し実行する手順は、次のとおりです。

* プロファイルエンティティは、[!DNL XDM Individual Profile] クラスを使用する必要があります。
* イベントエンティティは、[!DNL XDM ExperienceEvent] クラスを使用する必要があります。
* ルックアップエンティティは、組織で定義されたカスタム XDM クラスを使用する必要があります。

>[!NOTE]
>
>イベントエンティティはほとんどの場合、別々のスキーマで表されますが、プロファイルカテゴリまたは参照カテゴリのエンティティは、基数に応じて 1 つの XDM スキーマに組み合わせることができます。
>
>例えば、 Customers エンティティと LoyaltyAccounts エンティティは 1 対 1 の関係にあるので、 Customers エンティティのスキーマには、各顧客に適したロイヤルティフィールドを含む `LoyaltyAccount` オブジェクトを含めることもできます。 ただし、関係が 1 対多の場合、「多」を表すエンティティは、複雑さに応じて、別のスキーマまたはプロファイル属性の配列で表すことができます。

以下の節では、ERD に基づいてスキーマを作成する際の一般的なガイダンスを示します。

### 反復モデリングアプローチの採用

スキーマ進化の [ ルール ](./composition.md#evolution) では、実装後にスキーマに対して非破壊的な変更のみを加えることができます。 つまり、スキーマにフィールドを追加し、そのフィールドに対してデータを取り込むと、そのフィールドは削除できなくなります。 したがって、スキーマを最初に作成するときに、反復的なモデリングアプローチを採用する必要があります。最初はシンプルな実装を使用し、時間の経過と共に徐々に複雑さを増します。

特定のフィールドをスキーマに含める必要があるかどうかが不明な場合は、除外することをお勧めします。 後でフィールドが必要と判断された場合は、常にスキーマの次の反復で追加できます。

### ID フィールド

Experience Platformでは、ID としてマークされた XDM フィールドを使用して、複数のデータソースから取得した個々の顧客に関する情報を結び付けます。 1 つのスキーマに複数のフィールドを ID としてマークすることができますが、[!DNL Real-time Customer Profile] でスキーマを使用するには、1 つのプライマリ ID を定義する必要があります。 これらのフィールドの使用例について詳しくは、スキーマ構成の基本の [ID フィールド ](./composition.md#identity) に関する節を参照してください。

スキーマを設計する際、リレーショナル・データベース表内のプライマリ・キーは、プライマリ ID の候補となる場合があります。 該当する ID フィールドの他の例としては、顧客の電子メールアドレス、電話番号、アカウント ID、[ECID](../../identity-service/ecid.md) があります。

### Adobeアプリケーションスキーマフィールドグループ

Experience Platformには、次のスキーマアプリケーションに関連するデータを取り込むための、あらかじめ用意されているいくつかの XDMAdobeフィールドグループが用意されています。

* Adobe Analytics
* Adobe Audience Manager
* Adobe Campaign
* Adobe Target

例えば、[[!UICONTROL Adobe Analytics ExperienceEvent テンプレート ] フィールドグループ ](https://github.com/adobe/xdm/blob/master/extensions/adobe/experience/analytics/experienceevent-all.schema.json) を使用すると、[!DNL Analytics] 固有のフィールドを XDM スキーマにマッピングできます。 使用しているAdobeアプリケーションに応じて、スキーマでこれらのAdobe提供のフィールドグループを使用する必要があります。

<img src="../images/best-practices/analytics-field-group.png" width="700"><br>

Adobeアプリケーションフィールドグループは、 `identityMap` フィールドを使用して、デフォルトのプライマリ ID を自動的に割り当てます。このフィールドは、システムで生成され、読み取り専用のオブジェクトで、個々の顧客の標準 ID 値をマッピングします。

Adobe Analyticsの場合、 ECID がデフォルトのプライマリ ID です。 ECID 値が顧客によって提供されない場合、プライマリ ID は代わりにデフォルトで AAID に設定されます。

>[!IMPORTANT]
>
>Adobeアプリケーションフィールドグループを使用する場合、他のフィールドをプライマリ ID としてマークしないでください。 ID としてマークする必要がある追加のプロパティがある場合、これらのフィールドをセカンダリ ID として割り当てる必要があります。

## 次の手順

このドキュメントでは、Experience Platform用のデータモデルを設計する際の一般的なガイドラインとベストプラクティスを説明しました。 要約すると、

* スキーマを作成する前に、データテーブルをプロファイル、ルックアップ、イベントカテゴリに並べ替えて、トップダウンアプローチを使用します。
* 様々な目的でスキーマをデザインする際には、多くの場合、複数のアプローチやオプションがあります。
* データモデルは、セグメント化やカスタマージャーニー分析などのビジネスユースケースをサポートする必要があります。
* スキーマをできるだけ簡単にし、必要な場合にのみ新しいフィールドを追加します。

準備が整ったら、UI での [ スキーマの作成 ](../tutorials/create-schema-ui.md) に関するチュートリアルを参照して、スキーマの作成、エンティティに適したクラスの割り当て、データのマッピング先のフィールドの追加手順を確認します。
