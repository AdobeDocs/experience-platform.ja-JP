---
solution: Experience Platform
title: 同意と環境設定スキーマフィールドグループ
topic-legacy: overview
description: このドキュメントでは、「同意と環境設定」スキーマフィールドグループの概要を説明します。
exl-id: ec592102-a9d3-4cac-8b94-58296a138573
source-git-commit: 12c3f440319046491054b3ef3ec404798bb61f06
workflow-type: tm+mt
source-wordcount: '2317'
ht-degree: 2%

---

# [!UICONTROL [同意と環境設定]] フィールドグループ

[!UICONTROL 同意と環境設定]は、顧客の同意と好みの情報を取り込むために [[!DNL XDM Individual Profile] 使用される、クラス](../../classes/individual-profile.md)の標準フィールドグループです。

>[!NOTE]
>
>このフィールドグループは[!DNL XDM Individual Profile]とのみ互換性があるので、[!DNL XDM ExperienceEvent]スキーマには使用できません。 エクスペリエンスイベントスキーマに同意データと環境設定データを含める場合は、 [カスタムフィールドグループ](../../ui/resources/field-groups.md#create)を使用して、 [[!UICONTROL プライバシー、パーソナライゼーション、マーケティングの環境設定に対する同意]データ型](../../data-types/consents.md)を追加します。

## フィールドグループの構造 {#structure}

>[!IMPORTANT]
>
>[!UICONTROL 同意と環境設定]フィールドグループは、同意と環境設定の管理に関する様々な使用例を対象とするように設計されています。 そのため、このドキュメントでは、フィールドグループのフィールドの一般的な用語の使用について説明し、これらのフィールドの使用方法を解釈する方法についての提案のみを行います。 組織がこれらの同意や好みの選択をどのように解釈し、顧客に提示するかについては、プライバシー法務チームに相談して、フィールドグループの構造を整合させてください。

[!UICONTROL 同意と環境設定]フィールドグループには、**同意**&#x200B;および&#x200B;**環境設定**&#x200B;の情報を取り込むためのフィールドがいくつか用意されています。

同意とは、お客様がデータの使用方法を指定できるオプションです。 ほとんどの同意には法的側面があり、特定の方法でデータを使用するには、一部の管轄区域で許可を得る必要がある場合や、肯定的な同意が不要な場合は、お客様にその使用を停止する（オプトアウトする）オプションが必要です。

環境設定とは、顧客がブランドに関するエクスペリエンスの様々な側面を処理する方法を指定できるオプションです。 これらは、次の2つのカテゴリに分類されます。

* **パーソナライゼーションの環境設定**:顧客に提供されるエクスペリエンスをブランドがパーソナライズする方法に関する環境設定。
* **マーケティング環境設定**:様々なチャネルを通じてブランドが顧客との連絡を許可するかどうかに関する環境設定。

次のスクリーンショットは、フィールドグループの構造がPlatform UIでどのように表されるかを示しています。

![](../../images/field-groups/consent.png)

>[!TIP]
>
>XDMリソースを検索し、Platform UIで構造を調べる手順については、 [XDMリソース](../../ui/explore.md)ののを参照してください。

次のJSONは、[!UICONTROL 同意と環境設定]フィールドグループが処理できるデータのタイプの例を示しています。 これらの各フィールドの具体的な使用方法に関する情報は、以降の節で説明します。

```json
{
  "consents": {
    "collect": {
      "val": "VI"
    },
    "share": {
      "val": "y"
    },
    "personalize": {
      "content": {
        "val": "y"
      }
    },
    "marketing": {
      "preferred": "email",
      "any": {
        "val": "y"
      },
      "email": {
        "val": "y"
      }
    },
    "idSpecific": {
      "ECID": {
        "37784337855396895622558625508046772577": {
          "adID": {
            "val": "n",
          },
          "share": {
            "val": "n"
          },
          "marketing": {
            "push": {
              "val": "n",
              "time": "2020-09-30T01:02:33+00:00",
              "reason": "not relevant"
            }
          }
        }
      },
      "email": {
        "john@xyz.com": {
          "marketing": {
            "email": {
              "val": "y"
            }
          }
        }
      }
    },
    "metadata": {
      "time": "2019-01-01T15:52:25+00:00"
    }
  }
}
```

>[!TIP]
>
>顧客の同意と環境設定データのマッピング方法を視覚化できるよう、Experience Platformで定義する任意のXDMスキーマのサンプルJSONデータを生成できます。 詳しくは、次のドキュメントを参照してください。
>
>* [UIでのサンプルデータの生成](../../ui/sample.md)
* [APIでのサンプルデータの生成](../../api/sample-data.md)


## フィールドの使用例

これらの各フィールドの使用例は、以下の節で説明します。

### `collect`

`collect` は、データを収集することに対する顧客の同意を表します。

```json
"collect" : {
  "val": "y"
}
```

| プロパティ | 説明 |
| --- | --- |
| `val` | この使用例に対して、お客様が提供する同意の選択。 指定できる値と定義については、付録[を参照してください。](#choice-values) |

{style=&quot;table-layout:auto&quot;}

### `share`

`share` は、データをセカンドパーティと共有（またはセカンドパーティに販売）できるかどうかに関する顧客の同意を表します。

```json
"share" : {
  "val": "y"
}
```

| プロパティ | 説明 |
| --- | --- |
| `val` | この使用例に対して、お客様が提供する同意の選択。 指定できる値と定義については、付録[を参照してください。](#choice-values) |

{style=&quot;table-layout:auto&quot;}

### `personalize` {#personalize}

`personalize` では、顧客のデータをパーソナライゼーションに使用する方法に関する顧客の環境設定を取り込みます。お客様は、特定のパーソナライゼーションの使用例をオプトアウトしたり、完全にパーソナライゼーションをオプトアウトしたりできます。

>[!IMPORTANT]
`personalize` では、マーケティングの使用例は説明していません。例えば、すべてのチャネルのパーソナライゼーションをオプトアウトした顧客は、これらのチャネルを介したコミュニケーションの受信を停止しないでください。 代わりに、受信するメッセージは、プロファイルに基づくものではなく、汎用的なものにする必要があります。
同じ例で、顧客が（[次の節](#marketing)で説明する`marketing`を通じて）すべてのチャネルのダイレクトマーケティングをオプトアウトした場合、パーソナライゼーションが許可されていても、その顧客はメッセージを受け取りません。

```json
"personalize": {
  "content": {
    "val": "y",
  }
}
```

| プロパティ | 説明 |
| --- | --- |
| `content` | Webサイトやアプリケーション上でパーソナライズされたコンテンツに対する顧客の環境設定を表します。 |
| `val` | 指定した使用例に対する、顧客が指定したパーソナライゼーションの環境設定。 お客様が同意を得るように求められない場合は、このフィールドの値に、パーソナライゼーションを実行する基礎を示す必要があります。 指定できる値と定義については、付録[を参照してください。](#choice-values) |

{style=&quot;table-layout:auto&quot;}

### `marketing` {#marketing}

`marketing` は、自社のデータを使用できるマーケティング目的に関する顧客の環境設定を取り込みます。顧客は、特定のマーケティングの使用例をオプトアウトしたり、ダイレクトマーケティング全体をオプトアウトしたりできます。

```json
"marketing": {
  "preferred": "email",
  "any": {
    "val": "u"
  },
  "email": {
    "val": "n",
    "reason": "Too Frequent"
  },
  "push": {
    "val": "y"
  },
  "sms": {
    "val": "y"
  }
}
```

| プロパティ | 説明 |
| --- | --- |
| `preferred` | 顧客がコミュニケーションを受け取るための優先チャネルを示します。 指定できる値については、[付録](#preferred-values)を参照してください。 |
| `any` | ダイレクトマーケティングに関する顧客の好みを表します。 `marketing`の下に指定された追加のサブフィールドで上書きされない限り、このフィールドに指定された同意の設定は、すべてのマーケティングチャネルの「デフォルト」の設定と見なされます。 より詳細な同意オプションを使用する予定がある場合は、このフィールドを除外することをお勧めします。<br><br>値をに設定した場合、より具体的 `n`なパーソナライゼーション設定はすべて無視する必要があります。値を`y`に設定した場合、明示的に`n`に設定しない限り、すべての詳細なパーソナライゼーションオプションも`y`として扱う必要があります。 値が設定されていない場合、各パーソナライゼーションオプションの値を指定どおりに扱う必要があります。 |
| `email` | 顧客が電子メールメッセージの受信に同意するかどうかを示します。 顧客は、このチャネル内の個々の購読に関する環境設定を指定することもできます。 詳しくは、以下の[subscriptions](#subscriptions)の節を参照してください。 |
| `push` | 顧客がプッシュ通知の受信を許可するかどうかを示します。 顧客は、このチャネル内の個々の購読に関する環境設定を指定することもできます。 詳しくは、以下の[subscriptions](#subscriptions)の節を参照してください。 |
| `sms` | 顧客がテキストメッセージの受信に同意するかどうかを示します。 顧客は、このチャネル内の個々の購読に関する環境設定を指定することもできます。 詳しくは、以下の[subscriptions](#subscriptions)の節を参照してください。 |
| `val` | 指定した使用例に対する、お客様が指定した環境設定。 顧客が同意を得るように求められない場合、このフィールドの値はマーケティングの使用例を実行する基準を示す必要があります。 指定できる値と定義については、付録[を参照してください。](#choice-values) |
| `time` | マーケティング環境設定が変更された場合のISO 8601のタイムスタンプ（該当する場合）。 個々の環境設定のタイムスタンプが`metadata`で指定したタイムスタンプと同じ場合、このフィールドはその環境設定には設定されません。 |
| `reason` | 顧客がマーケティングの使用例をオプトアウトした場合、この文字列フィールドは、顧客がオプトアウトした理由を表します。 |

{style=&quot;table-layout:auto&quot;}

#### `subscriptions` {#subscriptions}

`marketing`オブジェクトの`email`、`push`および`sms`プロパティは、個々のチャネルの顧客購読を表すことができます。 これは、該当するマーケティングチャネルに`subscriptions`プロパティを追加することで実現されます。

```json
"marketing": {
  "email": {
    "val": "y",
    "subscriptions": {
      "daily-mail": {
        "val": "y",
        "type": "paid",
        "subscribers": {
          "john@xyz.com": {
            "time": "2019-01-01T15:52:25+00:00",
            "source": "website"
          }
        }
      },
      "shipped": {
        "val": "y",

        "subscribers": {
          "john@xyz.com": {
            "time": "2021-01-01T08:32:53+07:00",
            "source": "website"
          },
          "jane@xyz.com": {
            "time": "2020-02-03T07:54:21+07:00",
            "source": "call center",
          }
        }
      }
    }
  }
}
```

| プロパティ | 説明 |
| --- | --- |
| `type` | 購読タイプ。 15文字以下の場合は、任意の説明文字列を指定できます。 |
| `subscribers` | 特定の購読を購読した識別子（電子メールアドレスや電話番号など）のセットを表す、オプションのマップタイプフィールドです。 このオブジェクトの各キーは、対象となる識別子を表し、2つのサブプロパティを含みます。 <ul><li>`time`:該当する場合は、IDが購読した時点のISO 8601タイムスタンプ。</li><li>`source`:サブスクライバの元となったソース。15文字以下の場合は、任意の説明文字列を指定できます。</li></ul> |

{style=&quot;table-layout:auto&quot;}


### `metadata`

`metadata` は、顧客の同意と環境設定が最後に更新されるたびに、その同意に関する一般的なメタデータをキャプチャします。

```json
"metadata": {
  "time": "2019-01-01T15:52:25+00:00",
}
```

| プロパティ | 説明 |
| --- | --- |
| `time` | 顧客の同意と環境設定が最後に更新された時点のISO 8601タイムスタンプ。 このフィールドは、負荷と複雑さを軽減するために、個々の環境設定にタイムスタンプを適用する代わりに使用できます。 個々の環境設定で`time`値を指定すると、その環境設定の`metadata`タイムスタンプが上書きされます。 |

{style=&quot;table-layout:auto&quot;}

### `idSpecific`

`idSpecific` は、特定の同意や環境設定が一般的に顧客に適用されるわけではなく、1つのデバイスまたはIDに限定される場合に使用できます。例えば、顧客はあるアドレス宛てのEメールの受信をオプトアウトし、別のアドレス宛てのEメールを許可することができます。

>[!IMPORTANT]
チャネルレベルの同意と環境設定（`idSpecific`の外側にある`consents`の下に表示される同意と環境設定）は、そのチャネル内のIDに適用されます。 したがって、チャネルレベルの同意や環境設定はすべて、同等のID設定とデバイス固有の設定のどちらを適用するかに直接影響します。
* 顧客がチャネルレベルでオプトアウトした場合、`idSpecific`内の同等の同意や環境設定は無視されます。
* チャネルレベルの同意または環境設定が設定されていない場合、または顧客がオプトインした場合は、`idSpecific`の同等の同意または環境設定が保持されます。


`idSpecific`オブジェクトの各キーは、Adobe Experience Platform IDサービスが認識する特定のID名前空間を表します。 独自のカスタム名前空間を定義して様々な識別子を分類できますが、IDサービスが提供する標準名前空間の1つを使用して、リアルタイム顧客プロファイルのストレージサイズを小さくすることをお勧めします。 ID名前空間について詳しくは、IDサービスのドキュメントの「[ID名前空間の概要](../../../identity-service/namespaces.md)」を参照してください。

各namespaceオブジェクトのキーは、顧客が設定した一意のID値を表します。 各ID値には、`consents`と同じ形式の完全な同意と環境設定を含めることができます。

```json
"idSpecific": {
  "email": {
    "jdoe@example.com": {
      "marketing": {
        "email": {
          "val": "n"
        }
      }
    }
  },
  "ECID" : {
    "37784337855396895622558625508046772577": {
      "collect": {
        "val": "y"
      },
      "adID": {
        "val": "n"
      },
      "marketing": {
        "push": {
          "val": "n"
        }
      }
    }
  }
}
```

`idSpecific`セクションで指定された`marketing`オブジェクト内では、`any`フィールドと`preferred`フィールドはサポートされていません。 これらのフィールドは、ユーザーレベルでのみ設定できます。 また、`email`、`sms`、`push`のマーケティング環境設定では、`subscriptions`フィールドはサポートされません。`idSpecific`

`idSpecific`セクションでのみ指定できる同意もあります。`adID`. このフィールドについては、以下のサブセクションで説明します。

#### `adID`

`adID`の同意は、広告主ID（IDFAまたはGAID）を使用してこのデバイス上のアプリをまたいで顧客をリンクできるかどうかに関する顧客の同意を表します。 この値は、`idSpecific`セクションの`ECID` ID名前空間の下でのみ設定でき、他の名前空間や、このフィールドグループのユーザーレベルでは設定できません。

```json
"idSpecific": {
  "ECID" : {
    "37784337855396895622558625508046772577": {
      "collect": {
        "val": "y"
      },
      "adID": {
        "val": "n"
      },
      "marketing": {
        "push": {
          "val": "n"
        }
      }
    }
  }
}
```

>[!NOTE]
Adobe Experience Platform Mobile SDKは、必要に応じて自動的に設定するので、この値を直接設定する必要はありません。

## フィールドグループを使用したデータの取り込み {#ingest}

[!UICONTROL 同意と環境設定]フィールドグループを使用して顧客から同意データを取り込むには、そのフィールドグループを含むスキーマに基づいてデータセットを作成する必要があります。

フィールドグループをフィールドに割り当てる手順については、UIでの[スキーマの作成に関するチュートリアル](http://www.adobe.com/go/xdm-schema-editor-tutorial-en)を参照してください。 [!UICONTROL Consents and Preferences]フィールドグループを持つフィールドを含むスキーマを作成したら、既存のスキーマでデータセットを作成する手順に従って、『データセットユーザーガイド』の[データセット](../../../catalog/datasets/user-guide.md#create)の作成の節を参照します。

>[!IMPORTANT]
[!DNL Real-time Customer Profile]に同意データを送信する場合は、[!UICONTROL 同意と環境設定]フィールドグループを含む[!DNL XDM Individual Profile]クラスに基づいて[!DNL Profile]対応のスキーマを作成する必要があります。 そのスキーマに基づいて作成するデータセットも、[!DNL Profile]に対して有効にする必要があります。 スキーマとデータセットの[!DNL Real-time Customer Profile]要件に関する具体的な手順については、上記にリンクされたチュートリアルを参照してください。
また、顧客プロファイルを正しく更新するために、最新の同意データと環境設定データを含むデータセットに優先順位を付けるように結合ポリシーが設定されていることを確認する必要があります。 詳しくは、[結合ポリシー](../../../rtcdp/profile/merge-policies.md)の概要を参照してください。

## 同意と環境設定の変更の処理

お客様がWebサイトでの同意や環境設定を変更した場合は、[Adobe Experience Platform Web SDK](../../../edge/consent/supporting-consent.md)を使用して、変更を収集し、即座に適用する必要があります。 顧客がデータ収集をオプトアウトした場合、すべてのデータ収集は直ちに停止する必要があります。 顧客がパーソナライゼーションをオプトアウトした場合、訪問する次のページにパーソナライゼーションが存在しないはずです。

## 付録 {#appendix}

以下の節では、[!UICONTROL 同意と環境設定]フィールドグループに関する追加情報を示します。

### `val`に指定できる値 {#choice-values}

次の表に、`val`で使用できる値の概要を示します。

| 値 | タイトル | 説明 |
| --- | --- | --- |
| `y` | ○ | お客様が同意または優先事項をオプトインした。 つまり、**は、該当する同意または好みで示されるように、データの使用に**&#x200B;同意します。 |
| `n` | × | お客様が同意または優先をオプトアウトしました。 つまり、ユーザーは、該当する同意や好みで示されるように、データの使用に&#x200B;**同意しません。** |
| `p` | 検証待ち | システムは、最終的な同意値または優先値を受け取っていません。 これは、2段階の検証が必要な同意の一部として最もよく使用されます。 例えば、顧客がEメールの受信をオプトインした場合、Eメール内のリンクを選択して正しいEメールアドレスが指定されていることを確認するまで、その同意は`p`に設定され、その時点で`y`に更新されます。<br><br>この同意または環境設定で2つの検証プロセスが使用されない場合 `p` は、代わりに、お客様が同意プロンプトにまだ応答していないことを示すために選択を使用できます。例えば、顧客が同意プロンプトに応答する前に、Webサイトの最初のページで値を`p`に自動的に設定できます。 明示的な同意が必要でない管轄区域では、それを使用して、顧客が明示的にオプトアウトしていない（つまり、同意が想定される）ことを示すこともできます。 |
| `u` | Unknown | お客様の同意または嗜好情報が不明である。 |
| `LI` | 正当な利益 | 特定の目的でこのデータを収集して処理するための正当なビジネス上の利益は、個人に与える潜在的な害を上回ります。 |
| `CT` | 契約 | 特定の目的のデータを収集するには、個人との契約上の義務を果たす必要があります。 |
| `CP` | 法的義務の遵守 | 特定の目的のデータを収集するには、ビジネスの法的義務を果たす必要があります。 |
| `VI` | 個人の極めて重要な関心 | 特定の目的のためのデータの収集は、個人の重要な利益を保護するために必要です。 |
| `PI` | 公益 | 特定の目的のためのデータの収集は、公益上又は公的な権限の行使に関する作業を行うために必要です。 |

{style=&quot;table-layout:auto&quot;}

### `preferred`に指定できる値 {#preferred-values}

次の表に、`preferred`で使用できる値の概要を示します。

| 値 | 説明 |
| --- | --- |
| `email` | 電子メール メッセージ。 |
| `push` | プッシュ通知. |
| `inApp` | アプリ内メッセージ. |
| `sms` | SMS メッセージ. |
| `phone` | 電話の操作。 |
| `phyMail` | 物理的なメール。 |
| `inVehicle` | 車載メッセージ。 |
| `inHome` | 社内メッセージ |
| `iot` | 物のインターネット(IoT)メッセージ。 |
| `social` | ソーシャルメディアコンテンツ |
| `other` | 標準カテゴリに適合しないチャネル。 |
| `none` | 優先チャネルはありません。 |
| `unknown` | 優先チャネルが不明です。 |

{style=&quot;table-layout:auto&quot;}

### [!UICONTROL 同意と環境設定]スキーマ全体 {#full-schema}

[!UICONTROL 同意と環境設定]フィールドグループの完全なスキーマを表示するには、[公式のXDMリポジトリ](https://github.com/adobe/xdm/blob/master/components/datatypes/consent/consent-preferences.schema.json)を参照してください。
