---
title: SQL を使用したオーディエンスの構築
description: Adobe Experience Platformの Data Distillerで SQL オーディエンス拡張機能を使用して、SQL コマンドを使用してオーディエンスを作成、管理および公開する方法を説明します。 このガイドでは、プロファイルの作成、更新、削除、ファイルベースの宛先をターゲットにするためのデータ駆動型オーディエンス定義の使用など、オーディエンスのライフサイクルのすべての側面について説明します。
source-git-commit: b790dc0a485011022ac637f9d9c55f21c882d5fc
workflow-type: tm+mt
source-wordcount: '1166'
ht-degree: 1%

---

# SQL を使用したオーディエンスの構築

このドキュメントでは、Adobe Experience Platformの Data Distillerの SQL オーディエンス拡張機能を使用して、SQL コマンドを使用してオーディエンスを作成、管理および公開する方法について説明します。

SQL オーディエンス拡張機能を使用して、既存のディメンションエンティティを含むデータレイクのデータでオーディエンスを作成します。 この拡張機能を使用すると、SQL を使用してオーディエンスセグメントを直接定義でき、プロファイルに生データを必要とせずに柔軟性を提供できます。 この方法を使用して作成されたオーディエンスは、オーディエンスワークスペースに自動的に登録され、ファイルベースの宛先をさらにターゲット設定できます。

![SQL オーディエンス拡張機能のワークフローを示すインフォグラフィック。 段階としては、SQL コマンドを使用してクエリサービスでオーディエンスを作成し、Platform UI で管理して、ファイルベースの宛先でアクティブ化する ](../images/data-distiller/sql-audiences/sql-audience-extension-workflow.png) が含まれます。

## Data Distillerでのオーディエンス作成のライフサイクル {#audience-creation-lifecycle}

オーディエンスを効果的に管理するには、次の手順に従います。 作成されたオーディエンスはオーディエンスフローにシームレスに統合され、顧客ターゲティング用にこれらのベースオーディエンスとターゲットファイルベースの宛先からセグメントを作成できます。 次の SQL コマンドを使用して、Adobe Experience Platform内のオーディエンスを [ 作成 ](#create-audience)、[ 変更 ](#add-profiles-to-audience) および [ 削除 ](#delete-audience) します。

### オーディエンスの作成 {#create-audience}

`CREATE AUDIENCE AS SELECT` コマンドを使用して、新しいオーディエンスを定義します。 作成したオーディエンスはデータセットに保存され、データDistillerの下の [!UICONTROL  オーディエンス ] ワークスペースに登録されます。

```sql
CREATE AUDIENCE table_name  
WITH (primary_identity='IdentitycolName', identity_namespace='Namespace for the identity used', [schema='target_schema_title']) 
AS (select_query)
```

**パラメーター**

これらのパラメーターを使用して、SQL オーディエンス作成クエリを定義します。

| パラメーター | 説明 |
|--------------------|------------------------------------------------------------------|
| `schema` | オプション。クエリによって作成されたデータセットの XDM スキーマを定義します。 |
| `table_name` | テーブルとオーディエンスの名前。 |
| `primary_identity` | オーディエンスのプライマリ ID 列を指定します。 |
| `identity_namespace` | ID の名前空間。 |
| `select_query` | オーディエンスを定義する SELECT ステートメント。 SELECT クエリの構文は、[SELECT クエリ ](../sql/syntax.md#select-queries) セクションにあります。 |

{style="table-layout:auto"}

**例：**

次の例は、SQL オーディエンス作成クエリの構築方法を示しています。

```sql
CREATE Audience aud_test 
WITH (primary_identity=month, identity_namespace=queryService) 
AS SELECT month FROM profile_dim_date LIMIT 5;
```

**制限事項:**

オーディエンス作成に SQL を使用する場合は、次の制限事項に注意してください。

- プライマリ ID 列 **必須** はルートレベルにあります。
- 新しいバッチは、既存のデータセットを上書きします。追加機能は現在サポートされていません。
- ネストされた属性は現在サポートされていません。

### 既存オーディエンスへのプロファイルの追加 {#add-profiles-to-audience}

`INSERT INTO` コマンドを使用して、プロファイルを既存のオーディエンスに追加します。

```sql
INSERT INTO table_name 
SELECT select_query
```

**パラメーター**

次の表に、`INSERT INTO` のコマンドに必要なパラメーターを示します。

| パラメーター | 説明 |
|----------------|--------------------------------------------------------------------------------|
| `table_name` | オーディエンス作成コマンドの一部として作成されたテーブルの名前。 |
| `select_query` | SELECT 文。 SELECT クエリの構文は、SELECT クエリ セクションにあります。 |

{style="table-layout:auto"}

**例：**

次の例は、`INSERT INTO` コマンドを使用した既存のオーディエンスへのプロファイルの追加方法を示しています。

```sql
INSERT INTO Audience aud_test 
SELECT month FROM profile_dim_date LIMIT 10;
```

### オーディエンスを削除（オーディエンスを削除） {#delete-audience}

既存のオーディエンスを削除するには、`DROP AUDIENCE` コマンドを使用します。 オーディエンスが存在しない場合は、`IF EXISTS` が指定されていない限り例外が発生します。

```sql
DROP AUDIENCE [IF EXISTS] [db_name.]table_name
```

**パラメーター**

テーブルには、`DROP AUDIENCE` のコマンドに必要なパラメーターが含まれています。

| パラメーター | 説明 |
|----------------|----------------------------------------------------------------------------------------|
| `IF EXISTS` | オプション。指定した場合、テーブルが見つからない場合に例外は発生しません。 |
| `db_name` | オーディエンスデータセットの選定に使用するデータグループを指定します。 |
| `table_name` | オーディエンス作成コマンドの一部として作成されたテーブルの名前。 |

{style="table-layout:auto"}

**例：**

次の例は、DROP AUDIENCE コマンドを使用したオーディエンスの削除方法を示しています。

```sql
DROP AUDIENCE IF EXISTS aud_test;
```

### オーディエンスの自動公開 {#auto-publish-audiences}

SQL 拡張機能を使用して作成されたオーディエンスは、オーディエンスワークスペースのデータDistillerに自動的に登録されます。 登録すると、これらのオーディエンスをターゲティングに使用したり、ファイルベースの宛先で使用したりできるようになり、セグメント化とターゲティング戦略が強化されます。

![Adobe Experience Platformのオーディエンスワークスペース。自動公開され、すぐに使用できる Data Distiller オーディエンスが表示されます。](../images/data-distiller/sql-audiences/audiences.png)

## 宛先へのオーディエンスのアクティブ化 {#activate-audiences}

[!DNL Amazon S3]、[!DNL SFTP]、[!DNL Azure Blob] など、任意のファイルベースの宛先に対してオーディエンスをターゲティングすることで、オーディエンスをアクティブ化します。 エンリッチメントされたオーディエンス属性は、必要に応じてさらに絞り込み、フィルタリングするために使用できます。

![ パブリック宛先とプライベート宛先/カスタム宛先を表示する、Adobe Experience Platform宛先タイプのフローチャート（バッチオプションとストリーミングオプションを含む） ](../images/data-distiller/sql-audiences/destination-types.png)。

## 機能の説明 {#faqs}

この節では、Data Distillerで SQL を使用して外部オーディエンスを作成および管理する方法に関するよくある質問について説明します。

**質問**:

- オーディエンスの作成は、フラットなデータセットでのみサポートされますか？

+++回答

現在、オーディエンスの作成は、オーディエンスを定義する際にフラット（ルートレベル）属性に制限されます。

+++

- オーディエンスの作成の結果は、単一のデータセットまたは複数のデータセットになりますか、それとも設定によって異なりますか？

+++回答

オーディエンスとデータセットの間には 1 対 1 のマッピングがあります。

+++

- オーディエンスの作成時に作成されたデータセットはプロファイル用にマークされていますか？

+++回答

いいえ。オーディエンスの作成時に作成されたデータセットは、プロファイル用にマークされません。

+++

- データセットはデータレイク上で作成されていますか？

+++回答

はい、オーディエンスに関連付けられたデータセットは、データレイク上に作成されます。 このデータセットの属性は、Audience Composer と宛先フローでエンリッチメントされた属性として使用できます。

+++

- オーディエンス内の属性は、エンタープライズバッチファイルベースの宛先に制限されていますか？ （はい/いいえ）

+++回答

いいえ。オーディエンスのエンリッチメントされた属性は、エンタープライズバッチ宛先とファイルベースの宛先の両方で使用できます。 「次のセグメント ID には、この宛先で許可されていない名前空間があります：e917f626-a038-42f7-944c-xyxyx」のようなエラーが発生した場合は、Data Distillerで新しいセグメントを作成し、使用可能な任意の宛先で使用します。

+++

- Data Distiller オーディエンスを使用するオーディエンスのオーディエンスを作成できますか？

+++回答

はい、Data Distiller オーディエンスを使用するオーディエンスのオーディエンスを作成できます。

+++

- これらのオーディエンスはAdobe Journey Optimizerに表示されますか？ そうでない場合は、このオーディエンスのすべてのメンバーを含んだ新しいオーディエンスをルールビルダーで作成するとどうなりますか？

+++回答

Data Distiller オーディエンスは、現在、Adobe Journey Optimizerでは使用できません。 Adobe Journey Optimizerで使用できるように、Adobe Journey Optimizer ルールビルダーで新しいオーディエンスを作成する必要があります。

+++

- Data Distiller オーディエンスは外部オーディエンスなので、30 日ごとに削除されますか？

+++回答

はい、Data Distiller オーディエンスは外部オーディエンスなので、30 日ごとに削除されます。

+++

## 次の手順

このドキュメントでは、データDistillerの SQL オーディエンス拡張機能を使用して、SQL コマンドを使用してオーディエンスを効果的に作成、管理および公開する方法について説明しました。 独自のビジネス要件に基づいてオーディエンス定義をカスタマイズし、様々な宛先でオーディエンスをアクティブ化して、マーケティング戦略とデータ駆動型の決定を最適化できるようになりました。

次に、以下のドキュメントを参照して、Platform オーディエンス管理戦略をさらに開発および最適化してください。

- **オーディエンスの評価を調べる**:[Adobe Experience Platformのオーディエンス評価方法 ](../../segmentation/home.md#evaluate-segments)：リアルタイム更新のためのストリーミングセグメント化、スケジュールに沿った処理またはオンデマンド処理のためのバッチセグメント化、Edge Networkでの即時評価のためのエッジセグメント化）について説明します。
- **宛先との統合**:Platform の宛先 UI を使用して、[ オンデマンドでファイルをバッチ宛先に書き出す ](../../destinations/ui/export-file-now.md) 方法に関するガイドを参照してください。
- **オーディエンスパフォーマンスの確認**：様々なチャネルにおける SQL 定義オーディエンスのパフォーマンスを分析します。 データインサイトを使用すると、オーディエンスの定義とターゲティング戦略を調整および改善できます。 Adobe Real-time Customer Data Platformで SQL クエリにアクセスしてオーディエンスインサイトに適応させる方法については、[ オーディエンスインサイト ](../../dashboards/insights/audiences.md) に関するドキュメントを参照してください。 その後、オーディエンスダッシュボードをカスタマイズして独自のインサイトを作成し、生のデータを実用的な情報に変換することで、これらのインサイトを効果的に視覚化し、より良い意思決定に使用できます。
