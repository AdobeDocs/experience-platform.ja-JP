---
keywords: Experience Platform；ホーム；人気の高いトピック；クエリサービス；クエリサービス；トラブルシューティングガイド；faq；トラブルシューティング；
solution: Experience Platform
title: クエリサービストラブルシューティングガイド
topic-legacy: troubleshooting
description: このドキュメントには、発生する一般的なエラーコードと考えられる原因に関する情報が含まれています。
exl-id: 14cdff7a-40dd-4103-9a92-3f29fa4c0809
source-git-commit: 03cd013e35872bcc30c68508d9418cb888d9e260
workflow-type: tm+mt
source-wordcount: '1106'
ht-degree: 14%

---

# [!DNL Query Service] トラブルシューティングガイド

このドキュメントでは、クエリサービスに関するよくある質問に対する回答を提供し、クエリサービスを使用する際によく見られるエラーコードのリストを示します。 Adobe Experience Platform の他のサービスに関する質問やトラブルシューティングについては、[Experience Platform のトラブルシューティングガイド](../landing/troubleshooting.md)を参照してください。

## よくある質問

次に、クエリサービスに関するよくある質問に対する回答のリストを示します。

### クエリのメタデータのみを取得するにはどうすればよいですか？

クエリのメタデータのみを取得するには、次のように、0 行を返すクエリを実行します。

```sql
SELECT * FROM <table> WHERE 1=0
```

このクエリは、指定したテーブルのメタデータのみを返します。

### CTAS(Create Table as Select) クエリを具体化せずに、すばやく繰り返し実行する方法を教えてください。

一時テーブルを作成して、クエリを素早く反復して実験してから、使用するクエリを具体化できます。 また、一時テーブルを使用して、クエリが機能しているかどうかを検証することもできます。

例えば、一時テーブルを作成できます。

```sql
CREATE temp TABLE temp_dataset AS
SELECT *
FROM actual_dataset
WHERE 1 = 0;
```

次に、一時テーブルを次のように使用できます。

```sql
INSERT INTO temp_dataset
SELECT a._company AS _company,
a._id AS _id,
a.timestamp AS timestamp
FROM actual_dataset a
WHERE timestamp >= TO_TIMESTAMP('2021-01-21 12:00:00')
AND timestamp < TO_TIMESTAMP('2021-01-21 13:00:00')
LIMIT 100;
```

### タイムゾーンを UTC タイムスタンプに変更したり、UTC タイムスタンプから変更したりするには、どうすればよいですか？

Adobe Experience Platformは、データを UTC（協定世界時）タイムスタンプ形式で保持します。 UTC 形式の例は次のとおりです。 `2021-12-22T19:52:05Z`

クエリサービスは、指定されたタイムスタンプを UTC 形式に変換したり、UTC 形式から変換したりするための組み込みの SQL 関数をサポートしています。 両方の `to_utc_timestamp()` そして `from_utc_timestamp()` メソッドには 2 つのパラメーターを指定します。タイムスタンプとタイムゾーン。

| パラメーター | 説明 |
|---|---|
| タイムスタンプ | タイムスタンプは、UTC 形式または単純形式で書き込むことができます `{year-month-day}` 形式 時間を指定しない場合、デフォルト値は指定した日の午前 0 時です。 |
| タイムゾーン | タイムゾーンは `{continent/city})` 形式 は、 [パブリックドメイン TZ データベース](https://data.iana.org/time-zones/tz-link.html#tzdb). |

#### UTC タイムスタンプに変換

この `to_utc_timestamp()` メソッドは指定されたパラメーターを解釈し、変換します **ローカルタイムゾーンのタイムスタンプに** （UTC 形式） 例えば、韓国のソウルのタイムゾーンは、UTC/GMT +9 時間です。 日付のみのタイムスタンプを指定すると、メソッドではデフォルト値の午前 0 時が使用されます。 タイムスタンプとタイムゾーンは、その地域の時刻から地域の UTC タイムスタンプに変換されます。

```SQL
SELECT to_utc_timestamp('2021-08-31', 'Asia/Seoul');
```

クエリは、ユーザーのローカル時間のタイムスタンプを返します。 この場合、ソウルは 9 時間先なので、前日の午後 3 時です。

```
2021-08-30 15:00:00
```

別の例として、指定されたタイムスタンプが `2021-07-14 12:40:00.0` の `Asia/Seoul` timezone。返される UTC タイムスタンプは次のようになります。 `2021-07-14 03:40:00.0`

クエリサービス UI で提供されるコンソール出力は、より人間が読み取り可能な形式です。

```
8/30/2021, 3:00 PM
```

### UTC タイムスタンプからの変換

この `from_utc_timestamp()` メソッドは、指定されたパラメーターを解釈します **ローカルタイムゾーンのタイムスタンプから** およびは、目的の地域の同等のタイムスタンプを UTC 形式で提供します。 次の例では、時間はユーザーのローカルタイムゾーンの午後 2 時 40 分です。 変数として渡されるソウルタイムゾーンは、ローカルタイムゾーンの 9 時間前です。

```SQL
SELECT from_utc_timestamp('2021-08-31 14:40:00.0', 'Asia/Seoul');
```

クエリは、パラメーターとして渡されたタイムゾーンのタイムスタンプを UTC 形式で返します。 結果は、クエリを実行したタイムゾーンより 9 時間早くなります。

```
8/31/2021, 11:40 PM
```

### 時系列データはどのようにフィルタリングする必要がありますか。

時系列データを使用してクエリを実行する場合、分析をより正確におこなうには、可能な限りタイムスタンプフィルターを使用する必要があります。

>[!NOTE]
>
> 日付文字列 **必須** 形式である `yyyy-mm-ddTHH24:MM:SS`.

タイムスタンプフィルターの使用例を以下に示します。

```sql
SELECT a._company  AS _company,
       a._id       AS _id,
       a.timestamp AS timestamp
FROM   dataset a
WHERE  timestamp >= To_timestamp('2021-01-21 12:00:00')
       AND timestamp < To_timestamp('2021-01-21 13:00:00')
```

### ワイルドカード（*など）を使用してデータセットからすべての行を取得する必要がありますか？

クエリサービスは **カラム式店舗** 従来の行ベースのストアシステムではなく、

### 使用する場合 `NOT IN` を SQL クエリに含めますか？

この `NOT IN` 演算子は、他のテーブルや SQL 文に見つからない行を取得する場合によく使用されます。 この演算子は、パフォーマンスを低下させる可能性があり、比較している列が受け入れられる場合は、予期しない結果が返される可能性があります `NOT NULL`または大量のレコードが存在する場合。

を使用する代わりに、 `NOT IN`を使用する場合、 `NOT EXISTS` または `LEFT OUTER JOIN`.

例えば、次のテーブルが作成されているとします。

```sql
CREATE TABLE T1 (ID INT)
CREATE TABLE T2 (ID INT)
INSERT INTO T1 VALUES (1)
INSERT INTO T1 VALUES (2)
INSERT INTO T1 VALUES (3)
INSERT INTO T2 VALUES (1)
INSERT INTO T2 VALUES (2)
```

を使用している場合、 `NOT EXISTS` 演算子を使用する場合は、 `NOT IN` 演算子を使用するには、次のクエリを使用します。

```sql
SELECT ID FROM T1
WHERE NOT EXISTS
(SELECT ID FROM T2 WHERE T1.ID = T2.ID)
```

または、 `LEFT OUTER JOIN` オペレーターは、 `NOT IN` 演算子を使用するには、次のクエリを使用します。

```sql
SELECT T1.ID FROM T1
LEFT OUTER JOIN T2 ON T1.ID = T2.ID
WHERE T2.ID IS NULL
```

### の正しい使用方法 `OR` および `UNION` 演算子？

### 正しく `CAST` 演算子を使用して、SQL クエリでタイムスタンプを変換しますか？

を使用する場合、 `CAST` 演算子を使用してタイムスタンプを変換する場合は、日付 **および** 時間。

例えば、以下に示すように、時間コンポーネントが見つからない場合、次のエラーが発生します。

```sql
SELECT * FROM ABC
WHERE timestamp = CAST('07-29-2021' AS timestamp)
```

の正しい使用方法 `CAST` 演算子を次に示します。

```sql
SELECT * FROM ABC
WHERE timestamp = CAST('07-29-2021 00:00:00' AS timestamp)
```

### クエリ結果を CSV ファイルとしてダウンロードするにはどうすればよいですか？

これは、クエリサービスが直接提供する機能ではありません。 ただし、 [!DNL PostgreSQL] データベースサーバーに接続するクライアントには機能があり、SELECT クエリの応答は CSV ファイルとして書き込み、ダウンロードできます。 このプロセスの明確化に使用するユーティリティまたはサードパーティツールのドキュメントを参照してください。

## REST API エラー

| HTTP ステータスコード | 説明 | 考えられる原因 |
| ---------------- | ----------- | --------------- |
| 400 | 不正なリクエストです。 | クエリの形式が不正であるか、不正なクエリです。 |
| 401 | 認証に失敗しました。 | 認証トークンが無効です。 |
| 500 | 内部サーバーエラー。 | 内部システム障害が発生しています。 |

## PostgreSQL API エラー

| エラーコード | 接続状態 | 説明 | 考えられる原因 |
| ---------- | ---------------- | ----------- | -------------- |
| **08P01** | N/A | メッセージの種類がサポートされていません。 | メッセージの種類がサポートされていません。 |
| **28P01** | 起動 — 認証 | パスワードが無効です。 | 認証トークンが無効です。 |
| **28000** | 起動 — 認証 | 認証タイプが無効です。 | 認証タイプが無効です。`AuthenticationCleartextPassword` である必要があります。 |
| **42P12** | 起動 — 認証 | テーブルが見つかりません。 | 使用するテーブルが見つかりません。 |
| **42601** | クエリ | 構文エラー。 | コマンドが無効であるか、構文にエラーがあります。 |
| **42P01** | クエリ | テーブルが見つかりません。 | クエリで指定されたテーブルが見つかりませんでした。 |
| **42P07** | クエリ | テーブルが存在します。 | 同じ名前のテーブルが既に存在します (CREATE TABLE) |
| **53400** | クエリ | LIMIT が最大値を超えています。 | ユーザーが LIMIT 句で 100,000 を超える行数を指定しました。 |
| **53400** | クエリ | ステートメントがタイムアウトになりました。 | 送信されたステートメントの処理時間が最大値の 10 分を超えました。 |
| **58000** | クエリ | システムエラー。 | 内部システム障害が発生しています。 |
| **0A000** | クエリ/コマンド | サポートなし | クエリ/コマンドの機能はサポートされていません |
| **42501** | DROP TABLE クエリ | クエリサービスで作成されていないテーブルを削除しています | 削除中のテーブルは、 `CREATE TABLE` 文 |
| **42501** | DROP TABLE クエリ | 認証済みユーザーがテーブルを作成していません | 削除中のテーブルは、現在ログインしているユーザーによって作成されませんでした |
| **42P01** | DROP TABLE クエリ | テーブルが見つかりません。 | クエリで指定されたテーブルが見つかりませんでした |
| **42P12** | DROP TABLE クエリ | 次のテーブルが見つかりません： `dbName`:確認してください `dbName` | 現在のデータベースにテーブルが見つかりませんでした |
