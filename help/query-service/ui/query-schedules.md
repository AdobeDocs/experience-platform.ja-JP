---
title: クエリスケジュール
description: Adobe Experience Platform UI を使用して、スケジュールされたクエリの実行を自動化する方法、クエリスケジュールを削除または無効にする方法、使用可能なスケジュールオプションを利用する方法について説明します。
exl-id: 984d5ddd-16e8-4a86-80e4-40f51f37a975
source-git-commit: 04b804b81b605040c74db040bc5118e0392ddd32
workflow-type: tm+mt
source-wordcount: '2181'
ht-degree: 12%

---

# クエリスケジュール

クエリスケジュールを作成して、クエリの実行を自動化できます。 スケジュールされたクエリは、カスタムサイクルで実行され、頻度、日付、時間に基づいてデータを管理します。 必要に応じて、結果に使用する出力データセットを選択することもできます。 テンプレートとして保存したクエリは、クエリエディターからスケジュールできます。

>[!IMPORTANT]
>
>既に作成および保存されているクエリにのみスケジュールを追加できます。

## スケジュール済みクエリのアカウント要件 {#technical-account-user-requirements}

スケジュールされたクエリが確実に実行されるように、Adobeでは、管理者がスケジュールされたクエリを作成するためのテクニカルアカウント（OAuth サーバー間資格情報を使用）をプロビジョニングすることをお勧めします。 スケジュールされたクエリは個人用ユーザーアカウントでも作成できますが、この方法で作成されたクエリは、そのユーザーのアクセス権が削除または無効になると実行を停止します。

テクニカルアカウントの設定と必要な権限の割り当てについて詳しくは、[&#x200B; 資格情報ガイドの前提条件 &#x200B;](./credentials.md#prerequisites) および [API 認証 &#x200B;](../../landing/api-authentication.md) を参照してください。

テクニカルアカウントの作成と設定に関するその他のガイダンスについては、次を参照してください。

- [Developer Consoleの設定 &#x200B;](https://experienceleague.adobe.com/ja/docs/platform-learn/getting-started-for-data-architects-and-data-engineers/set-up-developer-console-and-postman): Adobe Developer Consoleを設定し、OAuth 資格情報を取得するための詳細手順。
- [&#x200B; エンドツーエンドのテクニカルアカウントの設定 &#x200B;](https://experienceleague.adobe.com/ja/docs/platform-learn/tutorial-comprehensive-technical/setup):Adobe Experience Platformでテクニカルアカウントを作成および設定するための包括的なチュートリアル。

クエリサービス UI のみを使用する場合は、必要な権限を持っていることを確認するか、テクニカルアカウントを管理する管理者と調整します。 スケジュールされたクエリはすべて「[!UICONTROL &#x200B; スケジュール済みクエリ &#x200B;]」タブのリストに追加され、スケジュールされたすべてのクエリジョブのステータス、スケジュールの詳細、エラーメッセージを監視したり、アラートを購読したりできます。 クエリの監視と管理について詳しくは、[&#x200B; スケジュールされたクエリの監視ドキュメント &#x200B;](./monitor-queries.md) を参照してください。

このワークフローでは、クエリサービス UI のスケジュールプロセスについて説明します。 API を使用してスケジュールを追加する方法について詳しくは、[&#x200B; スケジュールされたクエリのエンドポイントガイド &#x200B;](../api/scheduled-queries.md) を参照してください。

>[!NOTE]
>
>テクニカルアカウントを使用して、ユーザーが組織を離れた場合や役割が変更された場合でも、スケジュールされたクエリが引き続き実行されるようにします。 クエリの自動化を中断しない場合は、可能な限りテクニカルアカウントを選択します。

## クエリスケジュールの作成 {#create-schedule}

クエリをスケジュールするには、「[!UICONTROL &#x200B; テンプレート &#x200B;]」タブまたは [!UICONTROL &#x200B; スケジュール済みクエリ &#x200B;] タブの [!UICONTROL &#x200B; テンプレート &#x200B;] 列からクエリテンプレートを選択します。 テンプレート名を選択すると、クエリエディターに移動します。

クエリエディターから保存済みクエリにアクセスする場合は、クエリのスケジュールを作成するか、詳細パネルからクエリのスケジュールを表示できます。

>[!TIP]
>
>「**[!UICONTROL スケジュールを表示]**」を選択してスケジュールワークスペースに移動し、スケジュールされたクエリの実行を一目で確認します。

![[!UICONTROL &#x200B; スケジュールを表示 &#x200B;] および [!UICONTROL &#x200B; スケジュールを追加 &#x200B;] がハイライト表示されたクエリエディター &#x200B;](../images/ui/query-schedules/view-add-schedule.png)

**[!UICONTROL スケジュールを追加]** を選択して、[&#x200B; スケジュールの詳細ページ &#x200B;](#schedule-details) に移動します。

または、クエリ名の下にある「**[!UICONTROL スケジュール]**」タブを選択します。

![「スケジュール」タブがハイライトされたクエリエディター。](../images/ui/query-schedules/schedules-tab.png)

スケジュールワークスペースが表示されます。UI に、テンプレートが関連付けられているスケジュールされた実行のリストが表示されます。 「**[!UICONTROL スケジュールを追加]**」を選択して、スケジュールを作成します。

![「スケジュールを追加」がハイライト表示されたクエリエディタースケジュールのワークスペース。](../images/ui/query-schedules/add-schedule.png)

### スケジュールの詳細を追加 {#schedule-details}

スケジュールの詳細ページが表示されます。このページでは、スケジュールされたクエリの様々な詳細を編集できます。 詳細には [&#x200B; スケジュールされたクエリの頻度と平日 &#x200B;](#scheduled-query-frequency) 実行、開始日と終了日、結果の書き出し先のデータセット、[&#x200B; クエリステータスアラート &#x200B;](#alerts-for-query-status) が含まれます。

>[!IMPORTANT]
>
>クエリスケジューラー UI は、無期限または無期限のスケジュール設定をサポートしていません。 終了日を指定してください。 終了日に上限はありません。

![ハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/schedule-details.png)

#### スケジュールされたクエリの頻度 {#scheduled-query-frequency}

**[!UICONTROL 頻度]**&#x200B;では、次のオプションが選択できます。

- **[!UICONTROL 毎時]**：スケジュールされたクエリは、1 時間ごとに、選択した期間で実行されます。
- **[!UICONTROL 毎日]**：スケジュールされたクエリは、 X 日ごとに、選択した時間、期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎週]**：選択したクエリは、選択した曜日、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎月]**：選択したクエリは、毎月、選択した日、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎年]**：選択したクエリは、毎年、選択した日、月、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。

### データセットの詳細を入力 {#dataset-details}

既存のデータセットにデータを追加するか、新しいデータセットを作成してデータを追加することで、クエリ結果を管理します。

初めてクエリを実行するときにデータセットを作成するには、「**[!UICONTROL 作成して新しいデータセットに追加]**」を選択します。 その後の実行では、引き続きそのデータセットにデータが挿入されます。 最後に、データセットの名前と説明を入力します。

>[!IMPORTANT]
>
> 既存のデータセットを使用または新しいデータセットを作成する際は、データセットは既に設定されているため、`INSERT INTO` または `CREATE TABLE AS SELECT` をクエリの一部として含める必要は&#x200B;**ありません**。`INSERT INTO` または `CREATE TABLE AS SELECT` をスケジュールされたクエリの一部として含めた場合、エラーが発生します。

![&#x200B; データセットの詳細と「[!UICONTROL &#x200B; 新しいデータセットを作成して追加 &#x200B;] オプションがハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/dataset-details-create-and-append.png)

または、**[!UICONTROL 既存のデータセットに追加]** を選択したあと、データセットアイコン（![&#x200B; データセットアイコン。](/help/images/icons/database.png)）を選択します。

![&#x200B; データセットの詳細と「既存のデータセットに追加」がハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/dataset-details-existing.png)

**[!UICONTROL 出力データセットを選択]** ダイアログが表示されます。

次に、既存のデータセットを参照するか、検索フィールドを使用してオプションをフィルタリングします。 使用するデータセットの行を選択します。 データセットの詳細は、右側のパネルに表示されます。 「**[!UICONTROL 完了]**」を選択して、選択を確定します。

![&#x200B; 検索フィールド、データセット行、完了がハイライト表示された出力データセットを選択ダイアログ &#x200B;](../images/ui/query-schedules/select-output-dataset-dialog.png)

### クエリが継続的に失敗する場合に強制隔離 {#quarantine}

スケジュールを作成する際は、クエリを強制隔離機能に登録して、システムリソースを保護し、潜在的な中断を防ぐことができます。 強制隔離機能は、繰り返し失敗するクエリを自動的に識別して分離し、それらのクエリを [!UICONTROL &#x200B; 強制隔離 &#x200B;] 状態にします。 10 回連続して失敗した後にクエリを強制隔離すると、問題を介入、確認および修正してから追加の実行を許可できます。 これにより、運用効率とデータの整合性を維持できます。

![&#x200B; 「クエリ強制隔離 [!UICONTROL &#x200B; が強調表示され、「はい」が選択されたクエリスケジュールワークスペース &#x200B;] 表示されます &#x200B;](../images/ui/query-schedules/quarantine-enroll.png)。

クエリが強制隔離機能に登録されると、このクエリのステータス変更に関するアラートを登録できます。 スケジュールされたクエリが強制隔離で登録されていない場合、[&#x200B; アラートダイアログ &#x200B;](./monitor-queries.md#alert-subscription) にオプションとして表示されません。

また、「[!UICONTROL &#x200B; 予定クエリ &#x200B;] タブのインラインアクションから強制隔離機能に予定クエリを登録することもできます。 詳しくは、[&#x200B; クエリドキュメントの監視 &#x200B;](./monitor-queries.md#alert-subscription) を参照してください。

### スケジュールされたクエリステータスに対するアラートの設定 {#alerts-for-query-status}

また、スケジュールされたクエリ設定の一部として、クエリアラートを購読することもできます。 様々な状況で通知を受け取るように設定できます。 アラートは、強制隔離状態、クエリ処理の遅延、クエリのステータスの変更に対して設定できます。 使用可能なクエリ状態アラートオプションには、開始、成功、失敗があります。 アラートは、ポップアップ通知またはメールとして受け取ることができます。 スケジュールされたクエリのそのステータスに関するアラートを登録するには、チェックボックスをオンにします。

![&#x200B; アラートオプションがハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-editor/alerts.png)

次の表に、サポートされるクエリのアラートタイプを示します。

| アラートタイプ | 説明 |
|---|---|
| `start` | このアラートは、スケジュールされたクエリの実行が開始されたとき、または処理を開始したときに通知します。 |
| `success` | このアラートは、スケジュールされたクエリの実行が正常に完了したときに、クエリがエラーなく実行されたことを示します。 |
| `failed` | このアラートは、スケジュールされたクエリの実行でエラーが発生した場合、または正常に実行できなかった場合にトリガーします。 これにより、問題を迅速に特定して対処できます。 |
| `quarantine` | このアラートは、スケジュールされたクエリの実行が強制隔離状態になった場合にアクティブになります。 クエリが [&#x200B; 強制隔離機能に登録 &#x200B;](#quarantine) されると、10 回連続して実行されなかったスケジュール済みクエリは、自動的に [!UICONTROL &#x200B; 強制隔離 &#x200B;] 状態になります。 次に、強制隔離されたクエリでは、それ以上実行する前に介入が必要です。 注意：強制隔離アラートを購読するには、クエリを強制隔離機能に登録する必要があります。 |
| `delay` | このアラートは、指定したしきい値を超える [&#x200B; スケジュールされたクエリの実行結果の遅延 &#x200B;](./monitor-queries.md#query-run-delay) がある場合に通知します。 クエリが完了または失敗せずに該当する期間に実行された場合にアラートをトリガーにするカスタム時間を設定できます。 デフォルトの動作では、クエリの処理が開始してから 150 分間アラートが設定されます。 |

>[!NOTE]
>
>[!UICONTROL &#x200B; クエリ実行遅延 &#x200B;] アラートを設定する場合は、Experience Platform UI で目的の遅延時間を分単位で設定する必要があります。 期間を分単位で入力します。 遅延の最大値は 24 時間（1440 分）です。

アラートルールの定義方法など、Adobe Experience Platformのアラートの概要については、[&#x200B; アラートの概要 &#x200B;](../../observability/alerts/overview.md) を参照してください。 Adobe Experience Platform UI 内のアラートとアラートルールの管理に関するガイダンスについては、[&#x200B; アラート UI ガイド &#x200B;](../../observability/alerts/ui.md) を参照してください。

### スケジュールされたパラメーター化クエリのパラメーターの設定 {#set-parameters}

パラメーター化クエリ用のスケジュールされたクエリを作成している場合は、これらのクエリの実行にパラメーター値を設定する必要があります。

![&#x200B; クエリパラメーターセクションがハイライト表示されたスケジュール作成ワークフローの「スケジュールの詳細」セクション。](../images/ui/query-schedules/scheduled-query-parameter.png)

スケジュールの詳細を確認したら、「**[!UICONTROL 保存]**」を選択して、スケジュールを作成します。 テンプレートの「スケジュール」タブに戻ります。 このワークスペースには、スケジュール ID、スケジュール自体、スケジュールの出力データセットなど、新しく作成されたスケジュールの詳細が表示されます。

## スケジュールされたクエリの実行の表示 {#scheduled-query-runs}

テンプレートの [!UICONTROL &#x200B; スケジュール &#x200B;] タブで、スケジュール ID を選択して、新しくスケジュールされたクエリのクエリ実行のリストに移動します。

![新しく作成されたスケジュールがハイライト表示されたスケジュールワークスペース。](../images/ui/query-schedules/schedules-workspace.png)

または、クエリテンプレートのスケジュールされた実行のリストを表示するには、「**[!UICONTROL スケジュール済みクエリ]**」タブに移動し、使用可能なリストからテンプレート名を選択します。

![&#x200B; 名前付きテンプレートがハイライト表示された「スケジュール済みクエリ」タブ &#x200B;](../images/ui/query-schedules/view-scheduled-runs.png)

スケジュールされたクエリのクエリ実行のリストが表示されます。

### ジョブレベルで時間を計算 {#compute-hours}

CTAS/ITAS バッチクエリのクエリ実行レベルで消費される計算時間を追跡します。 この機能は、コンピューティングの使用状況に関するインサイトを提供し、リソース割り当ての最適化とクエリパフォーマンスの向上を支援します。

>[!AVAILABILITY]
>
>時間計算機能は、[Data Distiller SKU](../data-distiller/overview.md) を購入したユーザー専用です。 詳しくは、Adobe担当者にお問い合わせください。

![&#x200B; スケジュール済みクエリのクエリ実行のリストがハイライト表示されたスケジュール済みクエリワークスペースの詳細セクション。](../images/ui/query-schedules/list-of-scheduled-runs.png)

次の表に、スケジュール済の問合せ実行をリストする「詳細」セクションで使用可能な各列の説明を示します。

| 列タイトル | 説明 |
|---------------------|----------------------------------|
| [!UICONTROL &#x200B; クエリ実行 ID] | クエリの実行ごとに一意の ID を表示します。これにより、スケジュールされたクエリの個々の実行を追跡および参照できます。 |
| [!UICONTROL &#x200B; クエリ実行開始 &#x200B;] | クエリ実行の開始日時を示します。各実行がいつ開始されたかを監視するのに役立ちます。 |
| [!UICONTROL &#x200B; クエリの実行完了 &#x200B;] | クエリ実行の完了日時を示し、insightに実行期間とステータスを提供します。 |
| [!UICONTROL ステータス] | クエリ実行の現在のステータスを表示します（結果 `Completed,` 迅速に評価するための `Running,` や `Failed,` など）。 |
| [!UICONTROL データセット] | クエリ実行で使用されたデータセットをリスト表示し、実行に関与したデータソースを表示します。 |
| [!UICONTROL &#x200B; 時間を計算 &#x200B;] | 各クエリの実行に使用される計算時間を時間単位で表示します。 これにより、リソース使用量を追跡し、クエリのパフォーマンスを最適化できます。 |

{style="table-layout:auto"}

>[!NOTE]
>
>時間の計算データは、2024 年 8 月 15 日（PT）から使用できます。 この日付より前のデータは、「利用できません」と表示されます。

UI を使用してすべてのクエリジョブのステータスを監視する方法について詳しくは、[&#x200B; スケジュール済みクエリの監視ガイド &#x200B;](./monitor-queries.md#inline-actions) を参照してください。

リストから **[!UICONTROL クエリ実行 ID]** を選択して、クエリ実行の概要に移動します。 [&#x200B; クエリ実行の概要 &#x200B;](./monitor-queries.md#query-run-overview) で利用できる情報の完全な分類については、スケジュールされたクエリの監視に関するドキュメントを参照してください。

Query Service API を使用してスケジュールされたクエリを監視するには、[&#x200B; スケジュールされたクエリ実行エンドポイントガイド &#x200B;](../api/runs-scheduled-queries.md) を参照してください。

## スケジュールの有効化、無効化または削除 {#delete-schedule}

特定のクエリのスケジュールワークスペース、またはすべてのスケジュール済みクエリを一覧表示する [!UICONTROL &#x200B; スケジュール済みクエリ &#x200B;] ワークスペースで、スケジュールを有効、無効または削除できます。

選択したクエリの「[!UICONTROL &#x200B; スケジュール &#x200B;]」タブにアクセスするには、「[!UICONTROL &#x200B; テンプレート &#x200B;]」タブまたは「[!UICONTROL &#x200B; スケジュール済みクエリ &#x200B;]」タブからクエリテンプレートの名前を選択する必要があります。 これにより、そのクエリのクエリエディターに移動します。 クエリエディターから **[!UICONTROL スケジュール]** を選択して、スケジュールワークスペースにアクセスします。

使用可能なスケジュールの行からスケジュールを選択して、詳細パネルに入力します。 切替スイッチを使用して、スケジュールされたクエリを無効（または有効）にします。

### 無効なクエリの削除

>[!IMPORTANT]
>
>スケジュールを無効にしてから、クエリのスケジュールを削除する必要があります。

![&#x200B; 詳細パネルがハイライト表示されたテンプレートのスケジュールのリスト。](../images/ui/query-schedules/schedule-details-panel.png)

確認ダイアログが表示されます。 「**[!UICONTROL 無効]**」を選択して、アクションを確定します。

![&#x200B; スケジュールを無効にする確認ダイアログ。](../images/ui/query-schedules/disable-schedule-confirmation-dialog.png)

「**[!UICONTROL スケジュールを削除]**」を選択して、無効なスケジュールを削除します。

![&#x200B; 「スケジュールを削除」がハイライト表示されたスケジュールワークスペース。](../images/ui/query-schedules/delete-schedule.png)

または、「[!UICONTROL &#x200B; 予定クエリ &#x200B;]」タブには、予定された各クエリに対するインラインアクションのコレクションが用意されています。 使用可能なインラインアクションには、スケジュールされたクエリのアラートに対する [!UICONTROL &#x200B; スケジュールを無効にする &#x200B;] または [!UICONTROL &#x200B; スケジュールを有効にする &#x200B;]、[!UICONTROL &#x200B; スケジュールを削除 &#x200B;] および [!UICONTROL &#x200B; 登録 &#x200B;] が含まれます。 「スケジュール済みクエリ」タブを使用してスケジュール済みクエリを削除または無効にする方法について詳しくは、[&#x200B; スケジュール済みクエリの監視ガイド &#x200B;](./monitor-queries.md#inline-actions) を参照してください。
