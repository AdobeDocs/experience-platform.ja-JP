---
title: クエリスケジュール
description: Adobe Experience Platform UI を使用して、スケジュールされたクエリの実行を自動化する方法、クエリスケジュールを削除または無効にする方法、使用可能なスケジュールオプションを利用する方法について説明します。
exl-id: 984d5ddd-16e8-4a86-80e4-40f51f37a975
source-git-commit: 0b056da8457010ce36efc48e3dd91f280a9b15c5
workflow-type: tm+mt
source-wordcount: '1848'
ht-degree: 15%

---

# クエリスケジュール

クエリスケジュールを作成して、クエリの実行を自動化できます。 スケジュールされたクエリは、カスタムサイクルで実行され、頻度、日付、時間に基づいてデータを管理します。 必要に応じて、結果に使用する出力データセットを選択することもできます。 テンプレートとして保存したクエリは、クエリエディターからスケジュールできます。

>[!IMPORTANT]
>
>既に作成および保存されているクエリにのみスケジュールを追加できます。

スケジュールされたクエリは、「[!UICONTROL  スケジュール済みクエリ ] タブのリストに追加されます。 そのワークスペースから、UI を使用して、スケジュールされたすべてのクエリジョブのステータスを監視できます。 [!UICONTROL  スケジュール済みクエリ ] タブでは、クエリの実行に関する重要な情報を見つけたり、アラートを購読したりできます。 使用可能な情報には、ステータス、スケジュールの詳細、実行が失敗した場合のエラーメッセージ/コードが含まれます。 詳しくは、[ スケジュール済みクエリドキュメントの監視 ](./monitor-queries.md) を参照してください。

このワークフローでは、クエリサービス UI のスケジュールプロセスについて説明します。 API を使用してスケジュールを追加する方法について詳しくは、[スケジュールされたクエリのエンドポイントガイド](../api/scheduled-queries.md)を参照してください。

## クエリスケジュールの作成 {#create-schedule}

クエリをスケジュールするには、「[!UICONTROL  テンプレート ]」タブまたは [!UICONTROL  スケジュール済みクエリ [!UICONTROL  タブの ] テンプレート ] 列からクエリテンプレートを選択します。 テンプレート名を選択すると、クエリエディターに移動します。

クエリエディターから保存済みクエリにアクセスする場合は、クエリのスケジュールを作成するか、詳細パネルからクエリのスケジュールを表示できます。

>[!TIP]
>
>「**[!UICONTROL スケジュールを表示]**」を選択してスケジュールワークスペースに移動し、スケジュールされたクエリの実行を一目で確認します。

![[!UICONTROL  スケジュールを表示 ] および [!UICONTROL  スケジュールを追加 ] がハイライト表示されたクエリエディター ](../images/ui/query-schedules/view-add-schedule.png)

**[!UICONTROL スケジュールを追加]** を選択して、[ スケジュールの詳細ページ ](#schedule-details) に移動します。

または、クエリ名の下にある「**[!UICONTROL スケジュール]**」タブを選択します。

![「スケジュール」タブがハイライトされたクエリエディター。](../images/ui/query-schedules/schedules-tab.png)

スケジュールワークスペースが表示されます。UI に、テンプレートが関連付けられているスケジュールされた実行のリストが表示されます。 「**[!UICONTROL スケジュールを追加]**」を選択して、スケジュールを作成します。

![「スケジュールを追加」がハイライト表示されたクエリエディタースケジュールのワークスペース。](../images/ui/query-schedules/add-schedule.png)

### スケジュールの詳細を追加 {#schedule-details}

スケジュールの詳細ページが表示されます。このページでは、スケジュールされたクエリの様々な詳細を編集できます。 詳細には [ スケジュールされたクエリの頻度と平日 ](#scheduled-query-frequency) 実行、開始日と終了日、結果の書き出し先のデータセット、[ クエリステータスアラート ](#alerts-for-query-status) が含まれます。

>[!IMPORTANT]
>
>クエリスケジューラー UI は、無期限または無期限のスケジュール設定をサポートしていません。 終了日を指定してください。 終了日に上限はありません。

![ハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/schedule-details.png)

#### スケジュールされたクエリの頻度 {#scheduled-query-frequency}

**[!UICONTROL 頻度]**&#x200B;では、次のオプションが選択できます。

- **[!UICONTROL 毎時]**：スケジュールされたクエリは、1 時間ごとに、選択した期間で実行されます。
- **[!UICONTROL 毎日]**：スケジュールされたクエリは、 X 日ごとに、選択した時間、期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎週]**：選択したクエリは、選択した曜日、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎月]**：選択したクエリは、毎月、選択した日、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。
- **[!UICONTROL 毎年]**：選択したクエリは、毎年、選択した日、月、時間および期間に実行されます。選択した時間は、ローカルタイムゾーンではなく、**UTC**&#x200B;であることに注意してください。

### データセットの詳細を入力 {#dataset-details}

既存のデータセットにデータを追加するか、新しいデータセットを作成してデータを追加することで、クエリ結果を管理します。

初めてクエリを実行するときにデータセットを作成するには、「**[!UICONTROL 作成して新しいデータセットに追加]**」を選択します。 その後の実行では、引き続きそのデータセットにデータが挿入されます。 最後に、データセットの名前と説明を入力します。

>[!IMPORTANT]
>
> 既存のデータセットを使用または新しいデータセットを作成する際は、データセットは既に設定されているため、`INSERT INTO` または `CREATE TABLE AS SELECT` をクエリの一部として含める必要は&#x200B;**ありません**。`INSERT INTO` または `CREATE TABLE AS SELECT` をスケジュールされたクエリの一部として含めた場合、エラーが発生します。

![ データセットの詳細と「[!UICONTROL  新しいデータセットを作成して追加 ] オプションがハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/dataset-details-create-and-append.png)

または、**[!UICONTROL 既存のデータセットに追加]** を選択したあと、データセットアイコン（![ データセットアイコン。](../images/ui/query-schedules/dataset-icon.png)）を選択します。

![ データセットの詳細と「既存のデータセットに追加」がハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-schedules/dataset-details-existing.png)

**[!UICONTROL 出力データセットを選択]** ダイアログが表示されます。

次に、既存のデータセットを参照するか、検索フィールドを使用してオプションをフィルタリングします。 使用するデータセットの行を選択します。 データセットの詳細は、右側のパネルに表示されます。 「**[!UICONTROL 完了]**」を選択して、選択を確定します。

![ 検索フィールド、データセット行、完了がハイライト表示された出力データセットを選択ダイアログ ](../images/ui/query-schedules/select-output-dataset-dialog.png)

### クエリが継続的に失敗する場合に強制隔離 {#quarantine}

スケジュールを作成する際は、クエリを強制隔離機能に登録して、システムリソースを保護し、潜在的な中断を防ぐことができます。 強制隔離機能は、繰り返し失敗するクエリを自動的に識別して分離し、それらのクエリを [!UICONTROL  強制隔離 ] 状態にします。 10 回連続して失敗した後にクエリを強制隔離すると、問題を介入、確認および修正してから追加の実行を許可できます。 これにより、運用効率とデータの整合性を維持できます。

![ 「クエリ強制隔離 [!UICONTROL  が強調表示され、「はい」が選択されたクエリスケジュールワークスペース ] 表示されます ](../images/ui/query-schedules/quarantine-enroll.png)。

クエリが強制隔離機能に登録されると、このクエリのステータス変更に関するアラートを登録できます。 スケジュールされたクエリが強制隔離で登録されていない場合、[ アラートダイアログ ](./monitor-queries.md#alert-subscription) にオプションとして表示されません。

また、「[!UICONTROL  予定クエリ ] タブのインラインアクションから強制隔離機能に予定クエリを登録することもできます。 詳しくは、[ クエリドキュメントの監視 ](./monitor-queries.md#alert-subscription) を参照してください。

### スケジュールされたクエリステータスに対するアラートの設定 {#alerts-for-query-status}

また、スケジュールされたクエリ設定の一部として、クエリアラートを購読することもできます。 様々な状況で通知を受け取るように設定できます。 アラートは、強制隔離状態、クエリ処理の遅延、クエリのステータスの変更に対して設定できます。 使用可能なクエリ状態アラートオプションには、開始、成功、失敗があります。 アラートは、ポップアップ通知またはメールとして受け取ることができます。 スケジュールされたクエリのそのステータスに関するアラートを登録するには、チェックボックスをオンにします。

![ アラートオプションがハイライト表示されたスケジュールの詳細パネル。](../images/ui/query-editor/alerts.png)

次の表に、サポートされるクエリのアラートタイプを示します。

| アラートタイプ | 説明 |
|---|---|
| `start` | このアラートは、スケジュールされたクエリの実行が開始されたとき、または処理を開始したときに通知します。 |
| `success` | このアラートは、スケジュールされたクエリの実行が正常に完了したときに、クエリがエラーなく実行されたことを示します。 |
| `failed` | このアラートは、スケジュールされたクエリの実行でエラーが発生した場合、または正常に実行できなかった場合にトリガーします。 これにより、問題を迅速に特定して対処できます。 |
| `quarantine` | このアラートは、スケジュールされたクエリの実行が強制隔離状態になった場合にアクティブになります。 クエリが [ 強制隔離機能に登録 ](#quarantine) されると、10 回連続して実行されなかったスケジュール済みクエリは、自動的に [!UICONTROL  強制隔離 ] 状態になります。 次に、強制隔離されたクエリでは、それ以上実行する前に介入が必要です。 注意：強制隔離アラートを購読するには、クエリを強制隔離機能に登録する必要があります。 |
| `delay` | このアラートは、指定したしきい値を超える [ スケジュールされたクエリの実行結果の遅延 ](./monitor-queries.md#query-run-delay) がある場合に通知します。 クエリが完了または失敗せずに該当する期間に実行された場合にアラートをトリガーにするカスタム時間を設定できます。 デフォルトの動作では、クエリの処理が開始してから 150 分間アラートが設定されます。 |

>[!NOTE]
>
>[!UICONTROL  クエリ実行遅延 ] アラートを設定する場合は、Platform UI で目的の遅延時間を分単位で設定する必要があります。 期間を分単位で入力します。 遅延の最大値は 24 時間（1440 分）です。

アラートルールの定義方法など、Adobe Experience Platformのアラートの概要については、[ アラートの概要 ](../../observability/alerts/overview.md) を参照してください。 Adobe Experience Platform UI 内のアラートとアラートルールの管理に関するガイダンスについては、[ アラート UI ガイド ](../../observability/alerts/ui.md) を参照してください。

### スケジュールされたパラメーター化クエリのパラメーターの設定 {#set-parameters}

>[!IMPORTANT]
>
>パラメーター化されたクエリ UI 機能は、現在 **限定リリースのみ** で利用でき、すべてのお客様が利用できるわけではありません。 パラメーター化クエリへのアクセス権がない場合は、引き続き [ スケジュールを削除または無効にする ](#delete-schedule) の節に進みます。

パラメーター化クエリ用のスケジュールされたクエリを作成している場合は、これらのクエリの実行にパラメーター値を設定する必要があります。

![ クエリパラメーターセクションがハイライト表示されたスケジュール作成ワークフローの「スケジュールの詳細」セクション。](../images/ui/query-schedules/scheduled-query-parameter.png)

スケジュールの詳細を確認したら、「**[!UICONTROL 保存]**」を選択して、スケジュールを作成します。 テンプレートの「スケジュール」タブに戻ります。 このワークスペースには、スケジュール ID、スケジュール自体、スケジュールの出力データセットなど、新しく作成されたスケジュールの詳細が表示されます。

## スケジュールされたクエリの実行の表示 {#scheduled-query-runs}

テンプレートの [!UICONTROL  スケジュール ] タブで、スケジュール ID を選択して、新しくスケジュールされたクエリのクエリ実行のリストに移動します。

![新しく作成されたスケジュールがハイライト表示されたスケジュールワークスペース。](../images/ui/query-schedules/schedules-workspace.png)

または、クエリテンプレートのスケジュールされた実行のリストを表示するには、「**[!UICONTROL スケジュール済みクエリ]**」タブに移動し、使用可能なリストからテンプレート名を選択します。

![ 名前付きテンプレートがハイライト表示された「スケジュール済みクエリ」タブ ](../images/ui/query-schedules/view-scheduled-runs.png)

スケジュールされたクエリのクエリ実行のリストが表示されます。

![ スケジュール済みクエリのクエリ実行のリストがハイライト表示されたスケジュール済みクエリワークスペースの詳細セクション。](../images/ui/query-schedules/list-of-scheduled-runs.png)

UI を使用してすべてのクエリジョブのステータスを監視する方法について詳しくは、[ スケジュール済みクエリの監視ガイド ](./monitor-queries.md#inline-actions) を参照してください。

リストから **[!UICONTROL クエリ実行 ID]** を選択して、クエリ実行の概要に移動します。 [ クエリ実行の概要 ](./monitor-queries.md#query-run-overview) で利用できる情報の完全な分類については、スケジュールされたクエリの監視に関するドキュメントを参照してください。

Query Service API を使用してスケジュールされたクエリを監視するには、[ スケジュールされたクエリ実行エンドポイントガイド ](../api/runs-scheduled-queries.md) を参照してください。

## スケジュールの有効化、無効化または削除 {#delete-schedule}

特定のクエリのスケジュールワークスペース、またはすべてのスケジュール済みクエリを一覧表示する [!UICONTROL  スケジュール済みクエリ ] ワークスペースで、スケジュールを有効、無効または削除できます。

選択したクエリの「[!UICONTROL  スケジュール ]」タブにアクセスするには、「[!UICONTROL  テンプレート ]」タブまたは「[!UICONTROL  スケジュール済みクエリ ]」タブからクエリテンプレートの名前を選択する必要があります。 これにより、そのクエリのクエリエディターに移動します。 クエリエディターから **[!UICONTROL スケジュール]** を選択して、スケジュールワークスペースにアクセスします。

使用可能なスケジュールの行からスケジュールを選択して、詳細パネルに入力します。 切替スイッチを使用して、スケジュールされたクエリを無効（または有効）にします。

### 無効なクエリの削除

>[!IMPORTANT]
>
>スケジュールを無効にしてから、クエリのスケジュールを削除する必要があります。

![ 詳細パネルがハイライト表示されたテンプレートのスケジュールのリスト。](../images/ui/query-schedules/schedule-details-panel.png)

確認ダイアログが表示されます。 「**[!UICONTROL 無効]**」を選択して、アクションを確定します。

![ スケジュールを無効にする確認ダイアログ。](../images/ui/query-schedules/disable-schedule-confirmation-dialog.png)

「**[!UICONTROL スケジュールを削除]**」を選択して、無効なスケジュールを削除します。

![ 「スケジュールを削除」がハイライト表示されたスケジュールワークスペース。](../images/ui/query-schedules/delete-schedule.png)

または、「[!UICONTROL  予定クエリ ]」タブには、予定された各クエリに対するインラインアクションのコレクションが用意されています。 使用可能なインラインアクションには、スケジュールされたクエリのアラートに対する [!UICONTROL  スケジュールを無効にする ] または [!UICONTROL  スケジュールを有効にする ]、[!UICONTROL  スケジュールを削除 ] および [!UICONTROL  登録 ] が含まれます。 「スケジュール済みクエリ」タブを使用してスケジュール済みクエリを削除または無効にする方法について詳しくは、[ スケジュール済みクエリの監視ガイド ](./monitor-queries.md#inline-actions) を参照してください。
