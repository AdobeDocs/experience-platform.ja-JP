---
title: Web 拡張機能のイベントタイプ
description: Adobe Experience PlatformのWeb拡張機能のイベントタイプライブラリモジュールを定義する方法について説明します。
source-git-commit: 39d9468e5d512c75c9d540fa5d2bcba4967e2881
workflow-type: tm+mt
source-wordcount: '930'
ht-degree: 42%

---

# イベントタイプ

>[!NOTE]
>
>Adobe Experience Platform Launch は、Experience Platform のデータ収集テクノロジースイートとしてリブランドされています。 その結果、製品ドキュメント全体でいくつかの用語の変更がロールアウトされました。 用語の変更点の一覧については、次の[ドキュメント](../../term-updates.md)を参照してください。

イベントタイプライブラリモジュールは、アクティビティが発生したタイミングを検出し、関数を呼び出して関連ルールを実行するように設計されています。 検出されるイベントはカスタマイズ可能です。 ユーザーが特定のジェスチャーを行ったり、高速スクロールしたり、何かとやり取りするタイミングを検出できます。

>[!NOTE]
>
>このドキュメントは、ライブラリモジュールと、それらがタグ拡張に統合される仕組みに精通していることを前提としています。 このガイドに戻る前に、[ライブラリモジュールの形式](./format.md)の概要を参照して、実装に関する基礎知識を確認してください。

`module.exports` との両方のパラメー `settings` ターを受 `trigger` け入れます。これにより、イベントタイプをカスタマイズできます。

```js
module.exports = function(settings, trigger) { … };
```

| パラメーター | 説明 |
| --- | --- |
| `settings` | イベントタイプの表示でユーザーが設定した設定を含むオブジェクト。このオブジェクトに何を取り込むかは、完全に制御できます。 |
| `trigger` | ルールを起動するたびにモジュールが呼び出す必要がある関数。`settings`オブジェクト、`trigger`関数、ルールの間には1対1の関係があります。 つまり、1つのルールに対して受け取ったトリガー機能を使用して別のルールを実行することはできません。 |

>[!NOTE]
>
>エクスポートされた関数は、イベントタイプを使用するように設定された各ルールのために 1 回呼び出されます。

例として、5秒を経過したアクティビティを使用すると、5秒が経過した後にアクティビティが発生し、ルールが起動します。 モジュールは次の例のようになります。

```js
module.exports = function(settings, trigger) {
  setTimeout(trigger, 5000);
};
```

Adobe Experience Platformユーザーがデュレーションを設定できるようにする場合は、設定オブジェクトにデュレーションを入力して保存するオプションが必要です。 オブジェクトは次のようになります。

```js
{
  "duration": 25000
}
```

ユーザー定義の期間を操作するには、モジュールを更新してこれを含める必要があります。

```js
module.exports = function(settings, trigger) {
  setTimeout(trigger, settings.duration);
};
```

## コンテキストイベントデータの受け渡し

ルールがトリガーされる場合、多くの場合、発生したイベントに関する追加の詳細を提供すると便利です。 ルールを作成するユーザーにとっては、特定の動作を完了するときに、この情報が役立つ場合があります。例えば、マーケターが、ユーザーが画面をスワイプするたびにAnalyticsビーコンが送信されるルールを作成したい場合、 マーケティング担当者がこのイベントタイプを使用して適切なルールをトリガーできるように、拡張機能では`swipe`イベントタイプを指定する必要があります。 マーケターがビーコンでスワイプが発生した角度を含めたい場合、追加情報を提供しない限り、これは困難です。 発生したイベントに関する追加情報を提供するには、`trigger` 関数を呼び出すときにオブジェクトを渡します。 次に例を示します。

```js
trigger({
  swipeAngle: 90 // the value would be the detected angle
});
```

その後、マーケターは、テキストフィールドに値 `%event.swipeAngle%` を指定することで、Analytics ビーコンでこの値を使用できます。 また、他のコンテキスト（カスタムコードアクションなど）内からも `event.swipeAngle` にアクセスできます。他のタイプのオプションのイベント情報を含めることもできます。この情報はマーケティング担当者にとっても役立ちます。

### [!DNL nativeEvent]

イベントタイプがネイティブイベントに基づいている場合（例えば、拡張機能で`click`イベントタイプが指定された場合）、`nativeEvent`プロパティを次のように設定することをお勧めします。

```js
trigger({
  nativeEvent: nativeEvent // the value would be the underlying native event
});
```

これは、マーケターがカーソル座標などのネイティブイベントから任意の情報にアクセスしようとする場合に役立ちます。

### [!DNL element]

要素と発生したイベントとの間に強い関係がある場合は、`element`プロパティを要素のDOMノードに設定することをお勧めします。 例えば、拡張機能で`click`イベントタイプを指定し、IDが`herobanner`の要素を選択した場合にのみルールが起動するようにマーケターがイベントタイプを設定できる場合などです。 この場合、ユーザーがヒーローバナーを選択した場合は、`trigger`を呼び出し、`element`をヒーローバナーのDOMノードに設定することをお勧めします。

```js
trigger({
  element: element // the value would be the DOM node
});
```

## ルールの順序を順守する

Adobe Experience Platformのタグを使用すると、ユーザーはルールを順序指定できます。 例えば、方向変更イベントタイプを使用する場合と、ルールの実行順序をカスタマイズする場合の両方のルールを作成できます。 Adobe Experience Platformユーザーが、ルールAの方向変更イベントに対して順序値`2`を指定し、ルールBの方向変更イベントに対して順序値`1`を指定したとします。これは、モバイルデバイスで向きが変更された場合、ルールAの前にルールBを実行する必要があることを示します（順番の低いルールが最初に実行されます）。

前述したように、イベントモジュールで書き出された関数は、イベントタイプを使用するように設定された各ルールに対して 1 回だけ呼び出されます。 書き出された関数が呼び出されるたびに、特定のルールに結び付けられた一意の `trigger` 関数が渡されます。 前述のシナリオでは、エクスポートされた関数は、ルール B に結び付けられた `trigger` 関数で 1 回呼び出され、次にルール A に結び付けられた `trigger` 関数で再び呼び出されます。ルール B はルール A よりも低い順序値が与えられたため、ルール B が最初に実行されます。ライブラリモジュールが方向変更を検出したときに、ライブラリモジュールに提供されたのと同じ順序で `trigger` 関数を呼び出すことが重要です。

次のコード例では、方向変更が検出された場合、トリガー関数は、書き出された関数に指定されたのと同じ順序で呼び出されることに注意してください。

```js
var triggers = [];

window.addEventListener('orientationchange', function() {
  triggers.forEach(function(trigger) {
    trigger();
  });
});

module.exports = function(settings, trigger) {
  triggers.push(trigger);
};
```

これにより、ユーザー指定の順序が維持されます。

不適切な実装では、次のように、トリガー関数が異なる順序で呼び出されます。

```js
var triggers = [];

window.addEventListener('orientationchange', function() {
  for (var i = triggers.length - 1; i >= 0; i--) {
    triggers[i]();
  }
});

module.exports = function(settings, trigger) {
  triggers.push(trigger);
};
```

自然なプログラミングの慣行では、通常、適切な順序を維持しますが、その影響を認識し、それに応じて開発することが重要です。
